{"version":3,"file":"index-5aUt82Du.js","sources":["../../src/audio/effects/Filter.ts","../../src/audio/effects/Chorus.ts","../../src/audio/effects/Reverb.ts","../../src/audio/effects/Limiter.ts","../../src/audio/effects/Delay.ts","../../src/audio/effects/Phaser.ts","../../src/audio/effects/EffectsChain.ts","../../src/config/formulas.ts","../../src/utils/wakeLock.ts","../../src/utils/visibility.ts","../../src/recording/WAVEncoder.ts","../../src/audio/AudioEngine.ts","../../src/utils/base64url.ts","../../src/state/URLState.ts","../../src/types/state.ts","../../src/state/LocalStorage.ts","../../src/config/defaults.ts","../../src/config/presets.ts","../../src/state/StateManager.ts","../../src/ui/dom.ts","../../src/ui/components/Oscilloscope.ts","../../src/ui/components/Knob.ts","../../src/ui/components/FormulaCard.ts","../../src/index.ts"],"sourcesContent":["/**\n * Biquad Filter effect\n */\nexport class Filter {\n  private node: BiquadFilterNode;\n\n  constructor(private ctx: AudioContext) {\n    this.node = ctx.createBiquadFilter();\n  }\n\n  get input(): AudioNode {\n    return this.node;\n  }\n\n  get output(): AudioNode {\n    return this.node;\n  }\n\n  setType(type: BiquadFilterType): void {\n    this.node.type = type;\n  }\n\n  setFrequency(freq: number): void {\n    this.node.frequency.setValueAtTime(freq, this.ctx.currentTime);\n  }\n\n  setQ(q: number): void {\n    this.node.Q.setValueAtTime(q, this.ctx.currentTime);\n  }\n\n  update(type: BiquadFilterType, freq: number, q: number): void {\n    this.setType(type);\n    this.setFrequency(freq);\n    this.setQ(q);\n  }\n\n  disconnect(): void {\n    this.node.disconnect();\n  }\n}\n","/**\n * Chorus/Flanger effect\n * Modulated delay with feedback\n */\nexport class Chorus {\n  private delay: DelayNode;\n  private lfo: OscillatorNode;\n  private lfoGain: GainNode;\n  private dryGain: GainNode;\n  private wetGain: GainNode;\n  private feedbackGain: GainNode;\n\n  constructor(private ctx: AudioContext) {\n    this.delay = ctx.createDelay(0.2);\n    this.dryGain = ctx.createGain();\n    this.wetGain = ctx.createGain();\n    this.feedbackGain = ctx.createGain();\n\n    this.lfo = ctx.createOscillator();\n    this.lfoGain = ctx.createGain();\n    this.lfo.connect(this.lfoGain);\n    this.lfoGain.connect(this.delay.delayTime);\n    this.lfo.start();\n  }\n\n  get dry(): GainNode {\n    return this.dryGain;\n  }\n\n  get wet(): GainNode {\n    return this.wetGain;\n  }\n\n  get delayNode(): DelayNode {\n    return this.delay;\n  }\n\n  get feedback(): GainNode {\n    return this.feedbackGain;\n  }\n\n  setMode(mode: 'chorus' | 'flanger'): void {\n    const baseMs = mode === 'flanger' ? 2.0 : 12.0;\n    this.delay.delayTime.setValueAtTime(baseMs / 1000, this.ctx.currentTime);\n  }\n\n  setRate(rate: number): void {\n    this.lfo.frequency.setValueAtTime(rate, this.ctx.currentTime);\n  }\n\n  setDepth(depthMs: number): void {\n    this.lfoGain.gain.setValueAtTime(depthMs / 1000, this.ctx.currentTime);\n  }\n\n  setMix(mix: number): void {\n    this.dryGain.gain.setValueAtTime(1 - mix, this.ctx.currentTime);\n    this.wetGain.gain.setValueAtTime(mix, this.ctx.currentTime);\n  }\n\n  setFeedback(fb: number): void {\n    this.feedbackGain.gain.setValueAtTime(fb, this.ctx.currentTime);\n  }\n\n  update(\n    mode: 'chorus' | 'flanger',\n    rate: number,\n    depthMs: number,\n    mix: number,\n    feedback: number\n  ): void {\n    this.setMode(mode);\n    this.setRate(rate);\n    this.setDepth(depthMs);\n    this.setMix(mix);\n    this.setFeedback(feedback);\n  }\n\n  disconnect(): void {\n    this.delay.disconnect();\n    this.dryGain.disconnect();\n    this.wetGain.disconnect();\n    this.feedbackGain.disconnect();\n  }\n\n  stop(): void {\n    try {\n      this.lfo.stop();\n    } catch {\n      // Already stopped\n    }\n  }\n}\n","/**\n * Convolution Reverb effect\n * Uses procedurally generated impulse response\n */\nexport class Reverb {\n  private convolver: ConvolverNode;\n  private dryGain: GainNode;\n  private wetGain: GainNode;\n\n  constructor(private ctx: AudioContext) {\n    this.convolver = ctx.createConvolver();\n    this.dryGain = ctx.createGain();\n    this.wetGain = ctx.createGain();\n  }\n\n  get convolverNode(): ConvolverNode {\n    return this.convolver;\n  }\n\n  get dry(): GainNode {\n    return this.dryGain;\n  }\n\n  get wet(): GainNode {\n    return this.wetGain;\n  }\n\n  /**\n   * Generate a procedural impulse response\n   */\n  private makeImpulseResponse(seconds: number, decay: number): AudioBuffer {\n    const sr = this.ctx.sampleRate;\n    const len = Math.max(1, Math.floor(sr * seconds));\n    const buf = this.ctx.createBuffer(2, len, sr);\n\n    for (let ch = 0; ch < 2; ch++) {\n      const data = buf.getChannelData(ch);\n      for (let i = 0; i < len; i++) {\n        const t = i / sr;\n        const env = Math.exp(-t / Math.max(1e-3, decay));\n        data[i] = (Math.random() * 2 - 1) * env;\n      }\n    }\n\n    return buf;\n  }\n\n  setDecay(decay: number): void {\n    const seconds = Math.min(6.0, Math.max(0.3, decay * 1.4));\n    this.convolver.buffer = this.makeImpulseResponse(seconds, decay);\n  }\n\n  setMix(mix: number): void {\n    this.dryGain.gain.setValueAtTime(1 - mix, this.ctx.currentTime);\n    this.wetGain.gain.setValueAtTime(mix, this.ctx.currentTime);\n  }\n\n  update(decay: number, mix: number): void {\n    this.setDecay(decay);\n    this.setMix(mix);\n  }\n\n  disconnect(): void {\n    this.convolver.disconnect();\n    this.dryGain.disconnect();\n    this.wetGain.disconnect();\n  }\n}\n","/**\n * Limiter effect (DynamicsCompressor in limiter mode)\n */\nexport class Limiter {\n  private compressor: DynamicsCompressorNode;\n\n  constructor(private ctx: AudioContext) {\n    this.compressor = ctx.createDynamicsCompressor();\n    // Fixed limiter settings\n    this.compressor.ratio.value = 20;\n    this.compressor.attack.value = 0.003;\n    this.compressor.knee.value = 0;\n  }\n\n  get input(): AudioNode {\n    return this.compressor;\n  }\n\n  get output(): AudioNode {\n    return this.compressor;\n  }\n\n  setThreshold(threshold: number): void {\n    this.compressor.threshold.setValueAtTime(threshold, this.ctx.currentTime);\n  }\n\n  setRelease(release: number): void {\n    this.compressor.release.setValueAtTime(release, this.ctx.currentTime);\n  }\n\n  update(threshold: number, release: number): void {\n    this.setThreshold(threshold);\n    this.setRelease(release);\n  }\n\n  disconnect(): void {\n    this.compressor.disconnect();\n  }\n}\n","/**\n * Delay/Echo effect\n */\nexport class Delay {\n  private delay: DelayNode;\n  private dryGain: GainNode;\n  private wetGain: GainNode;\n  private feedbackGain: GainNode;\n\n  constructor(private ctx: AudioContext) {\n    this.delay = ctx.createDelay(3.0);\n    this.dryGain = ctx.createGain();\n    this.wetGain = ctx.createGain();\n    this.feedbackGain = ctx.createGain();\n  }\n\n  get delayNode(): DelayNode {\n    return this.delay;\n  }\n\n  get dry(): GainNode {\n    return this.dryGain;\n  }\n\n  get wet(): GainNode {\n    return this.wetGain;\n  }\n\n  get feedback(): GainNode {\n    return this.feedbackGain;\n  }\n\n  setTime(time: number): void {\n    this.delay.delayTime.setValueAtTime(time, this.ctx.currentTime);\n  }\n\n  setFeedback(fb: number): void {\n    this.feedbackGain.gain.setValueAtTime(fb, this.ctx.currentTime);\n  }\n\n  setMix(mix: number): void {\n    this.dryGain.gain.setValueAtTime(1 - mix, this.ctx.currentTime);\n    this.wetGain.gain.setValueAtTime(mix, this.ctx.currentTime);\n  }\n\n  update(time: number, feedback: number, mix: number): void {\n    this.setTime(time);\n    this.setFeedback(feedback);\n    this.setMix(mix);\n  }\n\n  disconnect(): void {\n    this.delay.disconnect();\n    this.dryGain.disconnect();\n    this.wetGain.disconnect();\n    this.feedbackGain.disconnect();\n  }\n}\n","/**\n * Phaser effect\n * Chain of all-pass filters with LFO modulation\n */\nexport class Phaser {\n  private filters: BiquadFilterNode[] = [];\n  private lfo: OscillatorNode;\n  private lfoGains: GainNode[] = [];\n  private dryGain: GainNode;\n  private wetGain: GainNode;\n  private feedbackGain: GainNode;\n  private inputGain: GainNode;\n  private outputGain: GainNode;\n\n  private static readonly MAX_STAGES = 8;\n\n  constructor(private ctx: AudioContext) {\n    this.dryGain = ctx.createGain();\n    this.wetGain = ctx.createGain();\n    this.feedbackGain = ctx.createGain();\n    this.inputGain = ctx.createGain();\n    this.outputGain = ctx.createGain();\n\n    this.lfo = ctx.createOscillator();\n    this.lfo.type = 'sine';\n    this.lfo.start();\n\n    // Create max stages (we'll use a subset based on setting)\n    for (let i = 0; i < Phaser.MAX_STAGES; i++) {\n      const filter = ctx.createBiquadFilter();\n      filter.type = 'allpass';\n      filter.frequency.value = 1000;\n      filter.Q.value = 0.5;\n      this.filters.push(filter);\n\n      const lfoGain = ctx.createGain();\n      lfoGain.gain.value = 1500;\n      this.lfo.connect(lfoGain);\n      lfoGain.connect(filter.frequency);\n      this.lfoGains.push(lfoGain);\n    }\n  }\n\n  get dry(): GainNode {\n    return this.dryGain;\n  }\n\n  get wet(): GainNode {\n    return this.wetGain;\n  }\n\n  get feedback(): GainNode {\n    return this.feedbackGain;\n  }\n\n  get input(): GainNode {\n    return this.inputGain;\n  }\n\n  get output(): GainNode {\n    return this.outputGain;\n  }\n\n  get allFilters(): BiquadFilterNode[] {\n    return this.filters;\n  }\n\n  setRate(rate: number): void {\n    this.lfo.frequency.setValueAtTime(rate, this.ctx.currentTime);\n  }\n\n  setDepth(depth: number): void {\n    const freqRange = 3000 * depth;\n    for (let i = 0; i < this.filters.length; i++) {\n      this.filters[i].frequency.setValueAtTime(1000, this.ctx.currentTime);\n      this.lfoGains[i].gain.setValueAtTime(freqRange, this.ctx.currentTime);\n    }\n  }\n\n  setFeedback(fb: number): void {\n    this.feedbackGain.gain.setValueAtTime(fb, this.ctx.currentTime);\n  }\n\n  setMix(mix: number): void {\n    this.dryGain.gain.setValueAtTime(1 - mix, this.ctx.currentTime);\n    this.wetGain.gain.setValueAtTime(mix, this.ctx.currentTime);\n  }\n\n  update(\n    rate: number,\n    depth: number,\n    _stages: number,\n    feedback: number,\n    mix: number\n  ): void {\n    this.setRate(rate);\n    this.setDepth(depth);\n    this.setFeedback(feedback);\n    this.setMix(mix);\n  }\n\n  disconnect(): void {\n    this.dryGain.disconnect();\n    this.wetGain.disconnect();\n    this.feedbackGain.disconnect();\n    this.inputGain.disconnect();\n    this.outputGain.disconnect();\n    for (const f of this.filters) {\n      f.disconnect();\n    }\n  }\n\n  stop(): void {\n    try {\n      this.lfo.stop();\n    } catch {\n      // Already stopped\n    }\n  }\n}\n","import { Filter } from './Filter';\nimport { Chorus } from './Chorus';\nimport { Reverb } from './Reverb';\nimport { Limiter } from './Limiter';\nimport { Delay } from './Delay';\nimport { Phaser } from './Phaser';\nimport type { EffectsState } from '../../types';\n\n/**\n * Manages the complete effects chain\n * Handles routing and parameter updates\n */\nexport class EffectsChain {\n  public readonly filter: Filter;\n  public readonly chorus: Chorus;\n  public readonly reverb: Reverb;\n  public readonly limiter: Limiter;\n  public readonly delay: Delay;\n  public readonly phaser: Phaser;\n\n  private inputNode: GainNode;\n  private outputNode: GainNode;\n\n  constructor(private ctx: AudioContext) {\n    this.filter = new Filter(ctx);\n    this.chorus = new Chorus(ctx);\n    this.reverb = new Reverb(ctx);\n    this.limiter = new Limiter(ctx);\n    this.delay = new Delay(ctx);\n    this.phaser = new Phaser(ctx);\n\n    this.inputNode = ctx.createGain();\n    this.outputNode = ctx.createGain();\n  }\n\n  get input(): GainNode {\n    return this.inputNode;\n  }\n\n  get output(): GainNode {\n    return this.outputNode;\n  }\n\n  /**\n   * Rebuild the effects routing based on enabled state\n   */\n  rebuild(state: EffectsState): void {\n    // Disconnect all nodes first\n    this.disconnectAll();\n\n    let node: AudioNode = this.inputNode;\n\n    // Filter\n    if (state.filterOn) {\n      node.connect(this.filter.input);\n      node = this.filter.output;\n    }\n\n    // Chorus\n    if (state.chorusOn) {\n      node.connect(this.chorus.dry);\n      node.connect(this.chorus.delayNode);\n      this.chorus.delayNode.connect(this.chorus.feedback);\n      this.chorus.feedback.connect(this.chorus.delayNode);\n      this.chorus.delayNode.connect(this.chorus.wet);\n\n      const chorusSum = this.ctx.createGain();\n      this.chorus.dry.connect(chorusSum);\n      this.chorus.wet.connect(chorusSum);\n      node = chorusSum;\n    }\n\n    // Phaser\n    if (state.phaserOn) {\n      node.connect(this.phaser.dry);\n      node.connect(this.phaser.input);\n\n      // Connect phaser filter chain\n      let pNode: AudioNode = this.phaser.input;\n      for (const f of this.phaser.allFilters) {\n        pNode.connect(f);\n        pNode = f;\n      }\n      pNode.connect(this.phaser.output);\n      this.phaser.output.connect(this.phaser.feedback);\n      this.phaser.feedback.connect(this.phaser.input);\n      this.phaser.output.connect(this.phaser.wet);\n\n      const phaserSum = this.ctx.createGain();\n      this.phaser.dry.connect(phaserSum);\n      this.phaser.wet.connect(phaserSum);\n      node = phaserSum;\n    }\n\n    // Delay\n    if (state.delayOn) {\n      node.connect(this.delay.dry);\n      node.connect(this.delay.delayNode);\n      this.delay.delayNode.connect(this.delay.feedback);\n      this.delay.feedback.connect(this.delay.delayNode);\n      this.delay.delayNode.connect(this.delay.wet);\n\n      const delaySum = this.ctx.createGain();\n      this.delay.dry.connect(delaySum);\n      this.delay.wet.connect(delaySum);\n      node = delaySum;\n    }\n\n    // Reverb\n    if (state.reverbOn) {\n      node.connect(this.reverb.dry);\n      node.connect(this.reverb.convolverNode);\n      this.reverb.convolverNode.connect(this.reverb.wet);\n\n      const reverbSum = this.ctx.createGain();\n      this.reverb.dry.connect(reverbSum);\n      this.reverb.wet.connect(reverbSum);\n      node = reverbSum;\n    }\n\n    // Limiter\n    if (state.limiterOn) {\n      node.connect(this.limiter.input);\n      node = this.limiter.output;\n    }\n\n    // Connect to output\n    node.connect(this.outputNode);\n  }\n\n  /**\n   * Update all effect parameters\n   */\n  updateParams(state: EffectsState): void {\n    this.filter.update(state.filterType, state.filterFreq, state.filterQ);\n    this.chorus.update(\n      state.chorusMode,\n      state.chorusRate,\n      state.chorusDepth,\n      state.chorusMix,\n      state.chorusFb\n    );\n    this.reverb.update(state.reverbDecay, state.reverbMix);\n    this.limiter.update(state.limiterThr, state.limiterRel);\n    this.delay.update(state.delayTime, state.delayFb, state.delayMix);\n    this.phaser.update(\n      state.phaserRate,\n      state.phaserDepth,\n      state.phaserStages,\n      state.phaserFb,\n      state.phaserMix\n    );\n  }\n\n  /**\n   * Disconnect all effect nodes\n   */\n  private disconnectAll(): void {\n    this.inputNode.disconnect();\n    this.filter.disconnect();\n    this.chorus.disconnect();\n    this.reverb.disconnect();\n    this.limiter.disconnect();\n    this.delay.disconnect();\n    this.phaser.disconnect();\n    this.outputNode.disconnect();\n  }\n\n  /**\n   * Stop all oscillators and clean up\n   */\n  destroy(): void {\n    this.disconnectAll();\n    this.chorus.stop();\n    this.phaser.stop();\n  }\n}\n","import type { FormulaConfig } from \"../types\";\n\n/**\n * Formula definitions with UI schema\n * Each formula defines its parameters and slider configurations\n */\nexport const FORMULAS: FormulaConfig[] = [\n  {\n    id: \"additive\",\n    title: \"Harmonic Sum\",\n    tag: \"Additive\",\n    desc: \"Σ aₙ(t) sin(2π n f t)\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      { k: \"fund\", name: \"Fund (Hz)\", min: 20, max: 5000, step: 1, value: 110 },\n      { k: \"N\", name: \"Harmonics N\", min: 1, max: 40, step: 1, value: 12 },\n      {\n        k: \"move\",\n        name: \"Move (Hz)\",\n        min: 0.01,\n        max: 5,\n        step: 0.01,\n        value: 0.35,\n      },\n    ],\n  },\n  {\n    id: \"lorenz\",\n    title: \"Lorenz Attractor\",\n    tag: \"Lorenz\",\n    desc: \"Lorenz ODE mapped to freq/amp\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      { k: \"sigma\", name: \"σ\", min: 0, max: 30, step: 0.01, value: 10 },\n      { k: \"rho\", name: \"ρ\", min: 0, max: 60, step: 0.01, value: 28 },\n      { k: \"beta\", name: \"β\", min: 0.1, max: 10, step: 0.0001, value: 2.6667 },\n      {\n        k: \"lBase\",\n        name: \"Base f (Hz)\",\n        min: 20,\n        max: 400,\n        step: 1,\n        value: 120,\n      },\n      {\n        k: \"lFreqScale\",\n        name: \"Freq scale\",\n        min: 0,\n        max: 200,\n        step: 0.1,\n        value: 40,\n      },\n      {\n        k: \"lAmp\",\n        name: \"Amp scale\",\n        min: 0,\n        max: 1,\n        step: 0.001,\n        value: 0.25,\n      },\n    ],\n  },\n  {\n    id: \"rossler\",\n    title: \"Rossler Attractor\",\n    tag: \"Chaos\",\n    desc: \"dx=-y-z, dy=x+ay, dz=b+z(x-c)\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      { k: \"rossA\", name: \"a\", min: 0.01, max: 0.5, step: 0.001, value: 0.2 },\n      { k: \"rossB\", name: \"b\", min: 0.01, max: 0.5, step: 0.001, value: 0.2 },\n      { k: \"rossC\", name: \"c\", min: 2, max: 12, step: 0.01, value: 5.7 },\n      {\n        k: \"rossBase\",\n        name: \"Base f (Hz)\",\n        min: 20,\n        max: 400,\n        step: 1,\n        value: 120,\n      },\n      {\n        k: \"rossFreqScale\",\n        name: \"Freq scale\",\n        min: 0,\n        max: 100,\n        step: 0.1,\n        value: 30,\n      },\n      {\n        k: \"rossAmp\",\n        name: \"Amp scale\",\n        min: 0,\n        max: 1,\n        step: 0.001,\n        value: 0.25,\n      },\n    ],\n  },\n  {\n    id: \"gliss\",\n    title: \"Exponential Glissando\",\n    tag: \"Gliss\",\n    desc: \"f(t)=f0·e^{k t}\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      { k: \"f0\", name: \"f0 (Hz)\", min: 10, max: 400, step: 1, value: 55 },\n      { k: \"k\", name: \"k\", min: -2.0, max: 2.0, step: 0.001, value: 0.15 },\n    ],\n  },\n  {\n    id: \"shepard\",\n    title: \"Shepard Tone\",\n    tag: \"Illusion\",\n    desc: \"Endless rising illusion\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      {\n        k: \"shepBase\",\n        name: \"Base f (Hz)\",\n        min: 20,\n        max: 200,\n        step: 1,\n        value: 55,\n      },\n      {\n        k: \"shepSpeed\",\n        name: \"Speed\",\n        min: -0.5,\n        max: 0.5,\n        step: 0.001,\n        value: 0.1,\n      },\n      { k: \"shepOctaves\", name: \"Octaves\", min: 3, max: 10, step: 1, value: 6 },\n    ],\n  },\n  {\n    id: \"fm\",\n    title: \"FM Sine\",\n    tag: \"FM\",\n    desc: \"sin(2π f_c t + I sin(2π f_m t))\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.15 },\n      { k: \"fc\", name: \"f_c (Hz)\", min: 20, max: 2000, step: 1, value: 220 },\n      { k: \"fm\", name: \"f_m (Hz)\", min: 0.1, max: 60, step: 0.1, value: 2.0 },\n      { k: \"I\", name: \"Index I\", min: 0, max: 20, step: 0.01, value: 3.0 },\n    ],\n  },\n  {\n    id: \"beats\",\n    title: \"Two Sines (Beats)\",\n    tag: \"Beats\",\n    desc: \"sin(2π f t)+sin(2π(f+Δf)t)\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      { k: \"fbeat\", name: \"f (Hz)\", min: 20, max: 2000, step: 1, value: 220 },\n      { k: \"df\", name: \"Δf (Hz)\", min: 0, max: 20, step: 0.01, value: 0.8 },\n    ],\n  },\n  {\n    id: \"pm\",\n    title: \"Phase Modulation\",\n    tag: \"PM\",\n    desc: \"sin(2π f t + 5·sin(sin(2π f2 t)))\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      { k: \"f\", name: \"f (Hz)\", min: 20, max: 2000, step: 1, value: 220 },\n      { k: \"f2pm\", name: \"f2 (Hz)\", min: 0.1, max: 40, step: 0.1, value: 3 },\n    ],\n  },\n  {\n    id: \"quasi\",\n    title: \"Quasi-random LFO\",\n    tag: \"Quasi\",\n    desc: \"f(t)=fq + Aq·sin(sin(sin(w·t)))\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      { k: \"fq\", name: \"Base f (Hz)\", min: 20, max: 500, step: 1, value: 120 },\n      { k: \"Aq\", name: \"Depth (Hz)\", min: 0, max: 1200, step: 1, value: 220 },\n      { k: \"wq\", name: \"w\", min: 0.05, max: 6, step: 0.01, value: 0.8 },\n    ],\n  },\n  {\n    id: \"logistic\",\n    title: \"Logistic Map\",\n    tag: \"Chaos\",\n    desc: \"xₙ₊₁ = r xₙ(1−xₙ)\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      {\n        k: \"base\",\n        name: \"Base f (Hz)\",\n        min: 20,\n        max: 800,\n        step: 1,\n        value: 110,\n      },\n      {\n        k: \"depth\",\n        name: \"Depth (Hz)\",\n        min: 0,\n        max: 1200,\n        step: 1,\n        value: 330,\n      },\n      { k: \"r\", name: \"r\", min: 2.8, max: 4.0, step: 0.0001, value: 3.86 },\n      {\n        k: \"lfoHz\",\n        name: \"Update rate (Hz)\",\n        min: 1,\n        max: 400,\n        step: 1,\n        value: 40,\n      },\n    ],\n  },\n  {\n    id: \"dist\",\n    title: \"Nonlinear Saturation\",\n    tag: \"tanh\",\n    desc: \"tanh(α·sin(2π f t))\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      { k: \"fd\", name: \"f (Hz)\", min: 20, max: 2000, step: 1, value: 110 },\n      { k: \"alpha\", name: \"α\", min: 0, max: 10, step: 0.01, value: 3.0 },\n    ],\n  },\n  {\n    id: \"karplus\",\n    title: \"Karplus–Strong (String)\",\n    tag: \"KS\",\n    desc: \"noise-in-delay + averaging + damping\",\n    hasReset: true,\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.14 },\n      {\n        k: \"ksFreq\",\n        name: \"Freq (Hz)\",\n        min: 40,\n        max: 880,\n        step: 1,\n        value: 110,\n      },\n      {\n        k: \"ksDamp\",\n        name: \"Damping\",\n        min: 0.9,\n        max: 0.9999,\n        step: 0.0001,\n        value: 0.985,\n      },\n      {\n        k: \"ksBright\",\n        name: \"Brightness\",\n        min: 0,\n        max: 1,\n        step: 0.001,\n        value: 0.5,\n      },\n    ],\n  },\n  {\n    id: \"noiselp\",\n    title: \"Noise → Low-pass\",\n    tag: \"Noise\",\n    desc: \"white noise → 1-pole LP\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      {\n        k: \"nCut\",\n        name: \"Cutoff (Hz)\",\n        min: 20,\n        max: 18000,\n        step: 1,\n        value: 800,\n      },\n    ],\n  },\n  {\n    id: \"pinknoise\",\n    title: \"Pink Noise (1/f)\",\n    tag: \"Noise\",\n    desc: \"Natural 1/f spectrum noise\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.12 },\n      {\n        k: \"pinkBright\",\n        name: \"Brightness\",\n        min: 0,\n        max: 1,\n        step: 0.01,\n        value: 0.3,\n      },\n    ],\n  },\n  {\n    id: \"brownnoise\",\n    title: \"Brown Noise (Brownian)\",\n    tag: \"Noise\",\n    desc: \"Random walk — deep rumble\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.15 },\n      {\n        k: \"brownStep\",\n        name: \"Step size\",\n        min: 0.001,\n        max: 0.1,\n        step: 0.001,\n        value: 0.02,\n      },\n    ],\n  },\n  {\n    id: \"velvetnoise\",\n    title: \"Velvet Noise\",\n    tag: \"Noise\",\n    desc: \"Sparse random impulses\",\n    sliders: [\n      { k: \"gain\", name: \"Gain\", min: 0, max: 1, step: 0.001, value: 0.1 },\n      {\n        k: \"velvetDensity\",\n        name: \"Density (imp/s)\",\n        min: 100,\n        max: 10000,\n        step: 10,\n        value: 2000,\n      },\n    ],\n  },\n];\n\n/**\n * Get formula config by ID\n */\nexport function getFormulaById(id: string): FormulaConfig | undefined {\n  return FORMULAS.find((f) => f.id === id);\n}\n","/**\n * Screen Wake Lock manager\n * Prevents the screen from turning off during audio playback on mobile devices\n */\n\nlet wakeLock: WakeLockSentinel | null = null;\n\n/**\n * Request a wake lock to prevent screen from sleeping\n */\nexport async function requestWakeLock(): Promise<void> {\n  if ('wakeLock' in navigator) {\n    try {\n      wakeLock = await navigator.wakeLock.request('screen');\n      wakeLock.addEventListener('release', () => {\n        wakeLock = null;\n      });\n    } catch (err) {\n      const error = err as Error;\n      console.log('Wake Lock error:', error.name, error.message);\n    }\n  }\n}\n\n/**\n * Release the wake lock\n */\nexport async function releaseWakeLock(): Promise<void> {\n  if (wakeLock) {\n    await wakeLock.release();\n    wakeLock = null;\n  }\n}\n\n/**\n * Check if wake lock is currently held\n */\nexport function hasWakeLock(): boolean {\n  return wakeLock !== null;\n}\n","/**\n * Page visibility utilities\n * Handles browser tab visibility changes for background audio\n */\n\nexport type VisibilityCallback = (visible: boolean) => void;\n\nconst callbacks: Set<VisibilityCallback> = new Set();\n\n/**\n * Check if the page is currently visible\n */\nexport function isPageVisible(): boolean {\n  return document.visibilityState === 'visible';\n}\n\n/**\n * Subscribe to visibility changes\n * @returns Unsubscribe function\n */\nexport function onVisibilityChange(callback: VisibilityCallback): () => void {\n  callbacks.add(callback);\n  return () => callbacks.delete(callback);\n}\n\n// Initialize visibility listener\ndocument.addEventListener('visibilitychange', () => {\n  const visible = isPageVisible();\n  callbacks.forEach((cb) => cb(visible));\n});\n","/**\n * WAV file encoder\n * Converts Float32Array samples to WAV Blob (16-bit PCM)\n */\n\nfunction writeString(view: DataView, offset: number, str: string): void {\n  for (let i = 0; i < str.length; i++) {\n    view.setUint8(offset + i, str.charCodeAt(i));\n  }\n}\n\n/**\n * Encode Float32Array samples to WAV Blob\n * @param samples Audio samples (-1 to 1)\n * @param sampleRate Sample rate in Hz\n * @returns WAV file as Blob\n */\nexport function encodeWAV(samples: Float32Array, sampleRate: number): Blob {\n  const numChannels = 1;\n  const bitsPerSample = 16;\n  const bytesPerSample = bitsPerSample / 8;\n  const blockAlign = numChannels * bytesPerSample;\n  const byteRate = sampleRate * blockAlign;\n  const dataSize = samples.length * bytesPerSample;\n  const buffer = new ArrayBuffer(44 + dataSize);\n  const view = new DataView(buffer);\n\n  // RIFF header\n  writeString(view, 0, 'RIFF');\n  view.setUint32(4, 36 + dataSize, true);\n  writeString(view, 8, 'WAVE');\n\n  // fmt chunk\n  writeString(view, 12, 'fmt ');\n  view.setUint32(16, 16, true); // chunk size\n  view.setUint16(20, 1, true); // PCM format\n  view.setUint16(22, numChannels, true);\n  view.setUint32(24, sampleRate, true);\n  view.setUint32(28, byteRate, true);\n  view.setUint16(32, blockAlign, true);\n  view.setUint16(34, bitsPerSample, true);\n\n  // data chunk\n  writeString(view, 36, 'data');\n  view.setUint32(40, dataSize, true);\n\n  // Convert float samples to 16-bit PCM\n  let offset = 44;\n  for (let i = 0; i < samples.length; i++) {\n    let s = Math.max(-1, Math.min(1, samples[i]));\n    s = s < 0 ? s * 0x8000 : s * 0x7fff;\n    view.setInt16(offset, s, true);\n    offset += 2;\n  }\n\n  return new Blob([buffer], { type: 'audio/wav' });\n}\n\n/**\n * Generate a timestamped filename for WAV recording\n */\nexport function generateWAVFilename(): string {\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n  return `formula-audio-${timestamp}.wav`;\n}\n","import { EffectsChain } from \"./effects\";\nimport { FORMULAS } from \"../config/formulas\";\nimport { requestWakeLock, releaseWakeLock } from \"../utils/wakeLock\";\nimport { isPageVisible, onVisibilityChange } from \"../utils/visibility\";\nimport { encodeWAV, generateWAVFilename } from \"../recording/WAVEncoder\";\nimport type {\n  AppState,\n  EffectsState,\n  GeneratorNode,\n  WorkletMessage,\n  RecorderDataMessage,\n} from \"../types\";\n// Worklet URLs that Vite will transpile & point to JS:\nimport generatorUrl from \"./worklets/formula-generator.worklet.ts?worker&url\";\nimport recorderUrl from \"./worklets/recorder.worklet.ts?worker&url\";\n\nexport type AudioEngineEvent =\n  | \"start\"\n  | \"stop\"\n  | \"recording-start\"\n  | \"recording-stop\";\n\n/**\n * Main audio engine\n * Manages the audio graph, generators, effects, and recording\n */\nexport class AudioEngine extends EventTarget {\n  private ctx: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private mixBus: GainNode | null = null;\n  private masterGain: GainNode | null = null;\n  private effectsChain: EffectsChain | null = null;\n  private generators: Map<string, GeneratorNode> = new Map();\n  private recorderNode: AudioWorkletNode | null = null;\n  private _isRecording = false;\n  private visibilityUnsubscribe: (() => void) | null = null;\n\n  /**\n   * Check if audio is running\n   */\n  get isRunning(): boolean {\n    return this.ctx !== null && this.ctx.state === \"running\";\n  }\n\n  /**\n   * Check if recording is active\n   */\n  get isRecording(): boolean {\n    return this._isRecording;\n  }\n\n  /**\n   * Get the audio context (for external use)\n   */\n  get audioContext(): AudioContext | null {\n    return this.ctx;\n  }\n\n  /**\n   * Get the analyser node (for visualization)\n   */\n  get analyserNode(): AnalyserNode | null {\n    return this.analyser;\n  }\n\n  /**\n   * Get sample rate\n   */\n  get sampleRate(): number {\n    return this.ctx?.sampleRate ?? 44100;\n  }\n\n  /**\n   * Start the audio engine\n   */\n  async start(initialState?: AppState): Promise<void> {\n    if (this.ctx) return;\n\n    // Create audio context\n    this.ctx = new AudioContext({ latencyHint: \"interactive\" });\n\n    // iOS Safari: AudioContext may start suspended\n    if (this.ctx.state === \"suspended\") {\n      await this.ctx.resume();\n    }\n\n    await Promise.all([\n      this.ctx.audioWorklet.addModule(generatorUrl),\n      this.ctx.audioWorklet.addModule(recorderUrl),\n    ]);\n\n    // Create nodes\n    this.analyser = this.ctx.createAnalyser();\n    this.analyser.fftSize = 2048;\n\n    this.mixBus = this.ctx.createGain();\n    this.mixBus.gain.value = 1;\n\n    this.masterGain = this.ctx.createGain();\n    this.masterGain.gain.value = initialState?.masterGain ?? 0.25;\n\n    // Create effects chain\n    this.effectsChain = new EffectsChain(this.ctx);\n\n    // Connect: mixBus -> effects -> masterGain -> analyser -> destination\n    this.mixBus.connect(this.effectsChain.input);\n    this.effectsChain.output.connect(this.masterGain);\n    this.masterGain.connect(this.analyser);\n    this.analyser.connect(this.ctx.destination);\n\n    // Create recorder node\n    this.recorderNode = new AudioWorkletNode(this.ctx, \"recorder-processor\", {\n      numberOfInputs: 1,\n      numberOfOutputs: 1,\n      outputChannelCount: [1],\n    });\n\n    // Connect recorder (with silent output to keep it active)\n    this.masterGain.connect(this.recorderNode);\n    const silentGain = this.ctx.createGain();\n    silentGain.gain.value = 0;\n    this.recorderNode.connect(silentGain);\n    silentGain.connect(this.ctx.destination);\n\n    // Create generators\n    for (const f of FORMULAS) {\n      const initParams: Record<string, number> = {};\n      for (const s of f.sliders) {\n        const stateParams = initialState?.formulas?.[f.id]?.params;\n        initParams[s.k] = stateParams?.[s.k] ?? s.value;\n      }\n\n      const worklet = new AudioWorkletNode(this.ctx, \"formula-generator\", {\n        numberOfInputs: 0,\n        numberOfOutputs: 1,\n        outputChannelCount: [1],\n        processorOptions: { formula: f.id, params: initParams },\n      });\n\n      const gain = this.ctx.createGain();\n      gain.gain.value = 0;\n      worklet.connect(gain);\n      gain.connect(this.mixBus);\n\n      this.generators.set(f.id, { worklet, gain, params: initParams });\n    }\n\n    // Apply initial effects state\n    if (initialState?.fx) {\n      this.updateEffects(initialState.fx);\n    }\n\n    // Enable generators based on initial state\n    if (initialState?.formulas) {\n      for (const [id, state] of Object.entries(initialState.formulas)) {\n        if (state.enabled) {\n          this.enableFormula(id, true);\n        }\n      }\n    }\n\n    // Request wake lock\n    await requestWakeLock();\n\n    // Handle visibility changes\n    this.visibilityUnsubscribe = onVisibilityChange(async (visible) => {\n      if (visible && this.ctx) {\n        if (this.ctx.state === \"suspended\") {\n          await this.ctx.resume();\n        }\n        await requestWakeLock();\n      }\n    });\n\n    this.dispatchEvent(new Event(\"start\"));\n  }\n\n  /**\n   * Stop the audio engine\n   */\n  async stop(): Promise<void> {\n    if (!this.ctx) return;\n\n    // Stop recording if active\n    if (this._isRecording) {\n      await this.stopRecording();\n    }\n\n    // Release wake lock\n    await releaseWakeLock();\n\n    // Unsubscribe from visibility changes\n    if (this.visibilityUnsubscribe) {\n      this.visibilityUnsubscribe();\n      this.visibilityUnsubscribe = null;\n    }\n\n    // Fade out master\n    const now = this.ctx.currentTime;\n    this.masterGain?.gain.setTargetAtTime(0, now, 0.01);\n\n    // Cleanup after fade\n    await new Promise((resolve) => setTimeout(resolve, 80));\n\n    // Destroy effects\n    this.effectsChain?.destroy();\n\n    // Close context\n    await this.ctx.close();\n\n    // Clear references\n    this.ctx = null;\n    this.analyser = null;\n    this.mixBus = null;\n    this.masterGain = null;\n    this.effectsChain = null;\n    this.recorderNode = null;\n    this.generators.clear();\n\n    this.dispatchEvent(new Event(\"stop\"));\n  }\n\n  /**\n   * Set master gain\n   */\n  setMasterGain(value: number): void {\n    if (this.masterGain) {\n      this.masterGain.gain.value = value;\n    }\n  }\n\n  /**\n   * Enable or disable a formula generator\n   */\n  enableFormula(id: string, enabled: boolean): void {\n    const gen = this.generators.get(id);\n    if (!gen || !this.ctx) return;\n\n    const now = this.ctx.currentTime;\n    const targetGain = enabled ? gen.params.gain ?? 0.2 : 0;\n    gen.gain.gain.setTargetAtTime(targetGain, now, 0.02);\n  }\n\n  /**\n   * Update a formula parameter\n   */\n  updateFormulaParam(id: string, param: string, value: number): void {\n    const gen = this.generators.get(id);\n    if (!gen) return;\n\n    gen.params[param] = value;\n    const msg: WorkletMessage = { type: \"set\", params: { [param]: value } };\n    gen.worklet.port.postMessage(msg);\n\n    // If gain changed and formula is enabled, update gain node\n    if (param === \"gain\" && gen.gain.gain.value > 0 && this.ctx) {\n      gen.gain.gain.setTargetAtTime(value, this.ctx.currentTime, 0.02);\n    }\n  }\n\n  /**\n   * Reset formula state\n   */\n  resetFormula(id: string): void {\n    const gen = this.generators.get(id);\n    if (!gen) return;\n\n    const msg: WorkletMessage = { type: \"reset\" };\n    gen.worklet.port.postMessage(msg);\n  }\n\n  /**\n   * Update effects chain\n   */\n  updateEffects(state: EffectsState): void {\n    if (!this.effectsChain || !this.mixBus || !this.masterGain) return;\n\n    // Rebuild routing\n    this.mixBus.disconnect();\n    this.effectsChain.output.disconnect();\n\n    this.effectsChain.rebuild(state);\n    this.effectsChain.updateParams(state);\n\n    // Reconnect\n    this.mixBus.connect(this.effectsChain.input);\n    this.effectsChain.output.connect(this.masterGain);\n  }\n\n  /**\n   * Update only effect parameters (no routing change)\n   */\n  updateEffectParams(state: EffectsState): void {\n    this.effectsChain?.updateParams(state);\n  }\n\n  /**\n   * Start recording\n   */\n  startRecording(): void {\n    if (!this.recorderNode || this._isRecording) return;\n\n    this._isRecording = true;\n    this.recorderNode.port.postMessage({ type: \"start\" });\n    this.dispatchEvent(new Event(\"recording-start\"));\n  }\n\n  /**\n   * Stop recording and return WAV blob\n   */\n  async stopRecording(): Promise<{ blob: Blob; filename: string } | null> {\n    if (!this.recorderNode || !this._isRecording || !this.ctx) return null;\n\n    return new Promise((resolve) => {\n      this.recorderNode!.port.onmessage = (\n        e: MessageEvent<RecorderDataMessage>\n      ) => {\n        if (e.data.type === \"data\") {\n          this._isRecording = false;\n          const blob = encodeWAV(e.data.samples, this.ctx!.sampleRate);\n          const filename = generateWAVFilename();\n\n          this.dispatchEvent(\n            new CustomEvent(\"recording-stop\", { detail: { blob, filename } })\n          );\n          resolve({ blob, filename });\n        }\n      };\n\n      this.recorderNode!.port.postMessage({ type: \"stop\" });\n    });\n  }\n\n  /**\n   * Get time domain data for oscilloscope\n   */\n  getTimeDomainData(buffer: Uint8Array<ArrayBuffer>): void {\n    this.analyser?.getByteTimeDomainData(buffer);\n  }\n\n  /**\n   * Get frequency data for spectrum\n   */\n  getFrequencyData(buffer: Uint8Array<ArrayBuffer>): void {\n    this.analyser?.getByteFrequencyData(buffer);\n  }\n\n  /**\n   * Check if page is visible\n   */\n  isPageVisible(): boolean {\n    return isPageVisible();\n  }\n}\n","/**\n * Encode a string to base64url format (URL-safe base64)\n */\nexport function b64urlEncode(str: string): string {\n  const bytes = new TextEncoder().encode(str);\n  let bin = '';\n  for (const b of bytes) {\n    bin += String.fromCharCode(b);\n  }\n  return btoa(bin)\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '');\n}\n\n/**\n * Decode a base64url string back to the original string\n */\nexport function b64urlDecode(b64u: string): string {\n  const b64 = b64u.replace(/-/g, '+').replace(/_/g, '/');\n  const pad = b64.length % 4 ? '='.repeat(4 - (b64.length % 4)) : '';\n  const bin = atob(b64 + pad);\n  const bytes = new Uint8Array(bin.length);\n  for (let i = 0; i < bin.length; i++) {\n    bytes[i] = bin.charCodeAt(i);\n  }\n  return new TextDecoder().decode(bytes);\n}\n","import { b64urlEncode, b64urlDecode } from '../utils/base64url';\nimport type { AppState } from '../types';\n\n/**\n * Load state from URL hash\n */\nexport function loadStateFromURL(): AppState | null {\n  const m = location.hash.match(/#s=([A-Za-z0-9\\-_]+)/);\n  if (!m) return null;\n\n  try {\n    const json = b64urlDecode(m[1]);\n    return JSON.parse(json) as AppState;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Write state to URL hash\n * @returns The full URL with state encoded\n */\nexport function writeStateToURL(state: AppState): string {\n  const json = JSON.stringify(state);\n  const token = b64urlEncode(json);\n  const newHash = `#s=${token}`;\n  history.replaceState(null, '', newHash);\n  return location.href;\n}\n\n/**\n * Clear state from URL\n */\nexport function clearStateFromURL(): void {\n  history.replaceState(null, '', location.pathname + location.search);\n}\n","import type { EffectsState } from './effects';\nimport type { FormulaState } from './formula';\n\n/**\n * Complete application state\n * This is what gets serialized to URL/localStorage\n */\nexport interface AppState {\n  /** State format version */\n  v: number;\n  /** Master volume (0-1) */\n  masterGain: number;\n  /** Effects chain state */\n  fx: EffectsState;\n  /** State of each formula generator */\n  formulas: Record<string, FormulaState>;\n}\n\n/**\n * Preset definition\n */\nexport interface Preset {\n  /** Display name */\n  name: string;\n  /** State to apply when preset is selected */\n  state: AppState;\n}\n\n/**\n * localStorage keys used by the app\n */\nexport const STORAGE_KEYS = {\n  PRESET: 'formula_audio_lab_preset_v2',\n  HELP_SHOWN: 'formula_audio_lab_help_shown',\n} as const;\n\n/**\n * Current state format version\n */\nexport const STATE_VERSION = 2;\n","import { STORAGE_KEYS } from '../types';\nimport type { AppState } from '../types';\n\n/**\n * Save preset to localStorage\n */\nexport function savePreset(state: AppState): void {\n  localStorage.setItem(STORAGE_KEYS.PRESET, JSON.stringify(state));\n}\n\n/**\n * Load preset from localStorage\n */\nexport function loadPreset(): AppState | null {\n  const raw = localStorage.getItem(STORAGE_KEYS.PRESET);\n  if (!raw) return null;\n\n  try {\n    return JSON.parse(raw) as AppState;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check if preset exists in localStorage\n */\nexport function hasPreset(): boolean {\n  return localStorage.getItem(STORAGE_KEYS.PRESET) !== null;\n}\n\n/**\n * Delete preset from localStorage\n */\nexport function deletePreset(): void {\n  localStorage.removeItem(STORAGE_KEYS.PRESET);\n}\n\n/**\n * Check if help has been shown before\n */\nexport function hasSeenHelp(): boolean {\n  return localStorage.getItem(STORAGE_KEYS.HELP_SHOWN) === 'true';\n}\n\n/**\n * Mark help as shown\n */\nexport function markHelpShown(): void {\n  localStorage.setItem(STORAGE_KEYS.HELP_SHOWN, 'true');\n}\n","import type { EffectsState } from '../types';\n\n/**\n * Default master gain value\n */\nexport const DEFAULT_MASTER_GAIN = 0.25;\n\n/**\n * Default effects state - all effects OFF with sensible default values\n */\nexport const DEFAULT_FX: EffectsState = {\n  // Filter\n  filterOn: false,\n  filterType: 'lowpass',\n  filterFreq: 1000,\n  filterQ: 0.7,\n  // Chorus\n  chorusOn: false,\n  chorusMode: 'chorus',\n  chorusRate: 0.35,\n  chorusDepth: 6,\n  chorusMix: 0.35,\n  chorusFb: 0.15,\n  // Reverb\n  reverbOn: false,\n  reverbDecay: 2.8,\n  reverbMix: 0.25,\n  // Limiter\n  limiterOn: false,\n  limiterThr: -12,\n  limiterRel: 0.15,\n  // Delay\n  delayOn: false,\n  delayTime: 0.35,\n  delayFb: 0.4,\n  delayMix: 0.3,\n  // Phaser\n  phaserOn: false,\n  phaserRate: 0.5,\n  phaserDepth: 0.7,\n  phaserStages: 4,\n  phaserFb: 0.3,\n  phaserMix: 0.5,\n};\n\n/**\n * Current state format version\n */\nexport const STATE_VERSION = 2;\n","import type { Preset } from '../types';\n\n/**\n * Built-in presets\n */\nexport const PRESETS: Preset[] = [\n  {\n    name: 'Stillness meditation',\n    state: {\n      v: 2,\n      masterGain: 0.514,\n      fx: {\n        filterOn: true,\n        filterType: 'lowpass',\n        filterFreq: 3400,\n        filterQ: 6.3,\n        chorusOn: true,\n        chorusMode: 'chorus',\n        chorusRate: 0.01,\n        chorusDepth: 8.4,\n        chorusMix: 0.35,\n        chorusFb: 0.95,\n        reverbOn: true,\n        reverbDecay: 3.2,\n        reverbMix: 0.5,\n        limiterOn: true,\n        limiterThr: -12,\n        limiterRel: 0.15,\n        delayOn: true,\n        delayTime: 0.63,\n        delayFb: 0.62,\n        delayMix: 0.3,\n        phaserOn: true,\n        phaserRate: 0.47,\n        phaserDepth: 0.59,\n        phaserStages: 4,\n        phaserFb: 0.62,\n        phaserMix: 0.22,\n      },\n      formulas: {\n        additive: {\n          enabled: true,\n          params: {\n            gain: 0.474,\n            fund: 57,\n            N: 12,\n            move: 0.35,\n          },\n        },\n        rossler: {\n          enabled: true,\n          params: {\n            gain: 0.169,\n            rossA: 0.181,\n            rossB: 0.238,\n            rossC: 6.42,\n            rossBase: 345,\n            rossFreqScale: 38.4,\n            rossAmp: 0.25,\n          },\n        },\n      },\n    },\n  },\n  {\n    name: 'Waiting for the subway',\n    state: {\n      v: 2,\n      masterGain: 0.514,\n      fx: {\n        filterOn: true,\n        filterType: 'lowpass',\n        filterFreq: 2000,\n        filterQ: 6.3,\n        chorusOn: true,\n        chorusMode: 'flanger',\n        chorusRate: 0.98,\n        chorusDepth: 5.7,\n        chorusMix: 0.68,\n        chorusFb: 0.45,\n        reverbOn: true,\n        reverbDecay: 3.2,\n        reverbMix: 1,\n        limiterOn: true,\n        limiterThr: -12,\n        limiterRel: 0.15,\n        delayOn: false,\n        delayTime: 1.77,\n        delayFb: 0.62,\n        delayMix: 1,\n        phaserOn: false,\n        phaserRate: 5.25,\n        phaserDepth: 0.38,\n        phaserStages: 4,\n        phaserFb: 0.62,\n        phaserMix: 0.22,\n      },\n      formulas: {\n        additive: {\n          enabled: true,\n          params: {\n            gain: 0.255,\n            fund: 200,\n            N: 5,\n            move: 3.94,\n          },\n        },\n        lorenz: {\n          enabled: true,\n          params: {\n            gain: 0.498,\n            sigma: 10,\n            rho: 24.51,\n            beta: 2.6667,\n            lBase: 192,\n            lFreqScale: 40,\n            lAmp: 0.25,\n          },\n        },\n        noiselp: {\n          enabled: true,\n          params: {\n            gain: 0.081,\n            nCut: 2085,\n          },\n        },\n      },\n    },\n  },\n  {\n    name: 'Inside the nuclear power plant',\n    state: {\n      v: 2,\n      masterGain: 0.536,\n      fx: {\n        filterOn: true,\n        filterType: 'lowpass',\n        filterFreq: 2000,\n        filterQ: 10.3,\n        chorusOn: true,\n        chorusMode: 'flanger',\n        chorusRate: 0.15,\n        chorusDepth: 0.6,\n        chorusMix: 0.28,\n        chorusFb: 0.88,\n        reverbOn: true,\n        reverbDecay: 8,\n        reverbMix: 0.36,\n        limiterOn: true,\n        limiterThr: -12,\n        limiterRel: 0.15,\n        delayOn: false,\n        delayTime: 1.77,\n        delayFb: 0.62,\n        delayMix: 1,\n        phaserOn: false,\n        phaserRate: 5.25,\n        phaserDepth: 0.38,\n        phaserStages: 8,\n        phaserFb: 0.62,\n        phaserMix: 0.22,\n      },\n      formulas: {\n        additive: {\n          enabled: true,\n          params: {\n            gain: 0.529,\n            fund: 110,\n            N: 19,\n            move: 2.5,\n          },\n        },\n      },\n    },\n  },\n  {\n    name: 'Long journey on the helicopter',\n    state: {\n      v: 2,\n      masterGain: 0.585,\n      fx: {\n        filterOn: true,\n        filterType: 'lowpass',\n        filterFreq: 285,\n        filterQ: 13.3,\n        chorusOn: true,\n        chorusMode: 'flanger',\n        chorusRate: 0.13,\n        chorusDepth: 1.2,\n        chorusMix: 0.65,\n        chorusFb: 0.8,\n        reverbOn: false,\n        reverbDecay: 5.5,\n        reverbMix: 0.36,\n        limiterOn: true,\n        limiterThr: -12,\n        limiterRel: 0.15,\n        delayOn: false,\n        delayTime: 1.77,\n        delayFb: 0.62,\n        delayMix: 1,\n        phaserOn: false,\n        phaserRate: 4.19,\n        phaserDepth: 0.59,\n        phaserStages: 4,\n        phaserFb: 0.62,\n        phaserMix: 0.22,\n      },\n      formulas: {\n        additive: {\n          enabled: true,\n          params: {\n            gain: 0.733,\n            fund: 56,\n            N: 23,\n            move: 2.5,\n          },\n        },\n        rossler: {\n          enabled: true,\n          params: {\n            gain: 0.458,\n            rossA: 0.085,\n            rossB: 0.472,\n            rossC: 7.06,\n            rossBase: 51,\n            rossFreqScale: 100,\n            rossAmp: 0.605,\n          },\n        },\n        velvetnoise: {\n          enabled: true,\n          params: {\n            gain: 0.883,\n            velvetDensity: 2000,\n          },\n        },\n      },\n    },\n  },\n  {\n    name: 'Abandoned shrine',\n    state: {\n      v: 2,\n      masterGain: 0.25,\n      fx: {\n        filterOn: true,\n        filterType: 'lowpass',\n        filterFreq: 2000,\n        filterQ: 0.7,\n        chorusOn: true,\n        chorusMode: 'chorus',\n        chorusRate: 0.01,\n        chorusDepth: 6.6,\n        chorusMix: 0.35,\n        chorusFb: 0.95,\n        reverbOn: true,\n        reverbDecay: 2.8,\n        reverbMix: 0.25,\n        limiterOn: true,\n        limiterThr: -12,\n        limiterRel: 0.15,\n        delayOn: false,\n        delayTime: 0.35,\n        delayFb: 0.4,\n        delayMix: 0.3,\n        phaserOn: false,\n        phaserRate: 0.5,\n        phaserDepth: 0.7,\n        phaserStages: 4,\n        phaserFb: 0.3,\n        phaserMix: 0.5,\n      },\n      formulas: {\n        additive: {\n          enabled: true,\n          params: {\n            gain: 0.526,\n            fund: 57,\n            N: 12,\n            move: 0.35,\n          },\n        },\n        lorenz: {\n          enabled: true,\n          params: {\n            gain: 0.293,\n            sigma: 10,\n            rho: 28,\n            beta: 2.6667,\n            lBase: 120,\n            lFreqScale: 40,\n            lAmp: 0.25,\n          },\n        },\n        noiselp: {\n          enabled: true,\n          params: {\n            gain: 0.1,\n            nCut: 800,\n          },\n        },\n      },\n    },\n  },\n];\n","import { loadStateFromURL, writeStateToURL } from './URLState';\nimport {\n  savePreset,\n  loadPreset,\n  hasSeenHelp,\n  markHelpShown,\n} from './LocalStorage';\nimport { DEFAULT_FX, DEFAULT_MASTER_GAIN, STATE_VERSION } from '../config';\nimport { FORMULAS } from '../config/formulas';\nimport type { AppState, EffectsState, FormulaState } from '../types';\n\n/**\n * Central state manager\n * Coordinates reading/writing state from UI, URL, and localStorage\n */\nexport class StateManager {\n  /**\n   * Get default state with all formulas disabled\n   */\n  getDefaultState(): AppState {\n    const formulas: Record<string, FormulaState> = {};\n\n    for (const f of FORMULAS) {\n      const params: Record<string, number> = {};\n      for (const s of f.sliders) {\n        params[s.k] = s.value;\n      }\n      formulas[f.id] = { enabled: false, params };\n    }\n\n    return {\n      v: STATE_VERSION,\n      masterGain: DEFAULT_MASTER_GAIN,\n      fx: { ...DEFAULT_FX },\n      formulas,\n    };\n  }\n\n  /**\n   * Get default effects state\n   */\n  getDefaultFX(): EffectsState {\n    return { ...DEFAULT_FX };\n  }\n\n  /**\n   * Load state from URL hash\n   */\n  loadFromURL(): AppState | null {\n    return loadStateFromURL();\n  }\n\n  /**\n   * Save state to URL hash\n   */\n  saveToURL(state: AppState): string {\n    return writeStateToURL(state);\n  }\n\n  /**\n   * Save state to localStorage as user preset\n   */\n  saveToStorage(state: AppState): void {\n    savePreset(state);\n  }\n\n  /**\n   * Load state from localStorage\n   */\n  loadFromStorage(): AppState | null {\n    return loadPreset();\n  }\n\n  /**\n   * Check if help popup has been shown before\n   */\n  hasSeenHelp(): boolean {\n    return hasSeenHelp();\n  }\n\n  /**\n   * Mark help as shown (don't auto-show again)\n   */\n  markHelpShown(): void {\n    markHelpShown();\n  }\n\n  /**\n   * Merge partial state with defaults\n   * Useful when loading presets that may not have all fields\n   */\n  mergeWithDefaults(partial: Partial<AppState>): AppState {\n    const defaults = this.getDefaultState();\n\n    return {\n      v: partial.v ?? defaults.v,\n      masterGain: partial.masterGain ?? defaults.masterGain,\n      fx: { ...defaults.fx, ...partial.fx },\n      formulas: { ...defaults.formulas, ...partial.formulas },\n    };\n  }\n}\n","/**\n * DOM utility functions\n */\n\n/**\n * Query selector shorthand with optional type parameter\n */\nexport function $<T extends HTMLElement = HTMLElement>(selector: string): T | null {\n  return document.querySelector(selector) as T | null;\n}\n\n/**\n * Query selector that throws if element not found\n */\nexport function $require<T extends HTMLElement = HTMLElement>(selector: string): T {\n  const el = document.querySelector(selector) as T | null;\n  if (!el) {\n    throw new Error(`Element not found: ${selector}`);\n  }\n  return el;\n}\n\n/**\n * Format a numeric value for display\n * - Values >= 100: integer\n * - Values >= 10: 2 decimal places\n * - Values < 10: 3 decimal places\n */\nexport function fmt(v: number): string {\n  v = Number(v);\n  if (Math.abs(v) >= 100) return String(Math.round(v));\n  if (Math.abs(v) >= 10) return v.toFixed(2);\n  return v.toFixed(3);\n}\n\n/**\n * Create an HTML element with attributes and children\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tag: K,\n  attrs?: Record<string, string>,\n  children?: (Node | string)[]\n): HTMLElementTagNameMap[K] {\n  const el = document.createElement(tag);\n  if (attrs) {\n    for (const [key, value] of Object.entries(attrs)) {\n      el.setAttribute(key, value);\n    }\n  }\n  if (children) {\n    for (const child of children) {\n      if (typeof child === 'string') {\n        el.appendChild(document.createTextNode(child));\n      } else {\n        el.appendChild(child);\n      }\n    }\n  }\n  return el;\n}\n","import type { AudioEngine } from '../../audio';\n\nexport type ScopeMode = 'wave' | 'spectrum';\n\n/**\n * Oscilloscope/Spectrogram visualization component\n */\nexport class Oscilloscope {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private scopeMode: ScopeMode = 'spectrum';\n  private scopeAutoGain = 1.0;\n\n  // Spectrogram state\n  private spectroCanvas: HTMLCanvasElement | null = null;\n  private spectroCtx: CanvasRenderingContext2D | null = null;\n  private lastCanvasWidth = 0;\n  private lastCanvasHeight = 0;\n  private lastSpectroTime = 0;\n  private readonly SPECTRO_INTERVAL = 33; // ~30 fps\n\n  // Buffers\n  private timeBuf: Uint8Array<ArrayBuffer> | null = null;\n  private freqBuf: Uint8Array<ArrayBuffer> | null = null;\n\n  // Animation\n  private rafId: number | null = null;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    private audio: AudioEngine\n  ) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d')!;\n\n    // Handle resize\n    window.addEventListener('resize', () => this.resize());\n    this.resize();\n  }\n\n  get mode(): ScopeMode {\n    return this.scopeMode;\n  }\n\n  setMode(mode: ScopeMode): void {\n    this.scopeMode = mode;\n  }\n\n  toggleMode(): ScopeMode {\n    this.scopeMode = this.scopeMode === 'wave' ? 'spectrum' : 'wave';\n    return this.scopeMode;\n  }\n\n  resize(): void {\n    const dpr = window.devicePixelRatio || 1;\n    const rect = this.canvas.getBoundingClientRect();\n    this.canvas.width = Math.max(1, Math.floor(rect.width * dpr));\n    this.canvas.height = Math.max(1, Math.floor(rect.height * dpr));\n\n    // Reinit spectrogram on resize\n    if (this.audio.analyserNode) {\n      this.initSpectro(\n        this.canvas.width,\n        this.canvas.height,\n        this.audio.analyserNode.frequencyBinCount\n      );\n    }\n  }\n\n  start(): void {\n    if (this.rafId !== null) return;\n\n    const analyser = this.audio.analyserNode;\n    if (!analyser) return;\n\n    this.timeBuf = new Uint8Array(analyser.fftSize);\n    this.freqBuf = new Uint8Array(analyser.frequencyBinCount);\n    this.initSpectro(\n      this.canvas.width,\n      this.canvas.height,\n      analyser.frequencyBinCount\n    );\n\n    this.draw();\n  }\n\n  stop(): void {\n    if (this.rafId !== null) {\n      cancelAnimationFrame(this.rafId);\n      this.rafId = null;\n    }\n  }\n\n  private initSpectro(w: number, h: number, _fftBins: number): void {\n    if (\n      this.spectroCanvas &&\n      this.lastCanvasWidth === w &&\n      this.lastCanvasHeight === h\n    ) {\n      return;\n    }\n\n    const newCanvas = document.createElement('canvas');\n    newCanvas.width = w;\n    newCanvas.height = h;\n    const newCtx = newCanvas.getContext('2d')!;\n\n    // Fill background\n    newCtx.fillStyle = '#060a0f';\n    newCtx.fillRect(0, 0, w, h);\n\n    // Copy old content if exists\n    if (this.spectroCanvas && this.spectroCtx) {\n      newCtx.drawImage(this.spectroCanvas, 0, 0, w, h);\n    }\n\n    this.spectroCanvas = newCanvas;\n    this.spectroCtx = newCtx;\n    this.lastCanvasWidth = w;\n    this.lastCanvasHeight = h;\n  }\n\n  private getSpectroColor(value: number): string {\n    const v = Math.min(255, Math.max(0, value));\n    const hue = 240 - (v / 255) * 240;\n    const lightness = 20 + (v / 255) * 40;\n    return `hsl(${hue}, 100%, ${lightness}%)`;\n  }\n\n  private draw = (): void => {\n    this.rafId = requestAnimationFrame(this.draw);\n\n    if (!this.audio.analyserNode || !this.timeBuf || !this.freqBuf) return;\n\n    // Skip if page hidden\n    if (!this.audio.isPageVisible()) return;\n\n    // Get data\n    this.audio.getTimeDomainData(this.timeBuf);\n    this.audio.getFrequencyData(this.freqBuf);\n\n    // Calculate peak for auto-gain\n    let peak = 1e-4;\n    for (let i = 0; i < this.timeBuf.length; i++) {\n      const v = (this.timeBuf[i] - 128) / 128;\n      const a = Math.abs(v);\n      if (a > peak) peak = a;\n    }\n\n    let target = 0.85 / peak;\n    target = Math.max(0.25, Math.min(12.0, target));\n    this.scopeAutoGain += (target - this.scopeAutoGain) * 0.08;\n\n    const w = this.canvas.width;\n    const h = this.canvas.height;\n\n    // Reinit if size changed\n    if (w !== this.lastCanvasWidth || h !== this.lastCanvasHeight) {\n      this.initSpectro(w, h, this.freqBuf.length);\n    }\n\n    if (this.scopeMode === 'spectrum') {\n      this.drawSpectrum(w, h);\n    } else {\n      this.drawWave(w, h);\n    }\n  };\n\n  private drawSpectrum(w: number, h: number): void {\n    const now = performance.now();\n\n    if (now - this.lastSpectroTime >= this.SPECTRO_INTERVAL) {\n      this.lastSpectroTime = now;\n\n      if (this.spectroCtx && this.freqBuf) {\n        const shiftAmount = 2;\n        this.spectroCtx.drawImage(this.spectroCanvas!, -shiftAmount, 0);\n\n        const bins = this.freqBuf.length;\n        const minFreq = 20;\n        const maxFreq = 10000;\n        const nyquist = this.audio.sampleRate / 2;\n\n        for (let i = 0; i < h; i++) {\n          const normalizedY = i / h;\n          const freq = maxFreq * Math.pow(minFreq / maxFreq, normalizedY);\n          const binIndex = Math.floor((freq / nyquist) * bins);\n          const value = this.freqBuf[Math.min(binIndex, bins - 1)];\n          this.spectroCtx.fillStyle = this.getSpectroColor(value);\n          this.spectroCtx.fillRect(w - shiftAmount, i, shiftAmount, 1);\n        }\n      }\n    }\n\n    if (this.spectroCtx) {\n      this.ctx.drawImage(this.spectroCanvas!, 0, 0);\n    } else {\n      this.ctx.fillStyle = '#060a0f';\n      this.ctx.fillRect(0, 0, w, h);\n    }\n  }\n\n  private drawWave(w: number, h: number): void {\n    // Dark background\n    this.ctx.fillStyle = '#060a0f';\n    this.ctx.fillRect(0, 0, w, h);\n\n    // Grid\n    this.ctx.strokeStyle = 'rgba(18, 32, 51, 0.7)';\n    this.ctx.lineWidth = 1;\n    this.ctx.beginPath();\n    for (let i = 1; i < 10; i++) {\n      const x = (w * i) / 10;\n      this.ctx.moveTo(x, 0);\n      this.ctx.lineTo(x, h);\n    }\n    for (let i = 1; i < 5; i++) {\n      const y = (h * i) / 5;\n      this.ctx.moveTo(0, y);\n      this.ctx.lineTo(w, y);\n    }\n    this.ctx.stroke();\n\n    // Waveform\n    if (!this.timeBuf) return;\n\n    const mid = h / 2;\n    this.ctx.strokeStyle = '#8ab4ff';\n    this.ctx.lineWidth = 2;\n    this.ctx.beginPath();\n\n    const gain = this.scopeAutoGain;\n    for (let i = 0; i < this.timeBuf.length; i++) {\n      const v = (this.timeBuf[i] - 128) / 128;\n      const y = mid - v * (mid * 0.9) * gain;\n      const x = (w * i) / (this.timeBuf.length - 1);\n      if (i === 0) {\n        this.ctx.moveTo(x, y);\n      } else {\n        this.ctx.lineTo(x, y);\n      }\n    }\n    this.ctx.stroke();\n  }\n}\n","/**\n * Rotary Knob Component\n * A synthesizer-style rotary control with SVG rendering\n */\n\nexport type KnobSize = 'sm' | 'md' | 'lg';\n\nexport interface KnobOptions {\n  id: string;\n  min: number;\n  max: number;\n  step: number;\n  value: number;\n  size?: KnobSize;\n  label?: string;\n  showTicks?: boolean;\n  onChange?: (value: number) => void;\n}\n\n// Size configurations\nconst SIZE_CONFIG: Record<KnobSize, { diameter: number; fontSize: number; labelSize: number }> = {\n  sm: { diameter: 40, fontSize: 10, labelSize: 8 },\n  md: { diameter: 56, fontSize: 11, labelSize: 9 },\n  lg: { diameter: 72, fontSize: 13, labelSize: 10 },\n};\n\n// Rotation range: -135 (7 o'clock) to +135 (5 o'clock) = 270 degrees\nconst MIN_ANGLE = -135;\nconst MAX_ANGLE = 135;\nconst ANGLE_RANGE = MAX_ANGLE - MIN_ANGLE;\n\n// Drag sensitivity (degrees per pixel)\nconst SENSITIVITY = {\n  normal: 1.5,\n  fine: 0.15, // With Shift key\n};\n\n/**\n * Convert normalized value (0-1) to rotation angle\n */\nfunction valueToAngle(normalized: number): number {\n  return MIN_ANGLE + normalized * ANGLE_RANGE;\n}\n\n/**\n * Convert rotation angle to normalized value (0-1)\n */\nfunction angleToValue(angle: number): number {\n  const clamped = Math.max(MIN_ANGLE, Math.min(MAX_ANGLE, angle));\n  return (clamped - MIN_ANGLE) / ANGLE_RANGE;\n}\n\n/**\n * Format value for display (max 2 decimal places, smart formatting)\n */\nfunction formatValue(value: number): string {\n  if (Number.isInteger(value)) return String(value);\n  if (Math.abs(value) >= 100) return String(Math.round(value));\n  if (Math.abs(value) >= 10) return value.toFixed(1);\n  return value.toFixed(2);\n}\n\n/**\n * Format tick label (shorter format for min/mid/max)\n */\nfunction formatTickLabel(value: number): string {\n  if (Number.isInteger(value)) return String(value);\n  if (Math.abs(value) >= 100) return String(Math.round(value));\n  if (Math.abs(value) >= 10) return value.toFixed(1);\n  if (Math.abs(value) >= 1) return value.toFixed(1);\n  return value.toFixed(2);\n}\n\n/**\n * Create a knob component\n */\nexport function createKnob(options: KnobOptions): HTMLElement {\n  const {\n    id,\n    min,\n    max,\n    step,\n    value,\n    size = 'md',\n    label,\n    showTicks = true,\n    onChange,\n  } = options;\n\n  const config = SIZE_CONFIG[size];\n  const midValue = (min + max) / 2;\n\n  // Create wrapper\n  const wrapper = document.createElement('div');\n  wrapper.className = `knob-wrap knob-${size}`;\n  wrapper.dataset.knobId = id;\n\n  // Create label (if provided)\n  const labelHtml = label ? `<div class=\"knob-label\">${label}</div>` : '';\n\n  // Calculate initial angle\n  const normalized = (value - min) / (max - min);\n  const angle = valueToAngle(normalized);\n\n  // SVG viewBox is 100x100 for easy calculations\n  const svgContent = createKnobSVG(angle, min, midValue, max, showTicks);\n\n  wrapper.innerHTML = `\n    ${labelHtml}\n    <div class=\"knob-value\" id=\"${id}_display\">${formatValue(value)}</div>\n    <div class=\"knob-container\">\n      ${svgContent}\n      ${showTicks ? `\n        <span class=\"knob-tick-label knob-tick-min\">${formatTickLabel(min)}</span>\n        <span class=\"knob-tick-label knob-tick-mid\">${formatTickLabel(midValue)}</span>\n        <span class=\"knob-tick-label knob-tick-max\">${formatTickLabel(max)}</span>\n      ` : ''}\n    </div>\n  `;\n\n  // Store state on element\n  const state = {\n    value,\n    min,\n    max,\n    step,\n    defaultValue: value,\n    isDragging: false,\n    startY: 0,\n    startValue: 0,\n  };\n\n  // Get elements\n  const svg = wrapper.querySelector('svg')!;\n  const indicator = svg.querySelector('.knob-indicator') as SVGLineElement;\n  const valueDisplay = wrapper.querySelector('.knob-value')!;\n\n  // Update function\n  const updateKnobValue = (newValue: number, fireChange = true) => {\n    // Clamp and snap to step\n    newValue = Math.max(min, Math.min(max, newValue));\n    newValue = Math.round(newValue / step) * step;\n    // Fix floating point issues\n    newValue = Number(newValue.toFixed(10));\n\n    if (newValue === state.value) return;\n\n    state.value = newValue;\n    const normalized = (newValue - min) / (max - min);\n    const angle = valueToAngle(normalized);\n\n    // Update indicator rotation\n    indicator.setAttribute('transform', `rotate(${angle}, 50, 50)`);\n    valueDisplay.textContent = formatValue(newValue);\n\n    if (fireChange && onChange) {\n      onChange(newValue);\n    }\n  };\n\n  // Mouse/touch drag handling\n  const handleDragStart = (e: MouseEvent | TouchEvent) => {\n    e.preventDefault();\n    state.isDragging = true;\n    state.startY = 'touches' in e ? e.touches[0].clientY : e.clientY;\n    state.startValue = state.value;\n    wrapper.classList.add('dragging');\n    document.body.style.cursor = 'ns-resize';\n  };\n\n  const handleDragMove = (e: MouseEvent | TouchEvent) => {\n    if (!state.isDragging) return;\n\n    const clientY = 'touches' in e ? e.touches[0].clientY : e.clientY;\n    const deltaY = state.startY - clientY; // Inverted: up = increase\n\n    const sensitivity = (e as MouseEvent).shiftKey ? SENSITIVITY.fine : SENSITIVITY.normal;\n    const deltaAngle = deltaY * sensitivity;\n    const deltaValue = (deltaAngle / ANGLE_RANGE) * (max - min);\n\n    updateKnobValue(state.startValue + deltaValue);\n  };\n\n  const handleDragEnd = () => {\n    if (!state.isDragging) return;\n    state.isDragging = false;\n    wrapper.classList.remove('dragging');\n    document.body.style.cursor = '';\n  };\n\n  // Double-click to reset\n  const handleDoubleClick = () => {\n    updateKnobValue(state.defaultValue);\n  };\n\n  // Mouse wheel support\n  const handleWheel = (e: WheelEvent) => {\n    e.preventDefault();\n    const sensitivity = e.shiftKey ? 0.1 : 1;\n    const delta = -Math.sign(e.deltaY) * step * sensitivity * 5;\n    updateKnobValue(state.value + delta);\n  };\n\n  // Attach events\n  svg.addEventListener('mousedown', handleDragStart);\n  svg.addEventListener('touchstart', handleDragStart, { passive: false });\n  svg.addEventListener('dblclick', handleDoubleClick);\n  svg.addEventListener('wheel', handleWheel, { passive: false });\n\n  document.addEventListener('mousemove', handleDragMove);\n  document.addEventListener('touchmove', handleDragMove, { passive: false });\n  document.addEventListener('mouseup', handleDragEnd);\n  document.addEventListener('touchend', handleDragEnd);\n\n  // Store update function and state for external access\n  (wrapper as any)._knobState = state;\n  (wrapper as any)._updateValue = updateKnobValue;\n\n  return wrapper;\n}\n\n/**\n * Create the SVG markup for a knob\n */\nfunction createKnobSVG(\n  angle: number,\n  min: number,\n  mid: number,\n  max: number,\n  showTicks: boolean\n): string {\n  // Tick positions (on the circle at radius 42, viewBox is 100x100 centered at 50,50)\n  const tickMarkup = showTicks\n    ? `\n      <!-- Tick marks -->\n      <line class=\"knob-tick\" x1=\"18\" y1=\"82\" x2=\"24\" y2=\"76\" />\n      <line class=\"knob-tick\" x1=\"50\" y1=\"8\" x2=\"50\" y2=\"16\" />\n      <line class=\"knob-tick\" x1=\"82\" y1=\"82\" x2=\"76\" y2=\"76\" />\n    `\n    : '';\n\n  return `\n    <svg class=\"knob-svg\" viewBox=\"0 0 100 100\">\n      <!-- Outer ring / track -->\n      <circle class=\"knob-track\" cx=\"50\" cy=\"50\" r=\"42\" />\n\n      <!-- Main knob body -->\n      <circle class=\"knob-body\" cx=\"50\" cy=\"50\" r=\"36\" />\n\n      <!-- Inner shadow/highlight -->\n      <circle class=\"knob-inner\" cx=\"50\" cy=\"50\" r=\"28\" />\n\n      ${tickMarkup}\n\n      <!-- Indicator line -->\n      <line\n        class=\"knob-indicator\"\n        x1=\"50\" y1=\"50\"\n        x2=\"50\" y2=\"20\"\n        transform=\"rotate(${angle}, 50, 50)\"\n      />\n\n      <!-- Center dot -->\n      <circle class=\"knob-center\" cx=\"50\" cy=\"50\" r=\"4\" />\n    </svg>\n  `;\n}\n\n/**\n * Update a knob's value programmatically\n */\nexport function updateKnob(knob: HTMLElement, value: number): void {\n  const updateFn = (knob as any)._updateValue;\n  if (updateFn) {\n    updateFn(value, false); // Don't fire onChange for programmatic updates\n  }\n}\n\n/**\n * Get the current value of a knob\n */\nexport function getKnobValue(knob: HTMLElement): number {\n  const state = (knob as any)._knobState;\n  return state ? state.value : 0;\n}\n","import { fmt } from '../dom';\nimport { createKnob, updateKnob, type KnobSize } from './Knob';\nimport type { FormulaConfig } from '../../types';\n\nexport interface FormulaCardCallbacks {\n  onEnable: (id: string, enabled: boolean) => void;\n  onParamChange: (id: string, param: string, value: number) => void;\n  onReset: (id: string) => void;\n}\n\n/**\n * Determine knob size based on parameter type\n * - Gain parameters get large knobs (most important)\n * - Frequency parameters get medium knobs\n * - Other parameters get small knobs\n */\nfunction getKnobSize(paramKey: string): KnobSize {\n  if (paramKey === 'gain') return 'lg';\n  if (paramKey.includes('freq') || paramKey.includes('Freq') || paramKey === 'f' || paramKey === 'fc' || paramKey === 'fm' || paramKey === 'f0' || paramKey === 'fbeat' || paramKey === 'fd' || paramKey === 'fq') return 'md';\n  return 'sm';\n}\n\n/**\n * Creates the UI for a single formula card\n */\nexport function createFormulaCard(\n  formula: FormulaConfig,\n  callbacks: FormulaCardCallbacks\n): HTMLElement {\n  const wrap = document.createElement('div');\n  wrap.className = 'formula';\n  wrap.dataset.formulaId = formula.id;\n\n  const resetHtml = formula.hasReset\n    ? `\n      <div class=\"sep\"></div>\n      <div class=\"row\">\n        <button id=\"reset_${formula.id}\" disabled>Reset state</button>\n      </div>`\n    : '';\n\n  wrap.innerHTML = `\n    <div class=\"fhead\">\n      <div>\n        <h3>\n          <input type=\"checkbox\" id=\"en_${formula.id}\">\n          ${formula.title}\n        </h3>\n        <div class=\"small\">${formula.desc}</div>\n      </div>\n      <div class=\"factions\">\n        <button class=\"collapseBtn\" id=\"col_${formula.id}\" type=\"button\">▼</button>\n      </div>\n    </div>\n\n    <div class=\"fbody\" id=\"body_${formula.id}\">\n      <div class=\"knobs-grid\" id=\"knobs_${formula.id}\"></div>${resetHtml}\n    </div>\n  `;\n\n  const knobsHost = wrap.querySelector(`#knobs_${formula.id}`)!;\n\n  // Create knobs for each slider parameter\n  for (const s of formula.sliders) {\n    const knobId = `${formula.id}_${s.k}`;\n    const size = getKnobSize(s.k);\n\n    const knob = createKnob({\n      id: knobId,\n      min: s.min,\n      max: s.max,\n      step: s.step,\n      value: s.value,\n      size,\n      label: s.name,\n      showTicks: size !== 'sm', // Hide ticks on small knobs\n      onChange: (value) => {\n        callbacks.onParamChange(formula.id, s.k, value);\n      },\n    });\n\n    knobsHost.appendChild(knob);\n  }\n\n  // Wire up events\n  const enableCheckbox = wrap.querySelector<HTMLInputElement>(\n    `#en_${formula.id}`\n  )!;\n  const collapseBtn = wrap.querySelector(`#col_${formula.id}`)!;\n  const body = wrap.querySelector(`#body_${formula.id}`)!;\n  const resetBtn = wrap.querySelector<HTMLButtonElement>(\n    `#reset_${formula.id}`\n  );\n\n  // Enable/disable\n  enableCheckbox.addEventListener('change', () => {\n    callbacks.onEnable(formula.id, enableCheckbox.checked);\n  });\n\n  // Collapse/expand\n  collapseBtn.addEventListener('click', () => {\n    const collapsed = !body.classList.contains('collapsed');\n    body.classList.toggle('collapsed', collapsed);\n    collapseBtn.textContent = collapsed ? '▶' : '▼';\n  });\n\n  // Reset\n  if (resetBtn) {\n    resetBtn.addEventListener('click', () => {\n      callbacks.onReset(formula.id);\n    });\n  }\n\n  return wrap;\n}\n\n/**\n * Update formula card state\n */\nexport function updateFormulaCard(\n  container: HTMLElement,\n  id: string,\n  enabled: boolean,\n  params: Record<string, number>\n): void {\n  const card = container.querySelector(`[data-formula-id=\"${id}\"]`);\n  if (!card) return;\n\n  const enableCheckbox = card.querySelector<HTMLInputElement>(`#en_${id}`);\n  if (enableCheckbox) {\n    enableCheckbox.checked = enabled;\n  }\n\n  // Update active highlight\n  card.classList.toggle('active', enabled);\n\n  // Update knobs\n  for (const [key, value] of Object.entries(params)) {\n    const knob = card.querySelector(`[data-knob-id=\"${id}_${key}\"]`) as HTMLElement;\n    if (knob) {\n      updateKnob(knob, value);\n    }\n  }\n\n  // Update reset button\n  const resetBtn = card.querySelector<HTMLButtonElement>(`#reset_${id}`);\n  if (resetBtn) {\n    resetBtn.disabled = !enabled;\n  }\n\n  // Auto-collapse/expand based on enabled state\n  const body = card.querySelector(`#body_${id}`);\n  const colBtn = card.querySelector(`#col_${id}`);\n  if (body && colBtn) {\n    if (enabled && body.classList.contains('collapsed')) {\n      body.classList.remove('collapsed');\n      colBtn.textContent = '▼';\n    } else if (!enabled && !body.classList.contains('collapsed')) {\n      body.classList.add('collapsed');\n      colBtn.textContent = '▶';\n    }\n  }\n}\n","import { AudioEngine } from './audio';\nimport { StateManager } from './state';\nimport { FORMULAS, PRESETS, DEFAULT_FX } from './config';\nimport { Oscilloscope, createFormulaCard, updateFormulaCard, createKnob, updateKnob, getKnobValue } from './ui';\nimport { $, $require } from './ui/dom';\nimport type { AppState, EffectsState } from './types';\n\nimport './styles/main.css';\n\n// FX knob configurations\ninterface FxKnobConfig {\n  id: string;\n  label: string;\n  min: number;\n  max: number;\n  step: number;\n  value: number;\n  stateKey: keyof EffectsState;\n}\n\nconst FX_KNOBS: Record<string, FxKnobConfig[]> = {\n  filter: [\n    { id: 'fxFilterFreq', label: 'Cutoff', min: 20, max: 2000, step: 1, value: 1000, stateKey: 'filterFreq' },\n    { id: 'fxFilterQ', label: 'Q', min: 0.1, max: 30, step: 0.1, value: 0.7, stateKey: 'filterQ' },\n  ],\n  chorus: [\n    { id: 'fxChorusRate', label: 'Rate', min: 0.01, max: 8, step: 0.01, value: 0.35, stateKey: 'chorusRate' },\n    { id: 'fxChorusDepth', label: 'Depth', min: 0, max: 20, step: 0.1, value: 6, stateKey: 'chorusDepth' },\n    { id: 'fxChorusMix', label: 'Mix', min: 0, max: 1, step: 0.01, value: 0.35, stateKey: 'chorusMix' },\n    { id: 'fxChorusFb', label: 'Feedback', min: 0, max: 0.95, step: 0.01, value: 0.15, stateKey: 'chorusFb' },\n  ],\n  reverb: [\n    { id: 'fxReverbDecay', label: 'Decay', min: 0.1, max: 8, step: 0.1, value: 2.8, stateKey: 'reverbDecay' },\n    { id: 'fxReverbMix', label: 'Mix', min: 0, max: 1, step: 0.01, value: 0.25, stateKey: 'reverbMix' },\n  ],\n  limiter: [\n    { id: 'fxLimiterThr', label: 'Threshold', min: -40, max: 0, step: 0.5, value: -12, stateKey: 'limiterThr' },\n    { id: 'fxLimiterRel', label: 'Release', min: 0.02, max: 1, step: 0.01, value: 0.15, stateKey: 'limiterRel' },\n  ],\n  delay: [\n    { id: 'fxDelayTime', label: 'Time', min: 0.05, max: 2.0, step: 0.01, value: 0.35, stateKey: 'delayTime' },\n    { id: 'fxDelayFb', label: 'Feedback', min: 0, max: 0.9, step: 0.01, value: 0.4, stateKey: 'delayFb' },\n    { id: 'fxDelayMix', label: 'Mix', min: 0, max: 1, step: 0.01, value: 0.3, stateKey: 'delayMix' },\n  ],\n  phaser: [\n    { id: 'fxPhaserRate', label: 'Rate', min: 0.1, max: 10, step: 0.01, value: 0.5, stateKey: 'phaserRate' },\n    { id: 'fxPhaserDepth', label: 'Depth', min: 0, max: 1, step: 0.01, value: 0.7, stateKey: 'phaserDepth' },\n    { id: 'fxPhaserFb', label: 'Feedback', min: 0, max: 0.9, step: 0.01, value: 0.3, stateKey: 'phaserFb' },\n    { id: 'fxPhaserMix', label: 'Mix', min: 0, max: 1, step: 0.01, value: 0.5, stateKey: 'phaserMix' },\n  ],\n};\n\n/**\n * Main application entry point\n */\nasync function main(): Promise<void> {\n  // Initialize managers\n  const audio = new AudioEngine();\n  const state = new StateManager();\n\n  // Store references to created knobs\n  const fxKnobs: Map<string, HTMLElement> = new Map();\n  let masterGainKnob: HTMLElement | null = null;\n\n  // DOM elements\n  const statusEl = $require('#status');\n  const playStopBtn = $require<HTMLButtonElement>('#playStopBtn');\n  const recBtn = $require<HTMLButtonElement>('#recBtn');\n  const savePresetBtn = $require<HTMLButtonElement>('#savePresetBtn');\n  const loadPresetBtn = $require<HTMLButtonElement>('#loadPresetBtn');\n  const shareBtn = $require<HTMLButtonElement>('#shareBtn');\n  const presetSelect = $require<HTMLSelectElement>('#presetSelect');\n  const scopeToggleBtn = $require<HTMLButtonElement>('#scopeToggleBtn');\n  const scopeModeBtn = $require<HTMLButtonElement>('#scopeModeBtn');\n  const effectsBtn = $require<HTMLButtonElement>('#effectsBtn');\n  const scopeWrap = $require('#scopeWrap');\n  const effectsPanel = $require('#effectsPanel');\n  const masterGainWrap = $require('#masterGainWrap');\n  const formulasRoot = $require('#formulas');\n  const disableAllBtn = $require<HTMLButtonElement>('#disableAllBtn');\n  const collapseAllBtn = $require<HTMLButtonElement>('#collapseAllBtn');\n  const helpOverlay = $require('#helpOverlay');\n  const helpBtn = $require<HTMLButtonElement>('#helpBtn');\n  const helpCloseBtn = $require<HTMLButtonElement>('#helpCloseBtn');\n  const canvas = $require<HTMLCanvasElement>('#scope');\n\n  // Oscilloscope\n  let oscilloscope: Oscilloscope | null = null;\n\n  // Track collapse state\n  let allCollapsed = false;\n\n  // =========== Create Master Gain Knob ===========\n\n  masterGainKnob = createKnob({\n    id: 'masterGain',\n    min: 0,\n    max: 1,\n    step: 0.001,\n    value: 0.25,\n    size: 'lg',\n    label: 'Master Volume',\n    showTicks: true,\n    onChange: (v) => {\n      audio.setMasterGain(v);\n    },\n  });\n  masterGainWrap.appendChild(masterGainKnob);\n\n  // =========== Create FX Knobs ===========\n\n  function createFxKnobs(): void {\n    for (const [section, knobs] of Object.entries(FX_KNOBS)) {\n      const container = $(`#${section}Knobs`);\n      if (!container) continue;\n\n      for (const cfg of knobs) {\n        const knob = createKnob({\n          id: cfg.id,\n          min: cfg.min,\n          max: cfg.max,\n          step: cfg.step,\n          value: cfg.value,\n          size: 'sm',\n          label: cfg.label,\n          showTicks: false,\n          onChange: () => {\n            if (audio.isRunning) {\n              audio.updateEffectParams(readFXFromUI());\n            }\n          },\n        });\n        container.appendChild(knob);\n        fxKnobs.set(cfg.id, knob);\n      }\n    }\n  }\n\n  createFxKnobs();\n\n  // =========== UI State Reading ===========\n\n  function readStateFromUI(): AppState {\n    const formulas: Record<string, { enabled: boolean; params: Record<string, number> }> = {};\n\n    for (const f of FORMULAS) {\n      const enableEl = $<HTMLInputElement>(`#en_${f.id}`);\n      const enabled = enableEl?.checked ?? false;\n      const params: Record<string, number> = {};\n\n      for (const s of f.sliders) {\n        const knob = document.querySelector(`[data-knob-id=\"${f.id}_${s.k}\"]`) as HTMLElement;\n        params[s.k] = knob ? getKnobValue(knob) : s.value;\n      }\n\n      formulas[f.id] = { enabled, params };\n    }\n\n    const masterGainValue = masterGainKnob ? getKnobValue(masterGainKnob) : 0.25;\n\n    return {\n      v: 2,\n      masterGain: masterGainValue,\n      fx: readFXFromUI(),\n      formulas,\n    };\n  }\n\n  function readFXFromUI(): EffectsState {\n    const getKnobVal = (id: string, defaultVal: number): number => {\n      const knob = fxKnobs.get(id);\n      return knob ? getKnobValue(knob) : defaultVal;\n    };\n\n    return {\n      filterOn: ($<HTMLInputElement>('#fxFilterOn')?.checked) ?? false,\n      filterType: ($<HTMLSelectElement>('#fxFilterType')?.value as BiquadFilterType) ?? 'lowpass',\n      filterFreq: getKnobVal('fxFilterFreq', 1000),\n      filterQ: getKnobVal('fxFilterQ', 0.7),\n      chorusOn: ($<HTMLInputElement>('#fxChorusOn')?.checked) ?? false,\n      chorusMode: ($<HTMLSelectElement>('#fxChorusMode')?.value as 'chorus' | 'flanger') ?? 'chorus',\n      chorusRate: getKnobVal('fxChorusRate', 0.35),\n      chorusDepth: getKnobVal('fxChorusDepth', 6),\n      chorusMix: getKnobVal('fxChorusMix', 0.35),\n      chorusFb: getKnobVal('fxChorusFb', 0.15),\n      reverbOn: ($<HTMLInputElement>('#fxReverbOn')?.checked) ?? false,\n      reverbDecay: getKnobVal('fxReverbDecay', 2.8),\n      reverbMix: getKnobVal('fxReverbMix', 0.25),\n      limiterOn: ($<HTMLInputElement>('#fxLimiterOn')?.checked) ?? false,\n      limiterThr: getKnobVal('fxLimiterThr', -12),\n      limiterRel: getKnobVal('fxLimiterRel', 0.15),\n      delayOn: ($<HTMLInputElement>('#fxDelayOn')?.checked) ?? false,\n      delayTime: getKnobVal('fxDelayTime', 0.35),\n      delayFb: getKnobVal('fxDelayFb', 0.4),\n      delayMix: getKnobVal('fxDelayMix', 0.3),\n      phaserOn: ($<HTMLInputElement>('#fxPhaserOn')?.checked) ?? false,\n      phaserRate: getKnobVal('fxPhaserRate', 0.5),\n      phaserDepth: getKnobVal('fxPhaserDepth', 0.7),\n      phaserStages: Number($<HTMLSelectElement>('#fxPhaserStages')?.value ?? 4),\n      phaserFb: getKnobVal('fxPhaserFb', 0.3),\n      phaserMix: getKnobVal('fxPhaserMix', 0.5),\n    };\n  }\n\n  // =========== UI State Application ===========\n\n  function applyStateToUI(appState: AppState, resetFirst = false): void {\n    if (resetFirst) {\n      resetToDefaults();\n    }\n\n    // Master gain\n    if (masterGainKnob) {\n      updateKnob(masterGainKnob, appState.masterGain);\n    }\n\n    // Effects\n    applyFXToUI(appState.fx);\n\n    // Formulas\n    for (const f of FORMULAS) {\n      const formulaState = appState.formulas?.[f.id];\n      if (!formulaState) continue;\n\n      updateFormulaCard(\n        formulasRoot,\n        f.id,\n        formulaState.enabled,\n        formulaState.params\n      );\n    }\n  }\n\n  function applyFXToUI(fx: Partial<EffectsState>): void {\n    const setVal = (id: string, val: unknown) => {\n      const el = $<HTMLSelectElement>(id);\n      if (el && val !== undefined) el.value = String(val);\n    };\n    const setChk = (id: string, val: unknown) => {\n      const el = $<HTMLInputElement>(id);\n      if (el && val !== undefined) el.checked = Boolean(val);\n    };\n    const setKnob = (id: string, val: unknown) => {\n      const knob = fxKnobs.get(id);\n      if (knob && val !== undefined) updateKnob(knob, Number(val));\n    };\n\n    // Checkboxes\n    setChk('#fxFilterOn', fx.filterOn);\n    setChk('#fxChorusOn', fx.chorusOn);\n    setChk('#fxReverbOn', fx.reverbOn);\n    setChk('#fxLimiterOn', fx.limiterOn);\n    setChk('#fxDelayOn', fx.delayOn);\n    setChk('#fxPhaserOn', fx.phaserOn);\n\n    // Selects\n    setVal('#fxFilterType', fx.filterType);\n    setVal('#fxChorusMode', fx.chorusMode);\n    setVal('#fxPhaserStages', fx.phaserStages);\n\n    // Knobs\n    setKnob('fxFilterFreq', fx.filterFreq);\n    setKnob('fxFilterQ', fx.filterQ);\n    setKnob('fxChorusRate', fx.chorusRate);\n    setKnob('fxChorusDepth', fx.chorusDepth);\n    setKnob('fxChorusMix', fx.chorusMix);\n    setKnob('fxChorusFb', fx.chorusFb);\n    setKnob('fxReverbDecay', fx.reverbDecay);\n    setKnob('fxReverbMix', fx.reverbMix);\n    setKnob('fxLimiterThr', fx.limiterThr);\n    setKnob('fxLimiterRel', fx.limiterRel);\n    setKnob('fxDelayTime', fx.delayTime);\n    setKnob('fxDelayFb', fx.delayFb);\n    setKnob('fxDelayMix', fx.delayMix);\n    setKnob('fxPhaserRate', fx.phaserRate);\n    setKnob('fxPhaserDepth', fx.phaserDepth);\n    setKnob('fxPhaserFb', fx.phaserFb);\n    setKnob('fxPhaserMix', fx.phaserMix);\n  }\n\n  function resetToDefaults(): void {\n    if (masterGainKnob) {\n      updateKnob(masterGainKnob, 0.25);\n    }\n    applyFXToUI(DEFAULT_FX);\n\n    for (const f of FORMULAS) {\n      const params: Record<string, number> = {};\n      for (const s of f.sliders) {\n        params[s.k] = s.value;\n      }\n      updateFormulaCard(formulasRoot, f.id, false, params);\n    }\n  }\n\n  // =========== Audio Control ===========\n\n  async function startAudio(): Promise<void> {\n    const currentState = readStateFromUI();\n    await audio.start(currentState);\n\n    statusEl.textContent = 'running';\n    playStopBtn.textContent = '⏹ Stop';\n    playStopBtn.classList.add('playing');\n    recBtn.disabled = false;\n\n    // Start oscilloscope\n    oscilloscope = new Oscilloscope(canvas, audio);\n    oscilloscope.start();\n  }\n\n  async function stopAudio(): Promise<void> {\n    oscilloscope?.stop();\n    oscilloscope = null;\n\n    await audio.stop();\n\n    statusEl.textContent = 'stopped';\n    playStopBtn.textContent = '▶ Play';\n    playStopBtn.classList.remove('playing');\n    recBtn.disabled = true;\n    recBtn.textContent = 'Record';\n    recBtn.classList.remove('recording');\n  }\n\n  async function toggleAudio(): Promise<void> {\n    if (audio.isRunning) {\n      await stopAudio();\n    } else {\n      await startAudio();\n    }\n  }\n\n  // =========== Recording ===========\n\n  async function toggleRecording(): Promise<void> {\n    if (!audio.isRunning) {\n      statusEl.textContent = 'start audio first';\n      return;\n    }\n\n    if (!audio.isRecording) {\n      audio.startRecording();\n      recBtn.textContent = '● REC';\n      recBtn.classList.add('recording');\n      statusEl.textContent = 'recording…';\n    } else {\n      recBtn.disabled = true;\n      recBtn.classList.remove('recording');\n      statusEl.textContent = 'finalizing…';\n\n      const result = await audio.stopRecording();\n      if (result) {\n        const { blob, filename } = result;\n\n        // Try sharing on mobile\n        const file = new File([blob], filename, { type: 'audio/wav' });\n        const canShare =\n          'share' in navigator &&\n          navigator.canShare?.({ files: [file] });\n\n        if (canShare) {\n          try {\n            await navigator.share({ files: [file], title: 'Formula Audio Recording' });\n            statusEl.textContent = 'shared';\n          } catch (err) {\n            if ((err as Error).name !== 'AbortError') {\n              downloadBlob(blob, filename);\n            }\n          }\n        } else {\n          downloadBlob(blob, filename);\n        }\n      }\n\n      recBtn.disabled = false;\n      recBtn.textContent = 'Record';\n    }\n  }\n\n  function downloadBlob(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    a.click();\n    statusEl.innerHTML = `ready — <a href=\"${url}\" download=\"${filename}\" style=\"color:#8ab4ff;\">download</a>`;\n  }\n\n  // =========== Scope ===========\n\n  function setScopeCollapsed(collapsed: boolean): void {\n    scopeWrap.classList.toggle('scopeCollapsed', collapsed);\n    scopeToggleBtn.classList.toggle('active', !collapsed);\n    if (!collapsed) {\n      setTimeout(() => oscilloscope?.resize(), 0);\n    }\n  }\n\n  // =========== Help ===========\n\n  function openHelp(): void {\n    helpOverlay.classList.add('open');\n  }\n\n  function closeHelp(): void {\n    helpOverlay.classList.remove('open');\n    state.markHelpShown();\n  }\n\n  // =========== Build UI ===========\n\n  // Build formula cards\n  for (const f of FORMULAS) {\n    const card = createFormulaCard(f, {\n      onEnable: async (id, enabled) => {\n        // Auto-start audio if enabling\n        if (enabled && !audio.isRunning) {\n          await startAudio();\n        }\n\n        if (audio.isRunning) {\n          audio.enableFormula(id, enabled);\n          updateFormulaCard(\n            formulasRoot,\n            id,\n            enabled,\n            readStateFromUI().formulas[id].params\n          );\n        }\n      },\n      onParamChange: (id, param, value) => {\n        if (audio.isRunning) {\n          audio.updateFormulaParam(id, param, value);\n\n          // Update gain node if gain changed\n          if (param === 'gain') {\n            const enableEl = $<HTMLInputElement>(`#en_${id}`);\n            if (enableEl?.checked) {\n              audio.enableFormula(id, true);\n            }\n          }\n        }\n      },\n      onReset: (id) => {\n        if (audio.isRunning) {\n          audio.resetFormula(id);\n        }\n      },\n    });\n    formulasRoot.appendChild(card);\n  }\n\n  // Populate presets dropdown\n  for (let i = 0; i < PRESETS.length; i++) {\n    const opt = document.createElement('option');\n    opt.value = String(i);\n    opt.textContent = PRESETS[i].name;\n    presetSelect.appendChild(opt);\n  }\n\n  // =========== Event Wiring ===========\n\n  // Play/Stop\n  playStopBtn.addEventListener('click', toggleAudio);\n\n  // Recording\n  recBtn.addEventListener('click', toggleRecording);\n\n  // Disable all\n  disableAllBtn.addEventListener('click', () => {\n    for (const f of FORMULAS) {\n      audio.enableFormula(f.id, false);\n      updateFormulaCard(formulasRoot, f.id, false, readStateFromUI().formulas[f.id].params);\n    }\n  });\n\n  // Collapse all\n  collapseAllBtn.addEventListener('click', () => {\n    allCollapsed = !allCollapsed;\n    for (const f of FORMULAS) {\n      const body = $(`#body_${f.id}`);\n      const colBtn = $(`#col_${f.id}`);\n      body?.classList.toggle('collapsed', allCollapsed);\n      if (colBtn) colBtn.textContent = allCollapsed ? '▶' : '▼';\n    }\n    collapseAllBtn.textContent = allCollapsed ? '▶ Expand all' : '▼ Collapse all';\n  });\n\n  // Scope toggle\n  scopeToggleBtn.addEventListener('click', () => {\n    setScopeCollapsed(!scopeWrap.classList.contains('scopeCollapsed'));\n  });\n\n  // Scope mode toggle\n  scopeModeBtn.addEventListener('click', () => {\n    if (oscilloscope) {\n      const mode = oscilloscope.toggleMode();\n      scopeModeBtn.textContent = mode === 'wave' ? 'Wave' : 'Spectrum';\n    }\n  });\n\n  // Effects panel\n  effectsBtn.addEventListener('click', () => {\n    const open = !effectsPanel.classList.contains('open');\n    effectsPanel.classList.toggle('open', open);\n    effectsBtn.classList.toggle('active', open);\n    setScopeCollapsed(open);\n  });\n\n  // FX routing changes (checkboxes)\n  const fxRoutingInputs = [\n    'fxFilterOn', 'fxChorusOn', 'fxReverbOn',\n    'fxLimiterOn', 'fxDelayOn', 'fxPhaserOn',\n  ];\n\n  for (const id of fxRoutingInputs) {\n    $(`#${id}`)?.addEventListener('change', () => {\n      if (audio.isRunning) {\n        audio.updateEffects(readFXFromUI());\n      }\n    });\n  }\n\n  // FX select changes\n  const fxSelectInputs = ['fxFilterType', 'fxChorusMode', 'fxPhaserStages'];\n  for (const id of fxSelectInputs) {\n    $(`#${id}`)?.addEventListener('change', () => {\n      if (audio.isRunning) {\n        audio.updateEffectParams(readFXFromUI());\n      }\n    });\n  }\n\n  // Presets\n  savePresetBtn.addEventListener('click', () => {\n    state.saveToStorage(readStateFromUI());\n    statusEl.textContent = 'preset saved';\n  });\n\n  loadPresetBtn.addEventListener('click', () => {\n    const preset = state.loadFromStorage();\n    if (!preset) {\n      statusEl.textContent = 'no preset';\n      return;\n    }\n    applyStateToUI(preset);\n    if (audio.isRunning) {\n      audio.updateEffects(readFXFromUI());\n    }\n    statusEl.textContent = 'preset loaded';\n  });\n\n  shareBtn.addEventListener('click', async () => {\n    const url = state.saveToURL(readStateFromUI());\n    try {\n      await navigator.clipboard.writeText(url);\n      statusEl.textContent = 'link copied';\n    } catch {\n      statusEl.textContent = 'link in URL';\n    }\n  });\n\n  presetSelect.addEventListener('change', () => {\n    const idx = presetSelect.value;\n    if (idx === '') return;\n\n    const preset = PRESETS[Number(idx)];\n    if (!preset?.state) return;\n\n    applyStateToUI(preset.state, true);\n    if (audio.isRunning) {\n      audio.updateEffects(readFXFromUI());\n    }\n    statusEl.textContent = `loaded: ${preset.name}`;\n  });\n\n  // Help\n  helpBtn.addEventListener('click', openHelp);\n  helpCloseBtn.addEventListener('click', closeHelp);\n  helpOverlay.addEventListener('click', (e) => {\n    if (e.target === helpOverlay) closeHelp();\n  });\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape' && helpOverlay.classList.contains('open')) {\n      closeHelp();\n    }\n  });\n\n  // =========== Initialization ===========\n\n  // Default scope state on mobile\n  const defaultCollapse =\n    window.matchMedia?.('(max-width: 600px)').matches ?? false;\n  setScopeCollapsed(defaultCollapse);\n\n  // Load state from URL if present\n  const urlState = state.loadFromURL();\n  if (urlState) {\n    applyStateToUI(urlState);\n  }\n\n  // Show help on first visit\n  if (!state.hasSeenHelp()) {\n    openHelp();\n  }\n}\n\n// Start app\nmain().catch(console.error);\n"],"names":["Filter","ctx","type","freq","q","Chorus","mode","baseMs","rate","depthMs","mix","fb","feedback","Reverb","seconds","decay","sr","len","buf","ch","data","i","t","env","Limiter","threshold","release","Delay","time","_Phaser","filter","lfoGain","depth","freqRange","_stages","f","Phaser","EffectsChain","state","node","chorusSum","pNode","phaserSum","delaySum","reverbSum","FORMULAS","wakeLock","requestWakeLock","err","error","releaseWakeLock","callbacks","isPageVisible","onVisibilityChange","callback","visible","cb","writeString","view","offset","str","encodeWAV","samples","sampleRate","byteRate","dataSize","buffer","s","generateWAVFilename","AudioEngine","_a","initialState","generatorUrl","recorderUrl","silentGain","initParams","stateParams","_b","worklet","gain","id","now","resolve","value","enabled","gen","targetGain","param","msg","e","blob","filename","b64urlEncode","bytes","bin","b","b64urlDecode","b64u","b64","pad","loadStateFromURL","m","json","writeStateToURL","newHash","STORAGE_KEYS","savePreset","loadPreset","raw","hasSeenHelp","markHelpShown","DEFAULT_MASTER_GAIN","DEFAULT_FX","STATE_VERSION","PRESETS","StateManager","formulas","params","partial","defaults","$","selector","$require","el","Oscilloscope","canvas","audio","peak","v","a","target","w","h","dpr","rect","analyser","_fftBins","newCanvas","newCtx","hue","lightness","bins","minFreq","maxFreq","nyquist","normalizedY","binIndex","x","y","mid","MIN_ANGLE","MAX_ANGLE","ANGLE_RANGE","SENSITIVITY","valueToAngle","normalized","formatValue","formatTickLabel","createKnob","options","min","max","step","size","label","showTicks","onChange","midValue","wrapper","labelHtml","angle","svgContent","createKnobSVG","svg","indicator","valueDisplay","updateKnobValue","newValue","fireChange","handleDragStart","handleDragMove","clientY","deltaY","sensitivity","deltaValue","handleDragEnd","handleDoubleClick","handleWheel","delta","updateKnob","knob","updateFn","getKnobValue","getKnobSize","paramKey","createFormulaCard","formula","wrap","resetHtml","knobsHost","knobId","enableCheckbox","collapseBtn","body","resetBtn","collapsed","updateFormulaCard","container","card","key","colBtn","FX_KNOBS","main","fxKnobs","masterGainKnob","statusEl","playStopBtn","recBtn","savePresetBtn","loadPresetBtn","shareBtn","presetSelect","scopeToggleBtn","scopeModeBtn","effectsBtn","scopeWrap","effectsPanel","masterGainWrap","formulasRoot","disableAllBtn","collapseAllBtn","helpOverlay","helpBtn","helpCloseBtn","oscilloscope","allCollapsed","createFxKnobs","section","knobs","cfg","readFXFromUI","readStateFromUI","enableEl","getKnobVal","defaultVal","_c","_d","_e","_f","_g","_h","_i","applyStateToUI","appState","resetFirst","resetToDefaults","applyFXToUI","formulaState","fx","setVal","val","setChk","setKnob","startAudio","currentState","stopAudio","toggleAudio","toggleRecording","result","file","downloadBlob","url","setScopeCollapsed","openHelp","closeHelp","opt","open","fxRoutingInputs","fxSelectInputs","preset","idx","defaultCollapse","urlState"],"mappings":"ssBAGO,MAAMA,EAAO,CAGlB,YAAoBC,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,KAAOA,EAAI,mBAAA,CAClB,CAEA,IAAI,OAAmB,CACrB,OAAO,KAAK,IACd,CAEA,IAAI,QAAoB,CACtB,OAAO,KAAK,IACd,CAEA,QAAQC,EAA8B,CACpC,KAAK,KAAK,KAAOA,CACnB,CAEA,aAAaC,EAAoB,CAC/B,KAAK,KAAK,UAAU,eAAeA,EAAM,KAAK,IAAI,WAAW,CAC/D,CAEA,KAAKC,EAAiB,CACpB,KAAK,KAAK,EAAE,eAAeA,EAAG,KAAK,IAAI,WAAW,CACpD,CAEA,OAAOF,EAAwBC,EAAcC,EAAiB,CAC5D,KAAK,QAAQF,CAAI,EACjB,KAAK,aAAaC,CAAI,EACtB,KAAK,KAAKC,CAAC,CACb,CAEA,YAAmB,CACjB,KAAK,KAAK,WAAA,CACZ,CACF,CCnCO,MAAMC,EAAO,CAQlB,YAAoBJ,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,MAAQA,EAAI,YAAY,EAAG,EAChC,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,aAAeA,EAAI,WAAA,EAExB,KAAK,IAAMA,EAAI,iBAAA,EACf,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,IAAI,QAAQ,KAAK,OAAO,EAC7B,KAAK,QAAQ,QAAQ,KAAK,MAAM,SAAS,EACzC,KAAK,IAAI,MAAA,CACX,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,WAAuB,CACzB,OAAO,KAAK,KACd,CAEA,IAAI,UAAqB,CACvB,OAAO,KAAK,YACd,CAEA,QAAQK,EAAkC,CACxC,MAAMC,EAASD,IAAS,UAAY,EAAM,GAC1C,KAAK,MAAM,UAAU,eAAeC,EAAS,IAAM,KAAK,IAAI,WAAW,CACzE,CAEA,QAAQC,EAAoB,CAC1B,KAAK,IAAI,UAAU,eAAeA,EAAM,KAAK,IAAI,WAAW,CAC9D,CAEA,SAASC,EAAuB,CAC9B,KAAK,QAAQ,KAAK,eAAeA,EAAU,IAAM,KAAK,IAAI,WAAW,CACvE,CAEA,OAAOC,EAAmB,CACxB,KAAK,QAAQ,KAAK,eAAe,EAAIA,EAAK,KAAK,IAAI,WAAW,EAC9D,KAAK,QAAQ,KAAK,eAAeA,EAAK,KAAK,IAAI,WAAW,CAC5D,CAEA,YAAYC,EAAkB,CAC5B,KAAK,aAAa,KAAK,eAAeA,EAAI,KAAK,IAAI,WAAW,CAChE,CAEA,OACEL,EACAE,EACAC,EACAC,EACAE,EACM,CACN,KAAK,QAAQN,CAAI,EACjB,KAAK,QAAQE,CAAI,EACjB,KAAK,SAASC,CAAO,EACrB,KAAK,OAAOC,CAAG,EACf,KAAK,YAAYE,CAAQ,CAC3B,CAEA,YAAmB,CACjB,KAAK,MAAM,WAAA,EACX,KAAK,QAAQ,WAAA,EACb,KAAK,QAAQ,WAAA,EACb,KAAK,aAAa,WAAA,CACpB,CAEA,MAAa,CACX,GAAI,CACF,KAAK,IAAI,KAAA,CACX,MAAQ,CAER,CACF,CACF,CCvFO,MAAMC,EAAO,CAKlB,YAAoBZ,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,UAAYA,EAAI,gBAAA,EACrB,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,QAAUA,EAAI,WAAA,CACrB,CAEA,IAAI,eAA+B,CACjC,OAAO,KAAK,SACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAKQ,oBAAoBa,EAAiBC,EAA4B,CACvE,MAAMC,EAAK,KAAK,IAAI,WACdC,EAAM,KAAK,IAAI,EAAG,KAAK,MAAMD,EAAKF,CAAO,CAAC,EAC1CI,EAAM,KAAK,IAAI,aAAa,EAAGD,EAAKD,CAAE,EAE5C,QAASG,EAAK,EAAGA,EAAK,EAAGA,IAAM,CAC7B,MAAMC,EAAOF,EAAI,eAAeC,CAAE,EAClC,QAASE,EAAI,EAAGA,EAAIJ,EAAKI,IAAK,CAC5B,MAAMC,EAAID,EAAIL,EACRO,EAAM,KAAK,IAAI,CAACD,EAAI,KAAK,IAAI,KAAMP,CAAK,CAAC,EAC/CK,EAAKC,CAAC,GAAK,KAAK,SAAW,EAAI,GAAKE,CACtC,CACF,CAEA,OAAOL,CACT,CAEA,SAASH,EAAqB,CAC5B,MAAMD,EAAU,KAAK,IAAI,EAAK,KAAK,IAAI,GAAKC,EAAQ,GAAG,CAAC,EACxD,KAAK,UAAU,OAAS,KAAK,oBAAoBD,EAASC,CAAK,CACjE,CAEA,OAAOL,EAAmB,CACxB,KAAK,QAAQ,KAAK,eAAe,EAAIA,EAAK,KAAK,IAAI,WAAW,EAC9D,KAAK,QAAQ,KAAK,eAAeA,EAAK,KAAK,IAAI,WAAW,CAC5D,CAEA,OAAOK,EAAeL,EAAmB,CACvC,KAAK,SAASK,CAAK,EACnB,KAAK,OAAOL,CAAG,CACjB,CAEA,YAAmB,CACjB,KAAK,UAAU,WAAA,EACf,KAAK,QAAQ,WAAA,EACb,KAAK,QAAQ,WAAA,CACf,CACF,CChEO,MAAMc,EAAQ,CAGnB,YAAoBvB,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,WAAaA,EAAI,yBAAA,EAEtB,KAAK,WAAW,MAAM,MAAQ,GAC9B,KAAK,WAAW,OAAO,MAAQ,KAC/B,KAAK,WAAW,KAAK,MAAQ,CAC/B,CAEA,IAAI,OAAmB,CACrB,OAAO,KAAK,UACd,CAEA,IAAI,QAAoB,CACtB,OAAO,KAAK,UACd,CAEA,aAAawB,EAAyB,CACpC,KAAK,WAAW,UAAU,eAAeA,EAAW,KAAK,IAAI,WAAW,CAC1E,CAEA,WAAWC,EAAuB,CAChC,KAAK,WAAW,QAAQ,eAAeA,EAAS,KAAK,IAAI,WAAW,CACtE,CAEA,OAAOD,EAAmBC,EAAuB,CAC/C,KAAK,aAAaD,CAAS,EAC3B,KAAK,WAAWC,CAAO,CACzB,CAEA,YAAmB,CACjB,KAAK,WAAW,WAAA,CAClB,CACF,CCnCO,MAAMC,EAAM,CAMjB,YAAoB1B,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,MAAQA,EAAI,YAAY,CAAG,EAChC,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,aAAeA,EAAI,WAAA,CAC1B,CAEA,IAAI,WAAuB,CACzB,OAAO,KAAK,KACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,UAAqB,CACvB,OAAO,KAAK,YACd,CAEA,QAAQ2B,EAAoB,CAC1B,KAAK,MAAM,UAAU,eAAeA,EAAM,KAAK,IAAI,WAAW,CAChE,CAEA,YAAYjB,EAAkB,CAC5B,KAAK,aAAa,KAAK,eAAeA,EAAI,KAAK,IAAI,WAAW,CAChE,CAEA,OAAOD,EAAmB,CACxB,KAAK,QAAQ,KAAK,eAAe,EAAIA,EAAK,KAAK,IAAI,WAAW,EAC9D,KAAK,QAAQ,KAAK,eAAeA,EAAK,KAAK,IAAI,WAAW,CAC5D,CAEA,OAAOkB,EAAchB,EAAkBF,EAAmB,CACxD,KAAK,QAAQkB,CAAI,EACjB,KAAK,YAAYhB,CAAQ,EACzB,KAAK,OAAOF,CAAG,CACjB,CAEA,YAAmB,CACjB,KAAK,MAAM,WAAA,EACX,KAAK,QAAQ,WAAA,EACb,KAAK,QAAQ,WAAA,EACb,KAAK,aAAa,WAAA,CACpB,CACF,CCrDO,MAAMmB,EAAN,MAAMA,CAAO,CAYlB,YAAoB5B,EAAmB,CAAnB,KAAA,IAAAA,EAXpB,KAAQ,QAA8B,CAAA,EAEtC,KAAQ,SAAuB,CAAA,EAU7B,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,QAAUA,EAAI,WAAA,EACnB,KAAK,aAAeA,EAAI,WAAA,EACxB,KAAK,UAAYA,EAAI,WAAA,EACrB,KAAK,WAAaA,EAAI,WAAA,EAEtB,KAAK,IAAMA,EAAI,iBAAA,EACf,KAAK,IAAI,KAAO,OAChB,KAAK,IAAI,MAAA,EAGT,QAASoB,EAAI,EAAGA,EAAIQ,EAAO,WAAYR,IAAK,CAC1C,MAAMS,EAAS7B,EAAI,mBAAA,EACnB6B,EAAO,KAAO,UACdA,EAAO,UAAU,MAAQ,IACzBA,EAAO,EAAE,MAAQ,GACjB,KAAK,QAAQ,KAAKA,CAAM,EAExB,MAAMC,EAAU9B,EAAI,WAAA,EACpB8B,EAAQ,KAAK,MAAQ,KACrB,KAAK,IAAI,QAAQA,CAAO,EACxBA,EAAQ,QAAQD,EAAO,SAAS,EAChC,KAAK,SAAS,KAAKC,CAAO,CAC5B,CACF,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,KAAgB,CAClB,OAAO,KAAK,OACd,CAEA,IAAI,UAAqB,CACvB,OAAO,KAAK,YACd,CAEA,IAAI,OAAkB,CACpB,OAAO,KAAK,SACd,CAEA,IAAI,QAAmB,CACrB,OAAO,KAAK,UACd,CAEA,IAAI,YAAiC,CACnC,OAAO,KAAK,OACd,CAEA,QAAQvB,EAAoB,CAC1B,KAAK,IAAI,UAAU,eAAeA,EAAM,KAAK,IAAI,WAAW,CAC9D,CAEA,SAASwB,EAAqB,CAC5B,MAAMC,EAAY,IAAOD,EACzB,QAAS,EAAI,EAAG,EAAI,KAAK,QAAQ,OAAQ,IACvC,KAAK,QAAQ,CAAC,EAAE,UAAU,eAAe,IAAM,KAAK,IAAI,WAAW,EACnE,KAAK,SAAS,CAAC,EAAE,KAAK,eAAeC,EAAW,KAAK,IAAI,WAAW,CAExE,CAEA,YAAYtB,EAAkB,CAC5B,KAAK,aAAa,KAAK,eAAeA,EAAI,KAAK,IAAI,WAAW,CAChE,CAEA,OAAOD,EAAmB,CACxB,KAAK,QAAQ,KAAK,eAAe,EAAIA,EAAK,KAAK,IAAI,WAAW,EAC9D,KAAK,QAAQ,KAAK,eAAeA,EAAK,KAAK,IAAI,WAAW,CAC5D,CAEA,OACEF,EACAwB,EACAE,EACAtB,EACAF,EACM,CACN,KAAK,QAAQF,CAAI,EACjB,KAAK,SAASwB,CAAK,EACnB,KAAK,YAAYpB,CAAQ,EACzB,KAAK,OAAOF,CAAG,CACjB,CAEA,YAAmB,CACjB,KAAK,QAAQ,WAAA,EACb,KAAK,QAAQ,WAAA,EACb,KAAK,aAAa,WAAA,EAClB,KAAK,UAAU,WAAA,EACf,KAAK,WAAW,WAAA,EAChB,UAAWyB,KAAK,KAAK,QACnBA,EAAE,WAAA,CAEN,CAEA,MAAa,CACX,GAAI,CACF,KAAK,IAAI,KAAA,CACX,MAAQ,CAER,CACF,CACF,EAzGEN,EAAwB,WAAa,EAVhC,IAAMO,GAANP,ECQA,MAAMQ,EAAa,CAWxB,YAAoBpC,EAAmB,CAAnB,KAAA,IAAAA,EAClB,KAAK,OAAS,IAAID,GAAOC,CAAG,EAC5B,KAAK,OAAS,IAAII,GAAOJ,CAAG,EAC5B,KAAK,OAAS,IAAIY,GAAOZ,CAAG,EAC5B,KAAK,QAAU,IAAIuB,GAAQvB,CAAG,EAC9B,KAAK,MAAQ,IAAI0B,GAAM1B,CAAG,EAC1B,KAAK,OAAS,IAAImC,GAAOnC,CAAG,EAE5B,KAAK,UAAYA,EAAI,WAAA,EACrB,KAAK,WAAaA,EAAI,WAAA,CACxB,CAEA,IAAI,OAAkB,CACpB,OAAO,KAAK,SACd,CAEA,IAAI,QAAmB,CACrB,OAAO,KAAK,UACd,CAKA,QAAQqC,EAA2B,CAEjC,KAAK,cAAA,EAEL,IAAIC,EAAkB,KAAK,UAS3B,GANID,EAAM,WACRC,EAAK,QAAQ,KAAK,OAAO,KAAK,EAC9BA,EAAO,KAAK,OAAO,QAIjBD,EAAM,SAAU,CAClBC,EAAK,QAAQ,KAAK,OAAO,GAAG,EAC5BA,EAAK,QAAQ,KAAK,OAAO,SAAS,EAClC,KAAK,OAAO,UAAU,QAAQ,KAAK,OAAO,QAAQ,EAClD,KAAK,OAAO,SAAS,QAAQ,KAAK,OAAO,SAAS,EAClD,KAAK,OAAO,UAAU,QAAQ,KAAK,OAAO,GAAG,EAE7C,MAAMC,EAAY,KAAK,IAAI,WAAA,EAC3B,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjC,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjCD,EAAOC,CACT,CAGA,GAAIF,EAAM,SAAU,CAClBC,EAAK,QAAQ,KAAK,OAAO,GAAG,EAC5BA,EAAK,QAAQ,KAAK,OAAO,KAAK,EAG9B,IAAIE,EAAmB,KAAK,OAAO,MACnC,UAAWN,KAAK,KAAK,OAAO,WAC1BM,EAAM,QAAQN,CAAC,EACfM,EAAQN,EAEVM,EAAM,QAAQ,KAAK,OAAO,MAAM,EAChC,KAAK,OAAO,OAAO,QAAQ,KAAK,OAAO,QAAQ,EAC/C,KAAK,OAAO,SAAS,QAAQ,KAAK,OAAO,KAAK,EAC9C,KAAK,OAAO,OAAO,QAAQ,KAAK,OAAO,GAAG,EAE1C,MAAMC,EAAY,KAAK,IAAI,WAAA,EAC3B,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjC,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjCH,EAAOG,CACT,CAGA,GAAIJ,EAAM,QAAS,CACjBC,EAAK,QAAQ,KAAK,MAAM,GAAG,EAC3BA,EAAK,QAAQ,KAAK,MAAM,SAAS,EACjC,KAAK,MAAM,UAAU,QAAQ,KAAK,MAAM,QAAQ,EAChD,KAAK,MAAM,SAAS,QAAQ,KAAK,MAAM,SAAS,EAChD,KAAK,MAAM,UAAU,QAAQ,KAAK,MAAM,GAAG,EAE3C,MAAMI,EAAW,KAAK,IAAI,WAAA,EAC1B,KAAK,MAAM,IAAI,QAAQA,CAAQ,EAC/B,KAAK,MAAM,IAAI,QAAQA,CAAQ,EAC/BJ,EAAOI,CACT,CAGA,GAAIL,EAAM,SAAU,CAClBC,EAAK,QAAQ,KAAK,OAAO,GAAG,EAC5BA,EAAK,QAAQ,KAAK,OAAO,aAAa,EACtC,KAAK,OAAO,cAAc,QAAQ,KAAK,OAAO,GAAG,EAEjD,MAAMK,EAAY,KAAK,IAAI,WAAA,EAC3B,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjC,KAAK,OAAO,IAAI,QAAQA,CAAS,EACjCL,EAAOK,CACT,CAGIN,EAAM,YACRC,EAAK,QAAQ,KAAK,QAAQ,KAAK,EAC/BA,EAAO,KAAK,QAAQ,QAItBA,EAAK,QAAQ,KAAK,UAAU,CAC9B,CAKA,aAAaD,EAA2B,CACtC,KAAK,OAAO,OAAOA,EAAM,WAAYA,EAAM,WAAYA,EAAM,OAAO,EACpE,KAAK,OAAO,OACVA,EAAM,WACNA,EAAM,WACNA,EAAM,YACNA,EAAM,UACNA,EAAM,QAAA,EAER,KAAK,OAAO,OAAOA,EAAM,YAAaA,EAAM,SAAS,EACrD,KAAK,QAAQ,OAAOA,EAAM,WAAYA,EAAM,UAAU,EACtD,KAAK,MAAM,OAAOA,EAAM,UAAWA,EAAM,QAASA,EAAM,QAAQ,EAChE,KAAK,OAAO,OACVA,EAAM,WACNA,EAAM,YACNA,EAAM,aACNA,EAAM,SACNA,EAAM,SAAA,CAEV,CAKQ,eAAsB,CAC5B,KAAK,UAAU,WAAA,EACf,KAAK,OAAO,WAAA,EACZ,KAAK,OAAO,WAAA,EACZ,KAAK,OAAO,WAAA,EACZ,KAAK,QAAQ,WAAA,EACb,KAAK,MAAM,WAAA,EACX,KAAK,OAAO,WAAA,EACZ,KAAK,WAAW,WAAA,CAClB,CAKA,SAAgB,CACd,KAAK,cAAA,EACL,KAAK,OAAO,KAAA,EACZ,KAAK,OAAO,KAAA,CACd,CACF,CC1KO,MAAMO,EAA4B,CACvC,CACE,GAAI,WACJ,MAAO,eACP,IAAK,WACL,KAAM,wBACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CAAE,EAAG,OAAQ,KAAM,YAAa,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,GAAA,EACpE,CAAE,EAAG,IAAK,KAAM,cAAe,IAAK,EAAG,IAAK,GAAI,KAAM,EAAG,MAAO,EAAA,EAChE,CACE,EAAG,OACH,KAAM,YACN,IAAK,IACL,IAAK,EACL,KAAM,IACN,MAAO,GAAA,CACT,CACF,EAEF,CACE,GAAI,SACJ,MAAO,mBACP,IAAK,SACL,KAAM,gCACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CAAE,EAAG,QAAS,KAAM,IAAK,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,EAAA,EAC7D,CAAE,EAAG,MAAO,KAAM,IAAK,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,EAAA,EAC3D,CAAE,EAAG,OAAQ,KAAM,IAAK,IAAK,GAAK,IAAK,GAAI,KAAM,KAAQ,MAAO,MAAA,EAChE,CACE,EAAG,QACH,KAAM,cACN,IAAK,GACL,IAAK,IACL,KAAM,EACN,MAAO,GAAA,EAET,CACE,EAAG,aACH,KAAM,aACN,IAAK,EACL,IAAK,IACL,KAAM,GACN,MAAO,EAAA,EAET,CACE,EAAG,OACH,KAAM,YACN,IAAK,EACL,IAAK,EACL,KAAM,KACN,MAAO,GAAA,CACT,CACF,EAEF,CACE,GAAI,UACJ,MAAO,oBACP,IAAK,QACL,KAAM,gCACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CAAE,EAAG,QAAS,KAAM,IAAK,IAAK,IAAM,IAAK,GAAK,KAAM,KAAO,MAAO,EAAA,EAClE,CAAE,EAAG,QAAS,KAAM,IAAK,IAAK,IAAM,IAAK,GAAK,KAAM,KAAO,MAAO,EAAA,EAClE,CAAE,EAAG,QAAS,KAAM,IAAK,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,GAAA,EAC7D,CACE,EAAG,WACH,KAAM,cACN,IAAK,GACL,IAAK,IACL,KAAM,EACN,MAAO,GAAA,EAET,CACE,EAAG,gBACH,KAAM,aACN,IAAK,EACL,IAAK,IACL,KAAM,GACN,MAAO,EAAA,EAET,CACE,EAAG,UACH,KAAM,YACN,IAAK,EACL,IAAK,EACL,KAAM,KACN,MAAO,GAAA,CACT,CACF,EAEF,CACE,GAAI,QACJ,MAAO,wBACP,IAAK,QACL,KAAM,kBACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CAAE,EAAG,KAAM,KAAM,UAAW,IAAK,GAAI,IAAK,IAAK,KAAM,EAAG,MAAO,EAAA,EAC/D,CAAE,EAAG,IAAK,KAAM,IAAK,IAAK,GAAM,IAAK,EAAK,KAAM,KAAO,MAAO,GAAA,CAAK,CACrE,EAEF,CACE,GAAI,UACJ,MAAO,eACP,IAAK,WACL,KAAM,0BACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CACE,EAAG,WACH,KAAM,cACN,IAAK,GACL,IAAK,IACL,KAAM,EACN,MAAO,EAAA,EAET,CACE,EAAG,YACH,KAAM,QACN,IAAK,IACL,IAAK,GACL,KAAM,KACN,MAAO,EAAA,EAET,CAAE,EAAG,cAAe,KAAM,UAAW,IAAK,EAAG,IAAK,GAAI,KAAM,EAAG,MAAO,CAAA,CAAE,CAC1E,EAEF,CACE,GAAI,KACJ,MAAO,UACP,IAAK,KACL,KAAM,kCACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CAAE,EAAG,KAAM,KAAM,WAAY,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,GAAA,EACjE,CAAE,EAAG,KAAM,KAAM,WAAY,IAAK,GAAK,IAAK,GAAI,KAAM,GAAK,MAAO,CAAA,EAClE,CAAE,EAAG,IAAK,KAAM,UAAW,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,CAAA,CAAI,CACrE,EAEF,CACE,GAAI,QACJ,MAAO,oBACP,IAAK,QACL,KAAM,6BACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CAAE,EAAG,QAAS,KAAM,SAAU,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,GAAA,EAClE,CAAE,EAAG,KAAM,KAAM,UAAW,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,EAAA,CAAI,CACtE,EAEF,CACE,GAAI,KACJ,MAAO,mBACP,IAAK,KACL,KAAM,oCACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CAAE,EAAG,IAAK,KAAM,SAAU,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,GAAA,EAC9D,CAAE,EAAG,OAAQ,KAAM,UAAW,IAAK,GAAK,IAAK,GAAI,KAAM,GAAK,MAAO,CAAA,CAAE,CACvE,EAEF,CACE,GAAI,QACJ,MAAO,mBACP,IAAK,QACL,KAAM,kCACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CAAE,EAAG,KAAM,KAAM,cAAe,IAAK,GAAI,IAAK,IAAK,KAAM,EAAG,MAAO,GAAA,EACnE,CAAE,EAAG,KAAM,KAAM,aAAc,IAAK,EAAG,IAAK,KAAM,KAAM,EAAG,MAAO,GAAA,EAClE,CAAE,EAAG,KAAM,KAAM,IAAK,IAAK,IAAM,IAAK,EAAG,KAAM,IAAM,MAAO,EAAA,CAAI,CAClE,EAEF,CACE,GAAI,WACJ,MAAO,eACP,IAAK,QACL,KAAM,oBACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CACE,EAAG,OACH,KAAM,cACN,IAAK,GACL,IAAK,IACL,KAAM,EACN,MAAO,GAAA,EAET,CACE,EAAG,QACH,KAAM,aACN,IAAK,EACL,IAAK,KACL,KAAM,EACN,MAAO,GAAA,EAET,CAAE,EAAG,IAAK,KAAM,IAAK,IAAK,IAAK,IAAK,EAAK,KAAM,KAAQ,MAAO,IAAA,EAC9D,CACE,EAAG,QACH,KAAM,mBACN,IAAK,EACL,IAAK,IACL,KAAM,EACN,MAAO,EAAA,CACT,CACF,EAEF,CACE,GAAI,OACJ,MAAO,uBACP,IAAK,OACL,KAAM,sBACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CAAE,EAAG,KAAM,KAAM,SAAU,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,GAAA,EAC/D,CAAE,EAAG,QAAS,KAAM,IAAK,IAAK,EAAG,IAAK,GAAI,KAAM,IAAM,MAAO,CAAA,CAAI,CACnE,EAEF,CACE,GAAI,UACJ,MAAO,0BACP,IAAK,KACL,KAAM,uCACN,SAAU,GACV,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CACE,EAAG,SACH,KAAM,YACN,IAAK,GACL,IAAK,IACL,KAAM,EACN,MAAO,GAAA,EAET,CACE,EAAG,SACH,KAAM,UACN,IAAK,GACL,IAAK,MACL,KAAM,KACN,MAAO,IAAA,EAET,CACE,EAAG,WACH,KAAM,aACN,IAAK,EACL,IAAK,EACL,KAAM,KACN,MAAO,EAAA,CACT,CACF,EAEF,CACE,GAAI,UACJ,MAAO,mBACP,IAAK,QACL,KAAM,0BACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CACE,EAAG,OACH,KAAM,cACN,IAAK,GACL,IAAK,KACL,KAAM,EACN,MAAO,GAAA,CACT,CACF,EAEF,CACE,GAAI,YACJ,MAAO,mBACP,IAAK,QACL,KAAM,6BACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CACE,EAAG,aACH,KAAM,aACN,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EAAA,CACT,CACF,EAEF,CACE,GAAI,aACJ,MAAO,yBACP,IAAK,QACL,KAAM,4BACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,GAAA,EAC/D,CACE,EAAG,YACH,KAAM,YACN,IAAK,KACL,IAAK,GACL,KAAM,KACN,MAAO,GAAA,CACT,CACF,EAEF,CACE,GAAI,cACJ,MAAO,eACP,IAAK,QACL,KAAM,yBACN,QAAS,CACP,CAAE,EAAG,OAAQ,KAAM,OAAQ,IAAK,EAAG,IAAK,EAAG,KAAM,KAAO,MAAO,EAAA,EAC/D,CACE,EAAG,gBACH,KAAM,kBACN,IAAK,IACL,IAAK,IACL,KAAM,GACN,MAAO,GAAA,CACT,CACF,CAEJ,ECzUA,IAAIC,EAAoC,KAKxC,eAAsBC,IAAiC,CACrD,GAAI,aAAc,UAChB,GAAI,CACFD,EAAW,MAAM,UAAU,SAAS,QAAQ,QAAQ,EACpDA,EAAS,iBAAiB,UAAW,IAAM,CACzCA,EAAW,IACb,CAAC,CACH,OAASE,EAAK,CACZ,MAAMC,EAAQD,EACd,QAAQ,IAAI,mBAAoBC,EAAM,KAAMA,EAAM,OAAO,CAC3D,CAEJ,CAKA,eAAsBC,IAAiC,CACjDJ,IACF,MAAMA,EAAS,QAAA,EACfA,EAAW,KAEf,CCzBA,MAAMK,OAAyC,IAKxC,SAASC,IAAyB,CACvC,OAAO,SAAS,kBAAoB,SACtC,CAMO,SAASC,GAAmBC,EAA0C,CAC3E,OAAAH,GAAU,IAAIG,CAAQ,EACf,IAAMH,GAAU,OAAOG,CAAQ,CACxC,CAGA,SAAS,iBAAiB,mBAAoB,IAAM,CAClD,MAAMC,EAAUH,GAAA,EAChBD,GAAU,QAASK,GAAOA,EAAGD,CAAO,CAAC,CACvC,CAAC,ECxBD,SAASE,EAAYC,EAAgBC,EAAgBC,EAAmB,CACtE,QAAS,EAAI,EAAG,EAAIA,EAAI,OAAQ,IAC9BF,EAAK,SAASC,EAAS,EAAGC,EAAI,WAAW,CAAC,CAAC,CAE/C,CAQO,SAASC,GAAUC,EAAuBC,EAA0B,CAKzE,MAAMC,EAAWD,EAAa,EACxBE,EAAWH,EAAQ,OAAS,EAC5BI,EAAS,IAAI,YAAY,GAAKD,CAAQ,EACtCP,EAAO,IAAI,SAASQ,CAAM,EAGhCT,EAAYC,EAAM,EAAG,MAAM,EAC3BA,EAAK,UAAU,EAAG,GAAKO,EAAU,EAAI,EACrCR,EAAYC,EAAM,EAAG,MAAM,EAG3BD,EAAYC,EAAM,GAAI,MAAM,EAC5BA,EAAK,UAAU,GAAI,GAAI,EAAI,EAC3BA,EAAK,UAAU,GAAI,EAAG,EAAI,EAC1BA,EAAK,UAAU,GAAI,EAAa,EAAI,EACpCA,EAAK,UAAU,GAAIK,EAAY,EAAI,EACnCL,EAAK,UAAU,GAAIM,EAAU,EAAI,EACjCN,EAAK,UAAU,GAAI,EAAY,EAAI,EACnCA,EAAK,UAAU,GAAI,GAAe,EAAI,EAGtCD,EAAYC,EAAM,GAAI,MAAM,EAC5BA,EAAK,UAAU,GAAIO,EAAU,EAAI,EAGjC,IAAIN,EAAS,GACb,QAAStC,EAAI,EAAGA,EAAIyC,EAAQ,OAAQzC,IAAK,CACvC,IAAI8C,EAAI,KAAK,IAAI,GAAI,KAAK,IAAI,EAAGL,EAAQzC,CAAC,CAAC,CAAC,EAC5C8C,EAAIA,EAAI,EAAIA,EAAI,MAASA,EAAI,MAC7BT,EAAK,SAASC,EAAQQ,EAAG,EAAI,EAC7BR,GAAU,CACZ,CAEA,OAAO,IAAI,KAAK,CAACO,CAAM,EAAG,CAAE,KAAM,YAAa,CACjD,CAKO,SAASE,IAA8B,CAE5C,MAAO,qBADe,KAAA,EAAO,cAAc,QAAQ,QAAS,GAAG,CAC9B,MACnC,sJCtCO,MAAMC,WAAoB,WAAY,CAAtC,aAAA,CAAA,MAAA,GAAA,SAAA,EACL,KAAQ,IAA2B,KACnC,KAAQ,SAAgC,KACxC,KAAQ,OAA0B,KAClC,KAAQ,WAA8B,KACtC,KAAQ,aAAoC,KAC5C,KAAQ,eAA6C,IACrD,KAAQ,aAAwC,KAChD,KAAQ,aAAe,GACvB,KAAQ,sBAA6C,IAAA,CAKrD,IAAI,WAAqB,CACvB,OAAO,KAAK,MAAQ,MAAQ,KAAK,IAAI,QAAU,SACjD,CAKA,IAAI,aAAuB,CACzB,OAAO,KAAK,YACd,CAKA,IAAI,cAAoC,CACtC,OAAO,KAAK,GACd,CAKA,IAAI,cAAoC,CACtC,OAAO,KAAK,QACd,CAKA,IAAI,YAAqB,OACvB,QAAOC,EAAA,KAAK,MAAL,YAAAA,EAAU,aAAc,KACjC,CAKA,MAAM,MAAMC,EAAwC,SAClD,GAAI,KAAK,IAAK,OAGd,KAAK,IAAM,IAAI,aAAa,CAAE,YAAa,cAAe,EAGtD,KAAK,IAAI,QAAU,aACrB,MAAM,KAAK,IAAI,OAAA,EAGjB,MAAM,QAAQ,IAAI,CAChB,KAAK,IAAI,aAAa,UAAUC,EAAY,EAC5C,KAAK,IAAI,aAAa,UAAUC,EAAW,CAAA,CAC5C,EAGD,KAAK,SAAW,KAAK,IAAI,eAAA,EACzB,KAAK,SAAS,QAAU,KAExB,KAAK,OAAS,KAAK,IAAI,WAAA,EACvB,KAAK,OAAO,KAAK,MAAQ,EAEzB,KAAK,WAAa,KAAK,IAAI,WAAA,EAC3B,KAAK,WAAW,KAAK,OAAQF,GAAA,YAAAA,EAAc,aAAc,IAGzD,KAAK,aAAe,IAAIlC,GAAa,KAAK,GAAG,EAG7C,KAAK,OAAO,QAAQ,KAAK,aAAa,KAAK,EAC3C,KAAK,aAAa,OAAO,QAAQ,KAAK,UAAU,EAChD,KAAK,WAAW,QAAQ,KAAK,QAAQ,EACrC,KAAK,SAAS,QAAQ,KAAK,IAAI,WAAW,EAG1C,KAAK,aAAe,IAAI,iBAAiB,KAAK,IAAK,qBAAsB,CACvE,eAAgB,EAChB,gBAAiB,EACjB,mBAAoB,CAAC,CAAC,CAAA,CACvB,EAGD,KAAK,WAAW,QAAQ,KAAK,YAAY,EACzC,MAAMqC,EAAa,KAAK,IAAI,WAAA,EAC5BA,EAAW,KAAK,MAAQ,EACxB,KAAK,aAAa,QAAQA,CAAU,EACpCA,EAAW,QAAQ,KAAK,IAAI,WAAW,EAGvC,UAAWvC,KAAKU,EAAU,CACxB,MAAM8B,EAAqC,CAAA,EAC3C,UAAWR,KAAKhC,EAAE,QAAS,CACzB,MAAMyC,GAAcC,GAAAP,EAAAC,GAAA,YAAAA,EAAc,WAAd,YAAAD,EAAyBnC,EAAE,MAA3B,YAAA0C,EAAgC,OACpDF,EAAWR,EAAE,CAAC,GAAIS,GAAA,YAAAA,EAAcT,EAAE,KAAMA,EAAE,KAC5C,CAEA,MAAMW,EAAU,IAAI,iBAAiB,KAAK,IAAK,oBAAqB,CAClE,eAAgB,EAChB,gBAAiB,EACjB,mBAAoB,CAAC,CAAC,EACtB,iBAAkB,CAAE,QAAS3C,EAAE,GAAI,OAAQwC,CAAA,CAAW,CACvD,EAEKI,EAAO,KAAK,IAAI,WAAA,EACtBA,EAAK,KAAK,MAAQ,EAClBD,EAAQ,QAAQC,CAAI,EACpBA,EAAK,QAAQ,KAAK,MAAM,EAExB,KAAK,WAAW,IAAI5C,EAAE,GAAI,CAAE,QAAA2C,EAAS,KAAAC,EAAM,OAAQJ,EAAY,CACjE,CAQA,GALIJ,GAAA,MAAAA,EAAc,IAChB,KAAK,cAAcA,EAAa,EAAE,EAIhCA,GAAA,MAAAA,EAAc,SAChB,SAAW,CAACS,EAAI1C,CAAK,IAAK,OAAO,QAAQiC,EAAa,QAAQ,EACxDjC,EAAM,SACR,KAAK,cAAc0C,EAAI,EAAI,EAMjC,MAAMjC,GAAA,EAGN,KAAK,sBAAwBM,GAAmB,MAAOE,GAAY,CAC7DA,GAAW,KAAK,MACd,KAAK,IAAI,QAAU,aACrB,MAAM,KAAK,IAAI,OAAA,EAEjB,MAAMR,GAAA,EAEV,CAAC,EAED,KAAK,cAAc,IAAI,MAAM,OAAO,CAAC,CACvC,CAKA,MAAM,MAAsB,SAC1B,GAAI,CAAC,KAAK,IAAK,OAGX,KAAK,cACP,MAAM,KAAK,cAAA,EAIb,MAAMG,GAAA,EAGF,KAAK,wBACP,KAAK,sBAAA,EACL,KAAK,sBAAwB,MAI/B,MAAM+B,EAAM,KAAK,IAAI,aACrBX,EAAA,KAAK,aAAL,MAAAA,EAAiB,KAAK,gBAAgB,EAAGW,EAAK,KAG9C,MAAM,IAAI,QAASC,GAAY,WAAWA,EAAS,EAAE,CAAC,GAGtDL,EAAA,KAAK,eAAL,MAAAA,EAAmB,UAGnB,MAAM,KAAK,IAAI,MAAA,EAGf,KAAK,IAAM,KACX,KAAK,SAAW,KAChB,KAAK,OAAS,KACd,KAAK,WAAa,KAClB,KAAK,aAAe,KACpB,KAAK,aAAe,KACpB,KAAK,WAAW,MAAA,EAEhB,KAAK,cAAc,IAAI,MAAM,MAAM,CAAC,CACtC,CAKA,cAAcM,EAAqB,CAC7B,KAAK,aACP,KAAK,WAAW,KAAK,MAAQA,EAEjC,CAKA,cAAcH,EAAYI,EAAwB,CAChD,MAAMC,EAAM,KAAK,WAAW,IAAIL,CAAE,EAClC,GAAI,CAACK,GAAO,CAAC,KAAK,IAAK,OAEvB,MAAMJ,EAAM,KAAK,IAAI,YACfK,EAAaF,EAAUC,EAAI,OAAO,MAAQ,GAAM,EACtDA,EAAI,KAAK,KAAK,gBAAgBC,EAAYL,EAAK,GAAI,CACrD,CAKA,mBAAmBD,EAAYO,EAAeJ,EAAqB,CACjE,MAAME,EAAM,KAAK,WAAW,IAAIL,CAAE,EAClC,GAAI,CAACK,EAAK,OAEVA,EAAI,OAAOE,CAAK,EAAIJ,EACpB,MAAMK,EAAsB,CAAE,KAAM,MAAO,OAAQ,CAAE,CAACD,CAAK,EAAGJ,EAAM,EACpEE,EAAI,QAAQ,KAAK,YAAYG,CAAG,EAG5BD,IAAU,QAAUF,EAAI,KAAK,KAAK,MAAQ,GAAK,KAAK,KACtDA,EAAI,KAAK,KAAK,gBAAgBF,EAAO,KAAK,IAAI,YAAa,GAAI,CAEnE,CAKA,aAAaH,EAAkB,CAC7B,MAAMK,EAAM,KAAK,WAAW,IAAIL,CAAE,EAClC,GAAI,CAACK,EAAK,OAEV,MAAMG,EAAsB,CAAE,KAAM,OAAA,EACpCH,EAAI,QAAQ,KAAK,YAAYG,CAAG,CAClC,CAKA,cAAclD,EAA2B,CACnC,CAAC,KAAK,cAAgB,CAAC,KAAK,QAAU,CAAC,KAAK,aAGhD,KAAK,OAAO,WAAA,EACZ,KAAK,aAAa,OAAO,WAAA,EAEzB,KAAK,aAAa,QAAQA,CAAK,EAC/B,KAAK,aAAa,aAAaA,CAAK,EAGpC,KAAK,OAAO,QAAQ,KAAK,aAAa,KAAK,EAC3C,KAAK,aAAa,OAAO,QAAQ,KAAK,UAAU,EAClD,CAKA,mBAAmBA,EAA2B,QAC5CgC,EAAA,KAAK,eAAL,MAAAA,EAAmB,aAAahC,EAClC,CAKA,gBAAuB,CACjB,CAAC,KAAK,cAAgB,KAAK,eAE/B,KAAK,aAAe,GACpB,KAAK,aAAa,KAAK,YAAY,CAAE,KAAM,QAAS,EACpD,KAAK,cAAc,IAAI,MAAM,iBAAiB,CAAC,EACjD,CAKA,MAAM,eAAkE,CACtE,MAAI,CAAC,KAAK,cAAgB,CAAC,KAAK,cAAgB,CAAC,KAAK,IAAY,KAE3D,IAAI,QAAS4C,GAAY,CAC9B,KAAK,aAAc,KAAK,UACtBO,GACG,CACH,GAAIA,EAAE,KAAK,OAAS,OAAQ,CAC1B,KAAK,aAAe,GACpB,MAAMC,EAAO7B,GAAU4B,EAAE,KAAK,QAAS,KAAK,IAAK,UAAU,EACrDE,EAAWvB,GAAA,EAEjB,KAAK,cACH,IAAI,YAAY,iBAAkB,CAAE,OAAQ,CAAE,KAAAsB,EAAM,SAAAC,EAAS,CAAG,CAAA,EAElET,EAAQ,CAAE,KAAAQ,EAAM,SAAAC,EAAU,CAC5B,CACF,EAEA,KAAK,aAAc,KAAK,YAAY,CAAE,KAAM,OAAQ,CACtD,CAAC,CACH,CAKA,kBAAkBzB,EAAuC,QACvDI,EAAA,KAAK,WAAL,MAAAA,EAAe,sBAAsBJ,EACvC,CAKA,iBAAiBA,EAAuC,QACtDI,EAAA,KAAK,WAAL,MAAAA,EAAe,qBAAqBJ,EACtC,CAKA,eAAyB,CACvB,OAAOd,GAAA,CACT,CACF,CC9VO,SAASwC,GAAahC,EAAqB,CAChD,MAAMiC,EAAQ,IAAI,cAAc,OAAOjC,CAAG,EAC1C,IAAIkC,EAAM,GACV,UAAWC,KAAKF,EACdC,GAAO,OAAO,aAAaC,CAAC,EAE9B,OAAO,KAAKD,CAAG,EACZ,QAAQ,MAAO,GAAG,EAClB,QAAQ,MAAO,GAAG,EAClB,QAAQ,MAAO,EAAE,CACtB,CAKO,SAASE,GAAaC,EAAsB,CACjD,MAAMC,EAAMD,EAAK,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EAC/CE,EAAMD,EAAI,OAAS,EAAI,IAAI,OAAO,EAAKA,EAAI,OAAS,CAAE,EAAI,GAC1DJ,EAAM,KAAKI,EAAMC,CAAG,EACpBN,EAAQ,IAAI,WAAWC,EAAI,MAAM,EACvC,QAASzE,EAAI,EAAGA,EAAIyE,EAAI,OAAQzE,IAC9BwE,EAAMxE,CAAC,EAAIyE,EAAI,WAAWzE,CAAC,EAE7B,OAAO,IAAI,YAAA,EAAc,OAAOwE,CAAK,CACvC,CCrBO,SAASO,IAAoC,CAClD,MAAMC,EAAI,SAAS,KAAK,MAAM,sBAAsB,EACpD,GAAI,CAACA,EAAG,OAAO,KAEf,GAAI,CACF,MAAMC,EAAON,GAAaK,EAAE,CAAC,CAAC,EAC9B,OAAO,KAAK,MAAMC,CAAI,CACxB,MAAQ,CACN,OAAO,IACT,CACF,CAMO,SAASC,GAAgBjE,EAAyB,CACvD,MAAMgE,EAAO,KAAK,UAAUhE,CAAK,EAE3BkE,EAAU,MADFZ,GAAaU,CAAI,CACJ,GAC3B,eAAQ,aAAa,KAAM,GAAIE,CAAO,EAC/B,SAAS,IAClB,CCGO,MAAMC,EAAe,CAC1B,OAAQ,8BACR,WAAY,8BACd,EC5BO,SAASC,GAAWpE,EAAuB,CAChD,aAAa,QAAQmE,EAAa,OAAQ,KAAK,UAAUnE,CAAK,CAAC,CACjE,CAKO,SAASqE,IAA8B,CAC5C,MAAMC,EAAM,aAAa,QAAQH,EAAa,MAAM,EACpD,GAAI,CAACG,EAAK,OAAO,KAEjB,GAAI,CACF,OAAO,KAAK,MAAMA,CAAG,CACvB,MAAQ,CACN,OAAO,IACT,CACF,CAmBO,SAASC,IAAuB,CACrC,OAAO,aAAa,QAAQJ,EAAa,UAAU,IAAM,MAC3D,CAKO,SAASK,IAAsB,CACpC,aAAa,QAAQL,EAAa,WAAY,MAAM,CACtD,CC7CO,MAAMM,GAAsB,IAKtBC,GAA2B,CAEtC,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,QAAS,GAET,SAAU,GACV,WAAY,SACZ,WAAY,IACZ,YAAa,EACb,UAAW,IACX,SAAU,IAEV,SAAU,GACV,YAAa,IACb,UAAW,IAEX,UAAW,GACX,WAAY,IACZ,WAAY,IAEZ,QAAS,GACT,UAAW,IACX,QAAS,GACT,SAAU,GAEV,SAAU,GACV,WAAY,GACZ,YAAa,GACb,aAAc,EACd,SAAU,GACV,UAAW,EACb,EAKaC,GAAgB,EC3ChBC,EAAoB,CAC/B,CACE,KAAM,uBACN,MAAO,CACL,EAAG,EACH,WAAY,KACZ,GAAI,CACF,SAAU,GACV,WAAY,UACZ,WAAY,KACZ,QAAS,IACT,SAAU,GACV,WAAY,SACZ,WAAY,IACZ,YAAa,IACb,UAAW,IACX,SAAU,IACV,SAAU,GACV,YAAa,IACb,UAAW,GACX,UAAW,GACX,WAAY,IACZ,WAAY,IACZ,QAAS,GACT,UAAW,IACX,QAAS,IACT,SAAU,GACV,SAAU,GACV,WAAY,IACZ,YAAa,IACb,aAAc,EACd,SAAU,IACV,UAAW,GAAA,EAEb,SAAU,CACR,SAAU,CACR,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,GACN,EAAG,GACH,KAAM,GAAA,CACR,EAEF,QAAS,CACP,QAAS,GACT,OAAQ,CACN,KAAM,KACN,MAAO,KACP,MAAO,KACP,MAAO,KACP,SAAU,IACV,cAAe,KACf,QAAS,GAAA,CACX,CACF,CACF,CACF,EAEF,CACE,KAAM,yBACN,MAAO,CACL,EAAG,EACH,WAAY,KACZ,GAAI,CACF,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,QAAS,IACT,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,YAAa,IACb,UAAW,IACX,SAAU,IACV,SAAU,GACV,YAAa,IACb,UAAW,EACX,UAAW,GACX,WAAY,IACZ,WAAY,IACZ,QAAS,GACT,UAAW,KACX,QAAS,IACT,SAAU,EACV,SAAU,GACV,WAAY,KACZ,YAAa,IACb,aAAc,EACd,SAAU,IACV,UAAW,GAAA,EAEb,SAAU,CACR,SAAU,CACR,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,IACN,EAAG,EACH,KAAM,IAAA,CACR,EAEF,OAAQ,CACN,QAAS,GACT,OAAQ,CACN,KAAM,KACN,MAAO,GACP,IAAK,MACL,KAAM,OACN,MAAO,IACP,WAAY,GACZ,KAAM,GAAA,CACR,EAEF,QAAS,CACP,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,IAAA,CACR,CACF,CACF,CACF,EAEF,CACE,KAAM,iCACN,MAAO,CACL,EAAG,EACH,WAAY,KACZ,GAAI,CACF,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,QAAS,KACT,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,YAAa,GACb,UAAW,IACX,SAAU,IACV,SAAU,GACV,YAAa,EACb,UAAW,IACX,UAAW,GACX,WAAY,IACZ,WAAY,IACZ,QAAS,GACT,UAAW,KACX,QAAS,IACT,SAAU,EACV,SAAU,GACV,WAAY,KACZ,YAAa,IACb,aAAc,EACd,SAAU,IACV,UAAW,GAAA,EAEb,SAAU,CACR,SAAU,CACR,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,IACN,EAAG,GACH,KAAM,GAAA,CACR,CACF,CACF,CACF,EAEF,CACE,KAAM,iCACN,MAAO,CACL,EAAG,EACH,WAAY,KACZ,GAAI,CACF,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,QAAS,KACT,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,YAAa,IACb,UAAW,IACX,SAAU,GACV,SAAU,GACV,YAAa,IACb,UAAW,IACX,UAAW,GACX,WAAY,IACZ,WAAY,IACZ,QAAS,GACT,UAAW,KACX,QAAS,IACT,SAAU,EACV,SAAU,GACV,WAAY,KACZ,YAAa,IACb,aAAc,EACd,SAAU,IACV,UAAW,GAAA,EAEb,SAAU,CACR,SAAU,CACR,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,GACN,EAAG,GACH,KAAM,GAAA,CACR,EAEF,QAAS,CACP,QAAS,GACT,OAAQ,CACN,KAAM,KACN,MAAO,KACP,MAAO,KACP,MAAO,KACP,SAAU,GACV,cAAe,IACf,QAAS,IAAA,CACX,EAEF,YAAa,CACX,QAAS,GACT,OAAQ,CACN,KAAM,KACN,cAAe,GAAA,CACjB,CACF,CACF,CACF,EAEF,CACE,KAAM,mBACN,MAAO,CACL,EAAG,EACH,WAAY,IACZ,GAAI,CACF,SAAU,GACV,WAAY,UACZ,WAAY,IACZ,QAAS,GACT,SAAU,GACV,WAAY,SACZ,WAAY,IACZ,YAAa,IACb,UAAW,IACX,SAAU,IACV,SAAU,GACV,YAAa,IACb,UAAW,IACX,UAAW,GACX,WAAY,IACZ,WAAY,IACZ,QAAS,GACT,UAAW,IACX,QAAS,GACT,SAAU,GACV,SAAU,GACV,WAAY,GACZ,YAAa,GACb,aAAc,EACd,SAAU,GACV,UAAW,EAAA,EAEb,SAAU,CACR,SAAU,CACR,QAAS,GACT,OAAQ,CACN,KAAM,KACN,KAAM,GACN,EAAG,GACH,KAAM,GAAA,CACR,EAEF,OAAQ,CACN,QAAS,GACT,OAAQ,CACN,KAAM,KACN,MAAO,GACP,IAAK,GACL,KAAM,OACN,MAAO,IACP,WAAY,GACZ,KAAM,GAAA,CACR,EAEF,QAAS,CACP,QAAS,GACT,OAAQ,CACN,KAAM,GACN,KAAM,GAAA,CACR,CACF,CACF,CACF,CAEJ,EClSO,MAAMC,EAAa,CAIxB,iBAA4B,CAC1B,MAAMC,EAAyC,CAAA,EAE/C,UAAWjF,KAAKU,EAAU,CACxB,MAAMwE,EAAiC,CAAA,EACvC,UAAWlD,KAAKhC,EAAE,QAChBkF,EAAOlD,EAAE,CAAC,EAAIA,EAAE,MAElBiD,EAASjF,EAAE,EAAE,EAAI,CAAE,QAAS,GAAO,OAAAkF,CAAA,CACrC,CAEA,MAAO,CACL,EAAGJ,GACH,WAAYF,GACZ,GAAI,CAAE,GAAGC,EAAA,EACT,SAAAI,CAAA,CAEJ,CAKA,cAA6B,CAC3B,MAAO,CAAE,GAAGJ,EAAA,CACd,CAKA,aAA+B,CAC7B,OAAOZ,GAAA,CACT,CAKA,UAAU9D,EAAyB,CACjC,OAAOiE,GAAgBjE,CAAK,CAC9B,CAKA,cAAcA,EAAuB,CACnCoE,GAAWpE,CAAK,CAClB,CAKA,iBAAmC,CACjC,OAAOqE,GAAA,CACT,CAKA,aAAuB,CACrB,OAAOE,GAAA,CACT,CAKA,eAAsB,CACpBC,GAAA,CACF,CAMA,kBAAkBQ,EAAsC,CACtD,MAAMC,EAAW,KAAK,gBAAA,EAEtB,MAAO,CACL,EAAGD,EAAQ,GAAKC,EAAS,EACzB,WAAYD,EAAQ,YAAcC,EAAS,WAC3C,GAAI,CAAE,GAAGA,EAAS,GAAI,GAAGD,EAAQ,EAAA,EACjC,SAAU,CAAE,GAAGC,EAAS,SAAU,GAAGD,EAAQ,QAAA,CAAS,CAE1D,CACF,CC9FO,SAASE,EAAuCC,EAA4B,CACjF,OAAO,SAAS,cAAcA,CAAQ,CACxC,CAKO,SAASC,EAA8CD,EAAqB,CACjF,MAAME,EAAK,SAAS,cAAcF,CAAQ,EAC1C,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,sBAAsBF,CAAQ,EAAE,EAElD,OAAOE,CACT,CCbO,MAAMC,EAAa,CAqBxB,YACEC,EACQC,EACR,CADQ,KAAA,MAAAA,EApBV,KAAQ,UAAuB,WAC/B,KAAQ,cAAgB,EAGxB,KAAQ,cAA0C,KAClD,KAAQ,WAA8C,KACtD,KAAQ,gBAAkB,EAC1B,KAAQ,iBAAmB,EAC3B,KAAQ,gBAAkB,EAC1B,KAAiB,iBAAmB,GAGpC,KAAQ,QAA0C,KAClD,KAAQ,QAA0C,KAGlD,KAAQ,MAAuB,KAuG/B,KAAQ,KAAO,IAAY,CAMzB,GALA,KAAK,MAAQ,sBAAsB,KAAK,IAAI,EAExC,CAAC,KAAK,MAAM,cAAgB,CAAC,KAAK,SAAW,CAAC,KAAK,SAGnD,CAAC,KAAK,MAAM,gBAAiB,OAGjC,KAAK,MAAM,kBAAkB,KAAK,OAAO,EACzC,KAAK,MAAM,iBAAiB,KAAK,OAAO,EAGxC,IAAIC,EAAO,KACX,QAAS1G,EAAI,EAAGA,EAAI,KAAK,QAAQ,OAAQA,IAAK,CAC5C,MAAM2G,GAAK,KAAK,QAAQ3G,CAAC,EAAI,KAAO,IAC9B4G,EAAI,KAAK,IAAID,CAAC,EAChBC,EAAIF,IAAMA,EAAOE,EACvB,CAEA,IAAIC,EAAS,IAAOH,EACpBG,EAAS,KAAK,IAAI,IAAM,KAAK,IAAI,GAAMA,CAAM,CAAC,EAC9C,KAAK,gBAAkBA,EAAS,KAAK,eAAiB,IAEtD,MAAMC,EAAI,KAAK,OAAO,MAChBC,EAAI,KAAK,OAAO,QAGlBD,IAAM,KAAK,iBAAmBC,IAAM,KAAK,mBAC3C,KAAK,YAAYD,EAAGC,EAAG,KAAK,QAAQ,MAAM,EAGxC,KAAK,YAAc,WACrB,KAAK,aAAaD,EAAGC,CAAC,EAEtB,KAAK,SAASD,EAAGC,CAAC,CAEtB,EAtIE,KAAK,OAASP,EACd,KAAK,IAAMA,EAAO,WAAW,IAAI,EAGjC,OAAO,iBAAiB,SAAU,IAAM,KAAK,QAAQ,EACrD,KAAK,OAAA,CACP,CAEA,IAAI,MAAkB,CACpB,OAAO,KAAK,SACd,CAEA,QAAQvH,EAAuB,CAC7B,KAAK,UAAYA,CACnB,CAEA,YAAwB,CACtB,YAAK,UAAY,KAAK,YAAc,OAAS,WAAa,OACnD,KAAK,SACd,CAEA,QAAe,CACb,MAAM+H,EAAM,OAAO,kBAAoB,EACjCC,EAAO,KAAK,OAAO,sBAAA,EACzB,KAAK,OAAO,MAAQ,KAAK,IAAI,EAAG,KAAK,MAAMA,EAAK,MAAQD,CAAG,CAAC,EAC5D,KAAK,OAAO,OAAS,KAAK,IAAI,EAAG,KAAK,MAAMC,EAAK,OAASD,CAAG,CAAC,EAG1D,KAAK,MAAM,cACb,KAAK,YACH,KAAK,OAAO,MACZ,KAAK,OAAO,OACZ,KAAK,MAAM,aAAa,iBAAA,CAG9B,CAEA,OAAc,CACZ,GAAI,KAAK,QAAU,KAAM,OAEzB,MAAME,EAAW,KAAK,MAAM,aACvBA,IAEL,KAAK,QAAU,IAAI,WAAWA,EAAS,OAAO,EAC9C,KAAK,QAAU,IAAI,WAAWA,EAAS,iBAAiB,EACxD,KAAK,YACH,KAAK,OAAO,MACZ,KAAK,OAAO,OACZA,EAAS,iBAAA,EAGX,KAAK,KAAA,EACP,CAEA,MAAa,CACP,KAAK,QAAU,OACjB,qBAAqB,KAAK,KAAK,EAC/B,KAAK,MAAQ,KAEjB,CAEQ,YAAYJ,EAAWC,EAAWI,EAAwB,CAChE,GACE,KAAK,eACL,KAAK,kBAAoBL,GACzB,KAAK,mBAAqBC,EAE1B,OAGF,MAAMK,EAAY,SAAS,cAAc,QAAQ,EACjDA,EAAU,MAAQN,EAClBM,EAAU,OAASL,EACnB,MAAMM,EAASD,EAAU,WAAW,IAAI,EAGxCC,EAAO,UAAY,UACnBA,EAAO,SAAS,EAAG,EAAGP,EAAGC,CAAC,EAGtB,KAAK,eAAiB,KAAK,YAC7BM,EAAO,UAAU,KAAK,cAAe,EAAG,EAAGP,EAAGC,CAAC,EAGjD,KAAK,cAAgBK,EACrB,KAAK,WAAaC,EAClB,KAAK,gBAAkBP,EACvB,KAAK,iBAAmBC,CAC1B,CAEQ,gBAAgBjD,EAAuB,CAC7C,MAAM6C,EAAI,KAAK,IAAI,IAAK,KAAK,IAAI,EAAG7C,CAAK,CAAC,EACpCwD,EAAM,IAAOX,EAAI,IAAO,IACxBY,EAAY,GAAMZ,EAAI,IAAO,GACnC,MAAO,OAAOW,CAAG,WAAWC,CAAS,IACvC,CAyCQ,aAAaT,EAAWC,EAAiB,CAC/C,MAAMnD,EAAM,YAAY,IAAA,EAExB,GAAIA,EAAM,KAAK,iBAAmB,KAAK,mBACrC,KAAK,gBAAkBA,EAEnB,KAAK,YAAc,KAAK,SAAS,CAEnC,KAAK,WAAW,UAAU,KAAK,cAAgB,GAAc,CAAC,EAE9D,MAAM4D,EAAO,KAAK,QAAQ,OACpBC,EAAU,GACVC,EAAU,IACVC,EAAU,KAAK,MAAM,WAAa,EAExC,QAAS3H,EAAI,EAAGA,EAAI+G,EAAG/G,IAAK,CAC1B,MAAM4H,EAAc5H,EAAI+G,EAClBjI,EAAO4I,EAAU,KAAK,IAAID,EAAUC,EAASE,CAAW,EACxDC,EAAW,KAAK,MAAO/I,EAAO6I,EAAWH,CAAI,EAC7C1D,EAAQ,KAAK,QAAQ,KAAK,IAAI+D,EAAUL,EAAO,CAAC,CAAC,EACvD,KAAK,WAAW,UAAY,KAAK,gBAAgB1D,CAAK,EACtD,KAAK,WAAW,SAASgD,EAAI,EAAa9G,EAAG,EAAa,CAAC,CAC7D,CACF,CAGE,KAAK,WACP,KAAK,IAAI,UAAU,KAAK,cAAgB,EAAG,CAAC,GAE5C,KAAK,IAAI,UAAY,UACrB,KAAK,IAAI,SAAS,EAAG,EAAG8G,EAAGC,CAAC,EAEhC,CAEQ,SAASD,EAAWC,EAAiB,CAE3C,KAAK,IAAI,UAAY,UACrB,KAAK,IAAI,SAAS,EAAG,EAAGD,EAAGC,CAAC,EAG5B,KAAK,IAAI,YAAc,wBACvB,KAAK,IAAI,UAAY,EACrB,KAAK,IAAI,UAAA,EACT,QAAS/G,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3B,MAAM8H,EAAKhB,EAAI9G,EAAK,GACpB,KAAK,IAAI,OAAO8H,EAAG,CAAC,EACpB,KAAK,IAAI,OAAOA,EAAGf,CAAC,CACtB,CACA,QAAS/G,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAM+H,EAAKhB,EAAI/G,EAAK,EACpB,KAAK,IAAI,OAAO,EAAG+H,CAAC,EACpB,KAAK,IAAI,OAAOjB,EAAGiB,CAAC,CACtB,CAIA,GAHA,KAAK,IAAI,OAAA,EAGL,CAAC,KAAK,QAAS,OAEnB,MAAMC,EAAMjB,EAAI,EAChB,KAAK,IAAI,YAAc,UACvB,KAAK,IAAI,UAAY,EACrB,KAAK,IAAI,UAAA,EAET,MAAMrD,EAAO,KAAK,cAClB,QAAS1D,EAAI,EAAGA,EAAI,KAAK,QAAQ,OAAQA,IAAK,CAC5C,MAAM2G,GAAK,KAAK,QAAQ3G,CAAC,EAAI,KAAO,IAC9B+H,EAAIC,EAAMrB,GAAKqB,EAAM,IAAOtE,EAC5BoE,EAAKhB,EAAI9G,GAAM,KAAK,QAAQ,OAAS,GACvCA,IAAM,EACR,KAAK,IAAI,OAAO8H,EAAGC,CAAC,EAEpB,KAAK,IAAI,OAAOD,EAAGC,CAAC,CAExB,CACA,KAAK,IAAI,OAAA,CACX,CACF,CCzNA,MAAME,GAAY,KACZC,GAAY,IACZC,GAAcD,GAAYD,GAG1BG,GAAc,CAClB,OAAQ,IACR,KAAM,GACR,EAKA,SAASC,GAAaC,EAA4B,CAChD,OAAOL,GAAYK,EAAaH,EAClC,CAaA,SAASI,GAAYzE,EAAuB,CAC1C,OAAI,OAAO,UAAUA,CAAK,EAAU,OAAOA,CAAK,EAC5C,KAAK,IAAIA,CAAK,GAAK,IAAY,OAAO,KAAK,MAAMA,CAAK,CAAC,EACvD,KAAK,IAAIA,CAAK,GAAK,GAAWA,EAAM,QAAQ,CAAC,EAC1CA,EAAM,QAAQ,CAAC,CACxB,CAKA,SAAS0E,EAAgB1E,EAAuB,CAC9C,OAAI,OAAO,UAAUA,CAAK,EAAU,OAAOA,CAAK,EAC5C,KAAK,IAAIA,CAAK,GAAK,IAAY,OAAO,KAAK,MAAMA,CAAK,CAAC,EACvD,KAAK,IAAIA,CAAK,GAAK,IACnB,KAAK,IAAIA,CAAK,GAAK,EAAUA,EAAM,QAAQ,CAAC,EACzCA,EAAM,QAAQ,CAAC,CACxB,CAKO,SAAS2E,GAAWC,EAAmC,CAC5D,KAAM,CACJ,GAAA/E,EACA,IAAAgF,EACA,IAAAC,EACA,KAAAC,EACA,MAAA/E,EACA,KAAAgF,EAAO,KACP,MAAAC,EACA,UAAAC,EAAY,GACZ,SAAAC,CAAA,EACEP,EAGEQ,GAAYP,EAAMC,GAAO,EAGzBO,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,kBAAkBL,CAAI,GAC1CK,EAAQ,QAAQ,OAASxF,EAGzB,MAAMyF,EAAYL,EAAQ,2BAA2BA,CAAK,SAAW,GAG/DT,GAAcxE,EAAQ6E,IAAQC,EAAMD,GACpCU,EAAQhB,GAAaC,CAAU,EAG/BgB,EAAaC,GAAcF,EAAOV,EAAKO,EAAUN,EAAKI,CAAS,EAErEG,EAAQ,UAAY;AAAA,MAChBC,CAAS;AAAA,kCACmBzF,CAAE,aAAa4E,GAAYzE,CAAK,CAAC;AAAA;AAAA,QAE3DwF,CAAU;AAAA,QACVN,EAAY;AAAA,sDACkCR,EAAgBG,CAAG,CAAC;AAAA,sDACpBH,EAAgBU,CAAQ,CAAC;AAAA,sDACzBV,EAAgBI,CAAG,CAAC;AAAA,QAChE,EAAE;AAAA;AAAA,IAKV,MAAM3H,EAAQ,CACZ,MAAA6C,EACA,IAAA6E,EACA,IAAAC,EACA,KAAAC,EACA,aAAc/E,EACd,WAAY,GACZ,OAAQ,EACR,WAAY,CAAA,EAIR0F,EAAML,EAAQ,cAAc,KAAK,EACjCM,EAAYD,EAAI,cAAc,iBAAiB,EAC/CE,EAAeP,EAAQ,cAAc,aAAa,EAGlDQ,EAAkB,CAACC,EAAkBC,EAAa,KAAS,CAO/D,GALAD,EAAW,KAAK,IAAIjB,EAAK,KAAK,IAAIC,EAAKgB,CAAQ,CAAC,EAChDA,EAAW,KAAK,MAAMA,EAAWf,CAAI,EAAIA,EAEzCe,EAAW,OAAOA,EAAS,QAAQ,EAAE,CAAC,EAElCA,IAAa3I,EAAM,MAAO,OAE9BA,EAAM,MAAQ2I,EACd,MAAMtB,GAAcsB,EAAWjB,IAAQC,EAAMD,GACvCU,EAAQhB,GAAaC,CAAU,EAGrCmB,EAAU,aAAa,YAAa,UAAUJ,CAAK,WAAW,EAC9DK,EAAa,YAAcnB,GAAYqB,CAAQ,EAE3CC,GAAcZ,GAChBA,EAASW,CAAQ,CAErB,EAGME,EAAmB1F,GAA+B,CACtDA,EAAE,eAAA,EACFnD,EAAM,WAAa,GACnBA,EAAM,OAAS,YAAamD,EAAIA,EAAE,QAAQ,CAAC,EAAE,QAAUA,EAAE,QACzDnD,EAAM,WAAaA,EAAM,MACzBkI,EAAQ,UAAU,IAAI,UAAU,EAChC,SAAS,KAAK,MAAM,OAAS,WAC/B,EAEMY,EAAkB3F,GAA+B,CACrD,GAAI,CAACnD,EAAM,WAAY,OAEvB,MAAM+I,EAAU,YAAa5F,EAAIA,EAAE,QAAQ,CAAC,EAAE,QAAUA,EAAE,QACpD6F,EAAShJ,EAAM,OAAS+I,EAExBE,EAAe9F,EAAiB,SAAWgE,GAAY,KAAOA,GAAY,OAE1E+B,EADaF,EAASC,EACK/B,IAAgBS,EAAMD,GAEvDgB,EAAgB1I,EAAM,WAAakJ,CAAU,CAC/C,EAEMC,EAAgB,IAAM,CACrBnJ,EAAM,aACXA,EAAM,WAAa,GACnBkI,EAAQ,UAAU,OAAO,UAAU,EACnC,SAAS,KAAK,MAAM,OAAS,GAC/B,EAGMkB,EAAoB,IAAM,CAC9BV,EAAgB1I,EAAM,YAAY,CACpC,EAGMqJ,EAAelG,GAAkB,CACrCA,EAAE,eAAA,EACF,MAAM8F,EAAc9F,EAAE,SAAW,GAAM,EACjCmG,EAAQ,CAAC,KAAK,KAAKnG,EAAE,MAAM,EAAIyE,EAAOqB,EAAc,EAC1DP,EAAgB1I,EAAM,MAAQsJ,CAAK,CACrC,EAGA,OAAAf,EAAI,iBAAiB,YAAaM,CAAe,EACjDN,EAAI,iBAAiB,aAAcM,EAAiB,CAAE,QAAS,GAAO,EACtEN,EAAI,iBAAiB,WAAYa,CAAiB,EAClDb,EAAI,iBAAiB,QAASc,EAAa,CAAE,QAAS,GAAO,EAE7D,SAAS,iBAAiB,YAAaP,CAAc,EACrD,SAAS,iBAAiB,YAAaA,EAAgB,CAAE,QAAS,GAAO,EACzE,SAAS,iBAAiB,UAAWK,CAAa,EAClD,SAAS,iBAAiB,WAAYA,CAAa,EAGlDjB,EAAgB,WAAalI,EAC7BkI,EAAgB,aAAeQ,EAEzBR,CACT,CAKA,SAASI,GACPF,EACAV,EACAX,EACAY,EACAI,EACQ,CAWR,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QATYA,EACf;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,EAaY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAOUK,CAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOjC,CAKO,SAASmB,EAAWC,EAAmB3G,EAAqB,CACjE,MAAM4G,EAAYD,EAAa,aAC3BC,GACFA,EAAS5G,EAAO,EAAK,CAEzB,CAKO,SAAS6G,EAAaF,EAA2B,CACtD,MAAMxJ,EAASwJ,EAAa,WAC5B,OAAOxJ,EAAQA,EAAM,MAAQ,CAC/B,CC5QA,SAAS2J,GAAYC,EAA4B,CAC/C,OAAIA,IAAa,OAAe,KAC5BA,EAAS,SAAS,MAAM,GAAKA,EAAS,SAAS,MAAM,GAAKA,IAAa,KAAOA,IAAa,MAAQA,IAAa,MAAQA,IAAa,MAAQA,IAAa,SAAWA,IAAa,MAAQA,IAAa,KAAa,KACjN,IACT,CAKO,SAASC,GACdC,EACAjJ,EACa,CACb,MAAMkJ,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,UACjBA,EAAK,QAAQ,UAAYD,EAAQ,GAEjC,MAAME,EAAYF,EAAQ,SACtB;AAAA;AAAA;AAAA,4BAGsBA,EAAQ,EAAE;AAAA,cAEhC,GAEJC,EAAK,UAAY;AAAA;AAAA;AAAA;AAAA,0CAIuBD,EAAQ,EAAE;AAAA,YACxCA,EAAQ,KAAK;AAAA;AAAA,6BAEIA,EAAQ,IAAI;AAAA;AAAA;AAAA,8CAGKA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,kCAItBA,EAAQ,EAAE;AAAA,0CACFA,EAAQ,EAAE,WAAWE,CAAS;AAAA;AAAA,IAItE,MAAMC,EAAYF,EAAK,cAAc,UAAUD,EAAQ,EAAE,EAAE,EAG3D,UAAWjI,KAAKiI,EAAQ,QAAS,CAC/B,MAAMI,EAAS,GAAGJ,EAAQ,EAAE,IAAIjI,EAAE,CAAC,GAC7BgG,EAAO8B,GAAY9H,EAAE,CAAC,EAEtB2H,EAAOhC,GAAW,CACtB,GAAI0C,EACJ,IAAKrI,EAAE,IACP,IAAKA,EAAE,IACP,KAAMA,EAAE,KACR,MAAOA,EAAE,MACT,KAAAgG,EACA,MAAOhG,EAAE,KACT,UAAWgG,IAAS,KACpB,SAAWhF,GAAU,CACnBhC,EAAU,cAAciJ,EAAQ,GAAIjI,EAAE,EAAGgB,CAAK,CAChD,CAAA,CACD,EAEDoH,EAAU,YAAYT,CAAI,CAC5B,CAGA,MAAMW,EAAiBJ,EAAK,cAC1B,OAAOD,EAAQ,EAAE,EAAA,EAEbM,EAAcL,EAAK,cAAc,QAAQD,EAAQ,EAAE,EAAE,EACrDO,EAAON,EAAK,cAAc,SAASD,EAAQ,EAAE,EAAE,EAC/CQ,EAAWP,EAAK,cACpB,UAAUD,EAAQ,EAAE,EAAA,EAItB,OAAAK,EAAe,iBAAiB,SAAU,IAAM,CAC9CtJ,EAAU,SAASiJ,EAAQ,GAAIK,EAAe,OAAO,CACvD,CAAC,EAGDC,EAAY,iBAAiB,QAAS,IAAM,CAC1C,MAAMG,EAAY,CAACF,EAAK,UAAU,SAAS,WAAW,EACtDA,EAAK,UAAU,OAAO,YAAaE,CAAS,EAC5CH,EAAY,YAAcG,EAAY,IAAM,GAC9C,CAAC,EAGGD,GACFA,EAAS,iBAAiB,QAAS,IAAM,CACvCzJ,EAAU,QAAQiJ,EAAQ,EAAE,CAC9B,CAAC,EAGIC,CACT,CAKO,SAASS,EACdC,EACA/H,EACAI,EACAiC,EACM,CACN,MAAM2F,EAAOD,EAAU,cAAc,qBAAqB/H,CAAE,IAAI,EAChE,GAAI,CAACgI,EAAM,OAEX,MAAMP,EAAiBO,EAAK,cAAgC,OAAOhI,CAAE,EAAE,EACnEyH,IACFA,EAAe,QAAUrH,GAI3B4H,EAAK,UAAU,OAAO,SAAU5H,CAAO,EAGvC,SAAW,CAAC6H,EAAK9H,CAAK,IAAK,OAAO,QAAQkC,CAAM,EAAG,CACjD,MAAMyE,EAAOkB,EAAK,cAAc,kBAAkBhI,CAAE,IAAIiI,CAAG,IAAI,EAC3DnB,GACFD,EAAWC,EAAM3G,CAAK,CAE1B,CAGA,MAAMyH,EAAWI,EAAK,cAAiC,UAAUhI,CAAE,EAAE,EACjE4H,IACFA,EAAS,SAAW,CAACxH,GAIvB,MAAMuH,EAAOK,EAAK,cAAc,SAAShI,CAAE,EAAE,EACvCkI,EAASF,EAAK,cAAc,QAAQhI,CAAE,EAAE,EAC1C2H,GAAQO,IACN9H,GAAWuH,EAAK,UAAU,SAAS,WAAW,GAChDA,EAAK,UAAU,OAAO,WAAW,EACjCO,EAAO,YAAc,KACZ,CAAC9H,GAAW,CAACuH,EAAK,UAAU,SAAS,WAAW,IACzDA,EAAK,UAAU,IAAI,WAAW,EAC9BO,EAAO,YAAc,KAG3B,CC9IA,MAAMC,GAA2C,CAC/C,OAAQ,CACN,CAAE,GAAI,eAAgB,MAAO,SAAU,IAAK,GAAI,IAAK,IAAM,KAAM,EAAG,MAAO,IAAM,SAAU,YAAA,EAC3F,CAAE,GAAI,YAAa,MAAO,IAAK,IAAK,GAAK,IAAK,GAAI,KAAM,GAAK,MAAO,GAAK,SAAU,SAAA,CAAU,EAE/F,OAAQ,CACN,CAAE,GAAI,eAAgB,MAAO,OAAQ,IAAK,IAAM,IAAK,EAAG,KAAM,IAAM,MAAO,IAAM,SAAU,YAAA,EAC3F,CAAE,GAAI,gBAAiB,MAAO,QAAS,IAAK,EAAG,IAAK,GAAI,KAAM,GAAK,MAAO,EAAG,SAAU,aAAA,EACvF,CAAE,GAAI,cAAe,MAAO,MAAO,IAAK,EAAG,IAAK,EAAG,KAAM,IAAM,MAAO,IAAM,SAAU,WAAA,EACtF,CAAE,GAAI,aAAc,MAAO,WAAY,IAAK,EAAG,IAAK,IAAM,KAAM,IAAM,MAAO,IAAM,SAAU,UAAA,CAAW,EAE1G,OAAQ,CACN,CAAE,GAAI,gBAAiB,MAAO,QAAS,IAAK,GAAK,IAAK,EAAG,KAAM,GAAK,MAAO,IAAK,SAAU,aAAA,EAC1F,CAAE,GAAI,cAAe,MAAO,MAAO,IAAK,EAAG,IAAK,EAAG,KAAM,IAAM,MAAO,IAAM,SAAU,WAAA,CAAY,EAEpG,QAAS,CACP,CAAE,GAAI,eAAgB,MAAO,YAAa,IAAK,IAAK,IAAK,EAAG,KAAM,GAAK,MAAO,IAAK,SAAU,YAAA,EAC7F,CAAE,GAAI,eAAgB,MAAO,UAAW,IAAK,IAAM,IAAK,EAAG,KAAM,IAAM,MAAO,IAAM,SAAU,YAAA,CAAa,EAE7G,MAAO,CACL,CAAE,GAAI,cAAe,MAAO,OAAQ,IAAK,IAAM,IAAK,EAAK,KAAM,IAAM,MAAO,IAAM,SAAU,WAAA,EAC5F,CAAE,GAAI,YAAa,MAAO,WAAY,IAAK,EAAG,IAAK,GAAK,KAAM,IAAM,MAAO,GAAK,SAAU,SAAA,EAC1F,CAAE,GAAI,aAAc,MAAO,MAAO,IAAK,EAAG,IAAK,EAAG,KAAM,IAAM,MAAO,GAAK,SAAU,UAAA,CAAW,EAEjG,OAAQ,CACN,CAAE,GAAI,eAAgB,MAAO,OAAQ,IAAK,GAAK,IAAK,GAAI,KAAM,IAAM,MAAO,GAAK,SAAU,YAAA,EAC1F,CAAE,GAAI,gBAAiB,MAAO,QAAS,IAAK,EAAG,IAAK,EAAG,KAAM,IAAM,MAAO,GAAK,SAAU,aAAA,EACzF,CAAE,GAAI,aAAc,MAAO,WAAY,IAAK,EAAG,IAAK,GAAK,KAAM,IAAM,MAAO,GAAK,SAAU,UAAA,EAC3F,CAAE,GAAI,cAAe,MAAO,MAAO,IAAK,EAAG,IAAK,EAAG,KAAM,IAAM,MAAO,GAAK,SAAU,WAAA,CAAY,CAErG,EAKA,eAAeC,IAAsB,cAEnC,MAAMtF,EAAQ,IAAIzD,GACZ/B,EAAQ,IAAI6E,GAGZkG,MAAwC,IAC9C,IAAIC,EAAqC,KAGzC,MAAMC,EAAW7F,EAAS,SAAS,EAC7B8F,EAAc9F,EAA4B,cAAc,EACxD+F,EAAS/F,EAA4B,SAAS,EAC9CgG,EAAgBhG,EAA4B,gBAAgB,EAC5DiG,EAAgBjG,EAA4B,gBAAgB,EAC5DkG,EAAWlG,EAA4B,WAAW,EAClDmG,EAAenG,EAA4B,eAAe,EAC1DoG,EAAiBpG,EAA4B,iBAAiB,EAC9DqG,EAAerG,EAA4B,eAAe,EAC1DsG,EAAatG,EAA4B,aAAa,EACtDuG,EAAYvG,EAAS,YAAY,EACjCwG,EAAexG,EAAS,eAAe,EACvCyG,EAAiBzG,EAAS,iBAAiB,EAC3C0G,EAAe1G,EAAS,WAAW,EACnC2G,EAAgB3G,EAA4B,gBAAgB,EAC5D4G,EAAiB5G,EAA4B,iBAAiB,EAC9D6G,EAAc7G,EAAS,cAAc,EACrC8G,EAAU9G,EAA4B,UAAU,EAChD+G,EAAe/G,EAA4B,eAAe,EAC1DG,EAASH,EAA4B,QAAQ,EAGnD,IAAIgH,EAAoC,KAGpCC,EAAe,GAInBrB,EAAiBxD,GAAW,CAC1B,GAAI,aACJ,IAAK,EACL,IAAK,EACL,KAAM,KACN,MAAO,IACP,KAAM,KACN,MAAO,gBACP,UAAW,GACX,SAAW9B,GAAM,CACfF,EAAM,cAAcE,CAAC,CACvB,CAAA,CACD,EACDmG,EAAe,YAAYb,CAAc,EAIzC,SAASsB,GAAsB,CAC7B,SAAW,CAACC,EAASC,CAAK,IAAK,OAAO,QAAQ3B,EAAQ,EAAG,CACvD,MAAMJ,EAAYvF,EAAE,IAAIqH,CAAO,OAAO,EACtC,GAAK9B,EAEL,UAAWgC,KAAOD,EAAO,CACvB,MAAMhD,EAAOhC,GAAW,CACtB,GAAIiF,EAAI,GACR,IAAKA,EAAI,IACT,IAAKA,EAAI,IACT,KAAMA,EAAI,KACV,MAAOA,EAAI,MACX,KAAM,KACN,MAAOA,EAAI,MACX,UAAW,GACX,SAAU,IAAM,CACVjH,EAAM,WACRA,EAAM,mBAAmBkH,GAAc,CAE3C,CAAA,CACD,EACDjC,EAAU,YAAYjB,CAAI,EAC1BuB,EAAQ,IAAI0B,EAAI,GAAIjD,CAAI,CAC1B,CACF,CACF,CAEA8C,EAAA,EAIA,SAASK,GAA4B,CACnC,MAAM7H,EAAiF,CAAA,EAEvF,UAAWjF,KAAKU,EAAU,CACxB,MAAMqM,EAAW1H,EAAoB,OAAOrF,EAAE,EAAE,EAAE,EAC5CiD,GAAU8J,GAAA,YAAAA,EAAU,UAAW,GAC/B7H,EAAiC,CAAA,EAEvC,UAAWlD,KAAKhC,EAAE,QAAS,CACzB,MAAM2J,EAAO,SAAS,cAAc,kBAAkB3J,EAAE,EAAE,IAAIgC,EAAE,CAAC,IAAI,EACrEkD,EAAOlD,EAAE,CAAC,EAAI2H,EAAOE,EAAaF,CAAI,EAAI3H,EAAE,KAC9C,CAEAiD,EAASjF,EAAE,EAAE,EAAI,CAAE,QAAAiD,EAAS,OAAAiC,CAAA,CAC9B,CAIA,MAAO,CACL,EAAG,EACH,WAJsBiG,EAAiBtB,EAAasB,CAAc,EAAI,IAKtE,GAAI0B,EAAA,EACJ,SAAA5H,CAAA,CAEJ,CAEA,SAAS4H,GAA6B,yBACpC,MAAMG,EAAa,CAACnK,GAAYoK,KAA+B,CAC7D,MAAMtD,GAAOuB,EAAQ,IAAIrI,EAAE,EAC3B,OAAO8G,GAAOE,EAAaF,EAAI,EAAIsD,EACrC,EAEA,MAAO,CACL,WAAW9K,EAAAkD,EAAoB,aAAa,IAAjC,YAAAlD,EAAoC,UAAY,GAC3D,aAAaO,EAAA2C,EAAqB,eAAe,IAApC,YAAA3C,EAAuC,QAA8B,UAClF,WAAYsK,EAAW,eAAgB,GAAI,EAC3C,QAASA,EAAW,YAAa,EAAG,EACpC,WAAWE,EAAA7H,EAAoB,aAAa,IAAjC,YAAA6H,EAAoC,UAAY,GAC3D,aAAaC,EAAA9H,EAAqB,eAAe,IAApC,YAAA8H,EAAuC,QAAkC,SACtF,WAAYH,EAAW,eAAgB,GAAI,EAC3C,YAAaA,EAAW,gBAAiB,CAAC,EAC1C,UAAWA,EAAW,cAAe,GAAI,EACzC,SAAUA,EAAW,aAAc,GAAI,EACvC,WAAWI,EAAA/H,EAAoB,aAAa,IAAjC,YAAA+H,EAAoC,UAAY,GAC3D,YAAaJ,EAAW,gBAAiB,GAAG,EAC5C,UAAWA,EAAW,cAAe,GAAI,EACzC,YAAYK,EAAAhI,EAAoB,cAAc,IAAlC,YAAAgI,EAAqC,UAAY,GAC7D,WAAYL,EAAW,eAAgB,GAAG,EAC1C,WAAYA,EAAW,eAAgB,GAAI,EAC3C,UAAUM,EAAAjI,EAAoB,YAAY,IAAhC,YAAAiI,EAAmC,UAAY,GACzD,UAAWN,EAAW,cAAe,GAAI,EACzC,QAASA,EAAW,YAAa,EAAG,EACpC,SAAUA,EAAW,aAAc,EAAG,EACtC,WAAWO,GAAAlI,EAAoB,aAAa,IAAjC,YAAAkI,GAAoC,UAAY,GAC3D,WAAYP,EAAW,eAAgB,EAAG,EAC1C,YAAaA,EAAW,gBAAiB,EAAG,EAC5C,aAAc,SAAOQ,GAAAnI,EAAqB,iBAAiB,IAAtC,YAAAmI,GAAyC,QAAS,CAAC,EACxE,SAAUR,EAAW,aAAc,EAAG,EACtC,UAAWA,EAAW,cAAe,EAAG,CAAA,CAE5C,CAIA,SAASS,EAAeC,EAAoBC,EAAa,GAAa,OAChEA,GACFC,EAAA,EAIEzC,GACFzB,EAAWyB,EAAgBuC,EAAS,UAAU,EAIhDG,EAAYH,EAAS,EAAE,EAGvB,UAAW1N,KAAKU,EAAU,CACxB,MAAMoN,GAAe3L,EAAAuL,EAAS,WAAT,YAAAvL,EAAoBnC,EAAE,IACtC8N,GAELnD,EACEsB,EACAjM,EAAE,GACF8N,EAAa,QACbA,EAAa,MAAA,CAEjB,CACF,CAEA,SAASD,EAAYE,EAAiC,CACpD,MAAMC,EAAS,CAACnL,EAAYoL,IAAiB,CAC3C,MAAMzI,EAAKH,EAAqBxC,CAAE,EAC9B2C,GAAMyI,IAAQ,SAAWzI,EAAG,MAAQ,OAAOyI,CAAG,EACpD,EACMC,EAAS,CAACrL,EAAYoL,IAAiB,CAC3C,MAAMzI,EAAKH,EAAoBxC,CAAE,EAC7B2C,GAAMyI,IAAQ,SAAWzI,EAAG,QAAU,EAAQyI,EACpD,EACME,EAAU,CAACtL,EAAYoL,IAAiB,CAC5C,MAAMtE,EAAOuB,EAAQ,IAAIrI,CAAE,EACvB8G,GAAQsE,IAAQ,UAAsBtE,EAAM,OAAOsE,CAAG,CAAC,CAC7D,EAGAC,EAAO,cAAeH,EAAG,QAAQ,EACjCG,EAAO,cAAeH,EAAG,QAAQ,EACjCG,EAAO,cAAeH,EAAG,QAAQ,EACjCG,EAAO,eAAgBH,EAAG,SAAS,EACnCG,EAAO,aAAcH,EAAG,OAAO,EAC/BG,EAAO,cAAeH,EAAG,QAAQ,EAGjCC,EAAO,gBAAiBD,EAAG,UAAU,EACrCC,EAAO,gBAAiBD,EAAG,UAAU,EACrCC,EAAO,kBAAmBD,EAAG,YAAY,EAGzCI,EAAQ,eAAgBJ,EAAG,UAAU,EACrCI,EAAQ,YAAaJ,EAAG,OAAO,EAC/BI,EAAQ,eAAgBJ,EAAG,UAAU,EACrCI,EAAQ,gBAAiBJ,EAAG,WAAW,EACvCI,EAAQ,cAAeJ,EAAG,SAAS,EACnCI,EAAQ,aAAcJ,EAAG,QAAQ,EACjCI,EAAQ,gBAAiBJ,EAAG,WAAW,EACvCI,EAAQ,cAAeJ,EAAG,SAAS,EACnCI,EAAQ,eAAgBJ,EAAG,UAAU,EACrCI,EAAQ,eAAgBJ,EAAG,UAAU,EACrCI,EAAQ,cAAeJ,EAAG,SAAS,EACnCI,EAAQ,YAAaJ,EAAG,OAAO,EAC/BI,EAAQ,aAAcJ,EAAG,QAAQ,EACjCI,EAAQ,eAAgBJ,EAAG,UAAU,EACrCI,EAAQ,gBAAiBJ,EAAG,WAAW,EACvCI,EAAQ,aAAcJ,EAAG,QAAQ,EACjCI,EAAQ,cAAeJ,EAAG,SAAS,CACrC,CAEA,SAASH,GAAwB,CAC3BzC,GACFzB,EAAWyB,EAAgB,GAAI,EAEjC0C,EAAYhJ,EAAU,EAEtB,UAAW7E,KAAKU,EAAU,CACxB,MAAMwE,EAAiC,CAAA,EACvC,UAAWlD,KAAKhC,EAAE,QAChBkF,EAAOlD,EAAE,CAAC,EAAIA,EAAE,MAElB2I,EAAkBsB,EAAcjM,EAAE,GAAI,GAAOkF,CAAM,CACrD,CACF,CAIA,eAAekJ,IAA4B,CACzC,MAAMC,EAAevB,EAAA,EACrB,MAAMnH,EAAM,MAAM0I,CAAY,EAE9BjD,EAAS,YAAc,UACvBC,EAAY,YAAc,SAC1BA,EAAY,UAAU,IAAI,SAAS,EACnCC,EAAO,SAAW,GAGlBiB,EAAe,IAAI9G,GAAaC,EAAQC,CAAK,EAC7C4G,EAAa,MAAA,CACf,CAEA,eAAe+B,IAA2B,CACxC/B,GAAA,MAAAA,EAAc,OACdA,EAAe,KAEf,MAAM5G,EAAM,KAAA,EAEZyF,EAAS,YAAc,UACvBC,EAAY,YAAc,SAC1BA,EAAY,UAAU,OAAO,SAAS,EACtCC,EAAO,SAAW,GAClBA,EAAO,YAAc,SACrBA,EAAO,UAAU,OAAO,WAAW,CACrC,CAEA,eAAeiD,IAA6B,CACtC5I,EAAM,UACR,MAAM2I,GAAA,EAEN,MAAMF,GAAA,CAEV,CAIA,eAAeI,IAAiC,OAC9C,GAAI,CAAC7I,EAAM,UAAW,CACpByF,EAAS,YAAc,oBACvB,MACF,CAEA,GAAI,CAACzF,EAAM,YACTA,EAAM,eAAA,EACN2F,EAAO,YAAc,QACrBA,EAAO,UAAU,IAAI,WAAW,EAChCF,EAAS,YAAc,iBAClB,CACLE,EAAO,SAAW,GAClBA,EAAO,UAAU,OAAO,WAAW,EACnCF,EAAS,YAAc,cAEvB,MAAMqD,EAAS,MAAM9I,EAAM,cAAA,EAC3B,GAAI8I,EAAQ,CACV,KAAM,CAAE,KAAAlL,EAAM,SAAAC,CAAA,EAAaiL,EAGrBC,EAAO,IAAI,KAAK,CAACnL,CAAI,EAAGC,EAAU,CAAE,KAAM,YAAa,EAK7D,GAHE,UAAW,aACXrB,EAAA,UAAU,WAAV,YAAAA,EAAA,eAAqB,CAAE,MAAO,CAACuM,CAAI,KAGnC,GAAI,CACF,MAAM,UAAU,MAAM,CAAE,MAAO,CAACA,CAAI,EAAG,MAAO,0BAA2B,EACzEtD,EAAS,YAAc,QACzB,OAASvK,EAAK,CACPA,EAAc,OAAS,cAC1B8N,GAAapL,EAAMC,CAAQ,CAE/B,MAEAmL,GAAapL,EAAMC,CAAQ,CAE/B,CAEA8H,EAAO,SAAW,GAClBA,EAAO,YAAc,QACvB,CACF,CAEA,SAASqD,GAAapL,EAAYC,EAAwB,CACxD,MAAMoL,EAAM,IAAI,gBAAgBrL,CAAI,EAC9BuC,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAO8I,EACT9I,EAAE,SAAWtC,EACbsC,EAAE,MAAA,EACFsF,EAAS,UAAY,oBAAoBwD,CAAG,eAAepL,CAAQ,uCACrE,CAIA,SAASqL,EAAkBnE,EAA0B,CACnDoB,EAAU,UAAU,OAAO,iBAAkBpB,CAAS,EACtDiB,EAAe,UAAU,OAAO,SAAU,CAACjB,CAAS,EAC/CA,GACH,WAAW,IAAM6B,GAAA,YAAAA,EAAc,SAAU,CAAC,CAE9C,CAIA,SAASuC,IAAiB,CACxB1C,EAAY,UAAU,IAAI,MAAM,CAClC,CAEA,SAAS2C,GAAkB,CACzB3C,EAAY,UAAU,OAAO,MAAM,EACnCjM,EAAM,cAAA,CACR,CAKA,UAAWH,KAAKU,EAAU,CACxB,MAAMmK,EAAOb,GAAkBhK,EAAG,CAChC,SAAU,MAAO6C,EAAII,IAAY,CAE3BA,GAAW,CAAC0C,EAAM,WACpB,MAAMyI,GAAA,EAGJzI,EAAM,YACRA,EAAM,cAAc9C,EAAII,CAAO,EAC/B0H,EACEsB,EACApJ,EACAI,EACA6J,EAAA,EAAkB,SAASjK,CAAE,EAAE,MAAA,EAGrC,EACA,cAAe,CAACA,EAAIO,EAAOJ,IAAU,CACnC,GAAI2C,EAAM,YACRA,EAAM,mBAAmB9C,EAAIO,EAAOJ,CAAK,EAGrCI,IAAU,QAAQ,CACpB,MAAM2J,EAAW1H,EAAoB,OAAOxC,CAAE,EAAE,EAC5CkK,GAAA,MAAAA,EAAU,SACZpH,EAAM,cAAc9C,EAAI,EAAI,CAEhC,CAEJ,EACA,QAAUA,GAAO,CACX8C,EAAM,WACRA,EAAM,aAAa9C,CAAE,CAEzB,CAAA,CACD,EACDoJ,EAAa,YAAYpB,CAAI,CAC/B,CAGA,QAAS3L,EAAI,EAAGA,EAAI6F,EAAQ,OAAQ7F,IAAK,CACvC,MAAM8P,EAAM,SAAS,cAAc,QAAQ,EAC3CA,EAAI,MAAQ,OAAO9P,CAAC,EACpB8P,EAAI,YAAcjK,EAAQ7F,CAAC,EAAE,KAC7BwM,EAAa,YAAYsD,CAAG,CAC9B,CAKA3D,EAAY,iBAAiB,QAASkD,EAAW,EAGjDjD,EAAO,iBAAiB,QAASkD,EAAe,EAGhDtC,EAAc,iBAAiB,QAAS,IAAM,CAC5C,UAAWlM,KAAKU,EACdiF,EAAM,cAAc3F,EAAE,GAAI,EAAK,EAC/B2K,EAAkBsB,EAAcjM,EAAE,GAAI,GAAO8M,EAAA,EAAkB,SAAS9M,EAAE,EAAE,EAAE,MAAM,CAExF,CAAC,EAGDmM,EAAe,iBAAiB,QAAS,IAAM,CAC7CK,EAAe,CAACA,EAChB,UAAWxM,KAAKU,EAAU,CACxB,MAAM8J,EAAOnF,EAAE,SAASrF,EAAE,EAAE,EAAE,EACxB+K,EAAS1F,EAAE,QAAQrF,EAAE,EAAE,EAAE,EAC/BwK,GAAA,MAAAA,EAAM,UAAU,OAAO,YAAagC,GAChCzB,IAAQA,EAAO,YAAcyB,EAAe,IAAM,IACxD,CACAL,EAAe,YAAcK,EAAe,eAAiB,gBAC/D,CAAC,EAGDb,EAAe,iBAAiB,QAAS,IAAM,CAC7CkD,EAAkB,CAAC/C,EAAU,UAAU,SAAS,gBAAgB,CAAC,CACnE,CAAC,EAGDF,EAAa,iBAAiB,QAAS,IAAM,CAC3C,GAAIW,EAAc,CAChB,MAAMpO,EAAOoO,EAAa,WAAA,EAC1BX,EAAa,YAAczN,IAAS,OAAS,OAAS,UACxD,CACF,CAAC,EAGD0N,EAAW,iBAAiB,QAAS,IAAM,CACzC,MAAMoD,EAAO,CAAClD,EAAa,UAAU,SAAS,MAAM,EACpDA,EAAa,UAAU,OAAO,OAAQkD,CAAI,EAC1CpD,EAAW,UAAU,OAAO,SAAUoD,CAAI,EAC1CJ,EAAkBI,CAAI,CACxB,CAAC,EAGD,MAAMC,GAAkB,CACtB,aAAc,aAAc,aAC5B,cAAe,YAAa,YAAA,EAG9B,UAAWrM,KAAMqM,IACf/M,GAAAkD,EAAE,IAAIxC,CAAE,EAAE,IAAV,MAAAV,GAAa,iBAAiB,SAAU,IAAM,CACxCwD,EAAM,WACRA,EAAM,cAAckH,GAAc,CAEtC,GAIF,MAAMsC,GAAiB,CAAC,eAAgB,eAAgB,gBAAgB,EACxE,UAAWtM,KAAMsM,IACfzM,GAAA2C,EAAE,IAAIxC,CAAE,EAAE,IAAV,MAAAH,GAAa,iBAAiB,SAAU,IAAM,CACxCiD,EAAM,WACRA,EAAM,mBAAmBkH,GAAc,CAE3C,GAIFtB,EAAc,iBAAiB,QAAS,IAAM,CAC5CpL,EAAM,cAAc2M,GAAiB,EACrC1B,EAAS,YAAc,cACzB,CAAC,EAEDI,EAAc,iBAAiB,QAAS,IAAM,CAC5C,MAAM4D,EAASjP,EAAM,gBAAA,EACrB,GAAI,CAACiP,EAAQ,CACXhE,EAAS,YAAc,YACvB,MACF,CACAqC,EAAe2B,CAAM,EACjBzJ,EAAM,WACRA,EAAM,cAAckH,GAAc,EAEpCzB,EAAS,YAAc,eACzB,CAAC,EAEDK,EAAS,iBAAiB,QAAS,SAAY,CAC7C,MAAMmD,EAAMzO,EAAM,UAAU2M,EAAA,CAAiB,EAC7C,GAAI,CACF,MAAM,UAAU,UAAU,UAAU8B,CAAG,EACvCxD,EAAS,YAAc,aACzB,MAAQ,CACNA,EAAS,YAAc,aACzB,CACF,CAAC,EAEDM,EAAa,iBAAiB,SAAU,IAAM,CAC5C,MAAM2D,EAAM3D,EAAa,MACzB,GAAI2D,IAAQ,GAAI,OAEhB,MAAMD,EAASrK,EAAQ,OAAOsK,CAAG,CAAC,EAC7BD,GAAA,MAAAA,EAAQ,QAEb3B,EAAe2B,EAAO,MAAO,EAAI,EAC7BzJ,EAAM,WACRA,EAAM,cAAckH,GAAc,EAEpCzB,EAAS,YAAc,WAAWgE,EAAO,IAAI,GAC/C,CAAC,EAGD/C,EAAQ,iBAAiB,QAASyC,EAAQ,EAC1CxC,EAAa,iBAAiB,QAASyC,CAAS,EAChD3C,EAAY,iBAAiB,QAAU9I,GAAM,CACvCA,EAAE,SAAW8I,GAAa2C,EAAA,CAChC,CAAC,EACD,SAAS,iBAAiB,UAAYzL,GAAM,CACtCA,EAAE,MAAQ,UAAY8I,EAAY,UAAU,SAAS,MAAM,GAC7D2C,EAAA,CAEJ,CAAC,EAKD,MAAMO,KACJpC,GAAA,OAAO,aAAP,YAAAA,GAAA,YAAoB,sBAAsB,UAAW,GACvD2B,EAAkBS,EAAe,EAGjC,MAAMC,GAAWpP,EAAM,YAAA,EACnBoP,IACF9B,EAAe8B,EAAQ,EAIpBpP,EAAM,eACT2O,GAAA,CAEJ,CAGA7D,KAAO,MAAM,QAAQ,KAAK"}
{"version":3,"file":"formula-generator.worklet-gUE0dj-g.js","sources":["../src/audio/worklets/formula-generator.worklet.ts"],"sourcesContent":["/**\n * Formula Generator AudioWorklet Processor\n * Generates audio samples based on mathematical formulas\n */\n\ninterface FormulaParams {\n  gain: number;\n  // FM\n  fc: number;\n  fm: number;\n  I: number;\n  // AM\n  f1: number;\n  f2: number;\n  // Logistic\n  base: number;\n  depth: number;\n  r: number;\n  lfoHz: number;\n  // Gliss\n  f0: number;\n  k: number;\n  // Additive\n  fund: number;\n  N: number;\n  move: number;\n  // PM\n  f: number;\n  f2pm: number;\n  // Beats\n  fbeat: number;\n  df: number;\n  // Dist\n  fd: number;\n  alpha: number;\n  // Quasi\n  fq: number;\n  Aq: number;\n  wq: number;\n  // Lorenz\n  sigma: number;\n  rho: number;\n  beta: number;\n  lBase: number;\n  lFreqScale: number;\n  lAmp: number;\n  // Karplus-Strong\n  ksFreq: number;\n  ksDamp: number;\n  ksBright: number;\n  // Bitcrush\n  bcFreq: number;\n  bcBits: number;\n  bcDown: number;\n  // Noise LP\n  nCut: number;\n  // Pink noise\n  pinkBright: number;\n  // Brown noise\n  brownStep: number;\n  // Velvet noise\n  velvetDensity: number;\n  // Rossler\n  rossA: number;\n  rossB: number;\n  rossC: number;\n  rossBase: number;\n  rossFreqScale: number;\n  rossAmp: number;\n  // Shepard\n  shepBase: number;\n  shepSpeed: number;\n  shepOctaves: number;\n}\n\ntype WorkletMessage =\n  | { type: 'set'; params: Partial<FormulaParams> }\n  | { type: 'reset' };\n\nclass FormulaGeneratorProcessor extends AudioWorkletProcessor {\n  private formula: string;\n  private sr: number;\n  private t: number = 0;\n  private phase: number = 0;\n\n  // Logistic state\n  private logi: number = 0.33;\n\n  // Lorenz state\n  private lx: number = 0.1;\n  private ly: number = 0.0;\n  private lz: number = 0.0;\n\n  // Karplus-Strong state\n  private ksBuf: Float32Array | null = null;\n  private ksIdx: number = 0;\n  private ksN: number = 0;\n\n  // Noise LP state\n  private nlp: number = 0;\n\n  // Pink noise state (Paul Kellet's approximation)\n  private pinkB0: number = 0;\n  private pinkB1: number = 0;\n  private pinkB2: number = 0;\n  private pinkB3: number = 0;\n  private pinkB4: number = 0;\n  private pinkB5: number = 0;\n  private pinkB6: number = 0;\n\n  // Brown noise state\n  private brownVal: number = 0;\n\n  // Velvet noise state\n  private velvetCounter: number = 0;\n  private velvetNext: number = 0;\n\n  // Rossler attractor state\n  private rx: number = 0.1;\n  private ry: number = 0.0;\n  private rz: number = 0.0;\n\n  // Shepard tone phase accumulators\n  private shepardPhases: Float32Array = new Float32Array(10);\n  private shepardT: number = 0;\n\n  // Parameters\n  private p: FormulaParams;\n\n  constructor(options?: AudioWorkletNodeOptions) {\n    super();\n    const o = options?.processorOptions || {};\n    this.formula = o.formula || 'fm';\n    this.sr = sampleRate;\n\n    this.p = {\n      gain: 0.2,\n      fc: 220,\n      fm: 2,\n      I: 2,\n      f1: 220,\n      f2: 221,\n      base: 110,\n      depth: 330,\n      r: 3.86,\n      lfoHz: 40,\n      f0: 55,\n      k: 0.15,\n      fund: 110,\n      N: 12,\n      move: 0.35,\n      f: 220,\n      f2pm: 3,\n      fbeat: 220,\n      df: 0.8,\n      fd: 110,\n      alpha: 3.0,\n      fq: 120,\n      Aq: 220,\n      wq: 0.8,\n      sigma: 10,\n      rho: 28,\n      beta: 2.6667,\n      lBase: 120,\n      lFreqScale: 40,\n      lAmp: 0.25,\n      ksFreq: 110,\n      ksDamp: 0.985,\n      ksBright: 0.5,\n      bcFreq: 220,\n      bcBits: 6,\n      bcDown: 8,\n      nCut: 800,\n      pinkBright: 0.5,\n      brownStep: 0.02,\n      velvetDensity: 2000,\n      rossA: 0.2,\n      rossB: 0.2,\n      rossC: 5.7,\n      rossBase: 120,\n      rossFreqScale: 30,\n      rossAmp: 0.25,\n      shepBase: 55,\n      shepSpeed: 0.1,\n      shepOctaves: 6,\n      ...o.params,\n    };\n\n    this.port.onmessage = (e: MessageEvent<WorkletMessage>) => {\n      const msg = e.data;\n      if (msg.type === 'set') {\n        Object.assign(this.p, msg.params);\n      } else if (msg.type === 'reset') {\n        this.resetState();\n      }\n    };\n\n    this.initKS(true);\n  }\n\n  private clamp(x: number, a: number, b: number): number {\n    return Math.max(a, Math.min(b, x));\n  }\n\n  private resetState(): void {\n    this.t = 0;\n    this.phase = 0;\n    this.logi = 0.33;\n    this.lx = 0.1;\n    this.ly = 0.0;\n    this.lz = 0.0;\n    this.nlp = 0;\n    this.initKS(true);\n    // Reset pink noise\n    this.pinkB0 = 0;\n    this.pinkB1 = 0;\n    this.pinkB2 = 0;\n    this.pinkB3 = 0;\n    this.pinkB4 = 0;\n    this.pinkB5 = 0;\n    this.pinkB6 = 0;\n    // Reset brown noise\n    this.brownVal = 0;\n    // Reset velvet noise\n    this.velvetCounter = 0;\n    this.velvetNext = 0;\n    // Reset Rossler\n    this.rx = 0.1;\n    this.ry = 0.0;\n    this.rz = 0.0;\n    // Reset Shepard\n    for (let i = 0; i < this.shepardPhases.length; i++) {\n      this.shepardPhases[i] = 0;\n    }\n    this.shepardT = 0;\n  }\n\n  private initKS(force: boolean): void {\n    const p = this.p;\n    const freq = Math.max(20, p.ksFreq || 110);\n    const N = Math.max(2, Math.floor(this.sr / freq));\n    if (!force && this.ksBuf && this.ksN === N) return;\n    this.ksN = N;\n    this.ksBuf = new Float32Array(N);\n    this.ksIdx = 0;\n    for (let i = 0; i < N; i++) {\n      this.ksBuf[i] = Math.random() * 2 - 1;\n    }\n  }\n\n  process(\n    _inputs: Float32Array[][],\n    outputs: Float32Array[][],\n    _parameters: Record<string, Float32Array>\n  ): boolean {\n    const out = outputs[0];\n    const ch0 = out[0];\n    const n = ch0.length;\n    const sr = this.sr;\n    const twoPi = 2 * Math.PI;\n\n    const p = this.p;\n    let phase = this.phase;\n    let t = this.t;\n    let logi = this.logi;\n    let lx = this.lx,\n      ly = this.ly,\n      lz = this.lz;\n    let nlp = this.nlp;\n\n    for (let i = 0; i < n; i++) {\n      let x = 0;\n\n      switch (this.formula) {\n        case 'fm':\n          x = Math.sin(twoPi * p.fc * t + p.I * Math.sin(twoPi * p.fm * t));\n          break;\n\n        case 'logistic': {\n          const step = Math.max(1, Math.floor(sr / Math.max(1e-3, p.lfoHz)));\n          if (i % step === 0) {\n            logi = p.r * logi * (1 - logi);\n            logi = this.clamp(logi, 0, 1);\n          }\n          const f = p.base + p.depth * (logi - 0.5);\n          phase += twoPi * (Math.max(0, f) / sr);\n          x = Math.sin(phase);\n          break;\n        }\n\n        case 'gliss': {\n          const f = p.f0 * Math.exp(p.k * t);\n          phase += twoPi * (f / sr);\n          x = Math.sin(phase);\n          break;\n        }\n\n        case 'additive': {\n          const fund = p.fund;\n          const N = Math.max(1, Math.floor(p.N));\n          const move = p.move;\n          let s = 0;\n          for (let k = 1; k <= N; k++) {\n            const ak = (1 / k) * Math.sin(twoPi * move * t + k);\n            s += ak * Math.sin(twoPi * (k * fund) * t);\n          }\n          x = s * (1.0 / Math.log2(N + 1));\n          break;\n        }\n\n        case 'pm': {\n          const phi = Math.sin(Math.sin(twoPi * p.f2pm * t));\n          x = Math.sin(twoPi * p.f * t + phi * 5.0);\n          break;\n        }\n\n        case 'beats':\n          x =\n            0.5 *\n            (Math.sin(twoPi * p.fbeat * t) +\n              Math.sin(twoPi * (p.fbeat + p.df) * t));\n          break;\n\n        case 'dist':\n          x = Math.tanh(p.alpha * Math.sin(twoPi * p.fd * t));\n          break;\n\n        case 'quasi': {\n          const mod = Math.sin(Math.sin(Math.sin(p.wq * t)));\n          const f = Math.max(0, p.fq + p.Aq * mod);\n          phase += twoPi * (f / sr);\n          x = Math.sin(phase);\n          break;\n        }\n\n        case 'lorenz': {\n          const dt = 1 / sr;\n          const dx = p.sigma * (ly - lx);\n          const dy = lx * (p.rho - lz) - ly;\n          const dz = lx * ly - p.beta * lz;\n          lx += dx * dt;\n          ly += dy * dt;\n          lz += dz * dt;\n\n          const freq = Math.max(0, p.lBase + p.lFreqScale * Math.abs(lx));\n          const amp = this.clamp(\n            p.lAmp * (0.3 + 0.7 * (0.5 + 0.5 * Math.tanh(ly))),\n            0,\n            1\n          );\n          phase += twoPi * (freq / sr);\n          x = amp * Math.sin(phase);\n          break;\n        }\n\n        case 'karplus': {\n          this.initKS(false);\n          const buf = this.ksBuf!;\n          const N = this.ksN;\n          const idx = this.ksIdx;\n          const y0 = buf[idx];\n          const y1 = buf[(idx + 1) % N];\n          const damp = this.clamp(p.ksDamp, 0.8, 0.99999);\n          const bright = this.clamp(p.ksBright, 0, 1);\n          const avg = 0.5 * (y0 + y1);\n          const next = damp * (bright * y0 + (1 - bright) * avg);\n          buf[idx] = next;\n          this.ksIdx = (idx + 1) % N;\n          x = y0;\n          break;\n        }\n\n        case 'noiselp': {\n          const white = Math.random() * 2 - 1;\n          const cut = this.clamp(p.nCut, 20, 18000);\n          const a = 1 - Math.exp((-2 * Math.PI * cut) / sr);\n          nlp = nlp + a * (white - nlp);\n          x = nlp;\n          break;\n        }\n\n        case 'pinknoise': {\n          const white = Math.random() * 2 - 1;\n          this.pinkB0 = 0.99886 * this.pinkB0 + white * 0.0555179;\n          this.pinkB1 = 0.99332 * this.pinkB1 + white * 0.0750759;\n          this.pinkB2 = 0.969 * this.pinkB2 + white * 0.153852;\n          this.pinkB3 = 0.8665 * this.pinkB3 + white * 0.3104856;\n          this.pinkB4 = 0.55 * this.pinkB4 + white * 0.5329522;\n          this.pinkB5 = -0.7616 * this.pinkB5 - white * 0.016898;\n          const pink =\n            this.pinkB0 +\n            this.pinkB1 +\n            this.pinkB2 +\n            this.pinkB3 +\n            this.pinkB4 +\n            this.pinkB5 +\n            this.pinkB6 +\n            white * 0.5362;\n          this.pinkB6 = white * 0.115926;\n          const bright = this.clamp(p.pinkBright, 0, 1);\n          x = pink * 0.11 * (1 - bright) + white * bright * 0.5;\n          break;\n        }\n\n        case 'brownnoise': {\n          const white = Math.random() * 2 - 1;\n          const step = this.clamp(p.brownStep, 0.001, 0.1);\n          this.brownVal = this.clamp(this.brownVal + white * step, -1, 1);\n          x = this.brownVal;\n          break;\n        }\n\n        case 'velvetnoise': {\n          const density = Math.max(100, p.velvetDensity);\n          const avgSamples = sr / density;\n          if (this.velvetCounter >= this.velvetNext) {\n            x = Math.random() > 0.5 ? 1 : -1;\n            this.velvetNext =\n              this.velvetCounter + avgSamples * (0.5 + Math.random());\n          } else {\n            x = 0;\n          }\n          this.velvetCounter++;\n          break;\n        }\n\n        case 'rossler': {\n          const dt = 1 / sr;\n          const a = p.rossA,\n            b = p.rossB,\n            c = p.rossC;\n          const dx = -this.ry - this.rz;\n          const dy = this.rx + a * this.ry;\n          const dz = b + this.rz * (this.rx - c);\n          this.rx += dx * dt * 100;\n          this.ry += dy * dt * 100;\n          this.rz += dz * dt * 100;\n          this.rx = this.clamp(this.rx, -50, 50);\n          this.ry = this.clamp(this.ry, -50, 50);\n          this.rz = this.clamp(this.rz, -50, 50);\n\n          const freq = Math.max(0, p.rossBase + p.rossFreqScale * this.rx);\n          const amp = this.clamp(\n            p.rossAmp * (0.3 + 0.7 * (0.5 + 0.02 * this.ry)),\n            0,\n            1\n          );\n          phase += twoPi * (freq / sr);\n          x = amp * Math.sin(phase);\n          break;\n        }\n\n        case 'shepard': {\n          const baseF = Math.max(20, p.shepBase);\n          const speed = p.shepSpeed;\n          const octaves = Math.max(1, Math.min(10, Math.floor(p.shepOctaves)));\n          const centerLog = Math.log2(440);\n          const sigma = 1.5;\n\n          this.shepardT += speed / sr;\n          if (this.shepardT > 1) this.shepardT -= 1;\n\n          let sum = 0;\n          for (let k = 0; k < octaves; k++) {\n            const freqMult = Math.pow(2, k + this.shepardT);\n            const freq = baseF * freqMult;\n            if (freq > 18000) continue;\n\n            const logF = Math.log2(freq);\n            const envelope = Math.exp(\n              -0.5 * Math.pow((logF - centerLog) / sigma, 2)\n            );\n\n            this.shepardPhases[k] += twoPi * (freq / sr);\n            if (this.shepardPhases[k] > twoPi) this.shepardPhases[k] -= twoPi;\n            sum += envelope * Math.sin(this.shepardPhases[k]);\n          }\n          x = sum / Math.sqrt(octaves);\n          break;\n        }\n\n        default:\n          x = 0;\n      }\n\n      ch0[i] = x * (p.gain ?? 0.2);\n      t += 1 / sr;\n      if (phase > 1e9) phase %= twoPi;\n    }\n\n    this.phase = phase;\n    this.t = t;\n    this.logi = logi;\n    this.lx = lx;\n    this.ly = ly;\n    this.lz = lz;\n    this.nlp = nlp;\n\n    return true;\n  }\n}\n\nregisterProcessor('formula-generator', FormulaGeneratorProcessor);\n"],"names":["FormulaGeneratorProcessor","options","o","e","msg","x","a","b","i","force","p","freq","N","_inputs","outputs","_parameters","ch0","n","sr","twoPi","phase","t","logi","lx","ly","lz","nlp","step","f","fund","move","s","k","ak","phi","mod","dt","dx","dy","dz","amp","buf","idx","y0","y1","damp","bright","avg","next","white","cut","pink","density","avgSamples","c","baseF","speed","octaves","centerLog","sigma","sum","freqMult","logF","envelope"],"mappings":"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"}
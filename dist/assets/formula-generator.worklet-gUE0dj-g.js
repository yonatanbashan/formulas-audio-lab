class P extends AudioWorkletProcessor{constructor(c){super(),this.t=0,this.phase=0,this.logi=.33,this.lx=.1,this.ly=0,this.lz=0,this.ksBuf=null,this.ksIdx=0,this.ksN=0,this.nlp=0,this.pinkB0=0,this.pinkB1=0,this.pinkB2=0,this.pinkB3=0,this.pinkB4=0,this.pinkB5=0,this.pinkB6=0,this.brownVal=0,this.velvetCounter=0,this.velvetNext=0,this.rx=.1,this.ry=0,this.rz=0,this.shepardPhases=new Float32Array(10),this.shepardT=0;const M=(c==null?void 0:c.processorOptions)||{};this.formula=M.formula||"fm",this.sr=sampleRate,this.p={gain:.2,fc:220,fm:2,I:2,f1:220,f2:221,base:110,depth:330,r:3.86,lfoHz:40,f0:55,k:.15,fund:110,N:12,move:.35,f:220,f2pm:3,fbeat:220,df:.8,fd:110,alpha:3,fq:120,Aq:220,wq:.8,sigma:10,rho:28,beta:2.6667,lBase:120,lFreqScale:40,lAmp:.25,ksFreq:110,ksDamp:.985,ksBright:.5,bcFreq:220,bcBits:6,bcDown:8,nCut:800,pinkBright:.5,brownStep:.02,velvetDensity:2e3,rossA:.2,rossB:.2,rossC:5.7,rossBase:120,rossFreqScale:30,rossAmp:.25,shepBase:55,shepSpeed:.1,shepOctaves:6,...M.params},this.port.onmessage=x=>{const f=x.data;f.type==="set"?Object.assign(this.p,f.params):f.type==="reset"&&this.resetState()},this.initKS(!0)}clamp(c,M,x){return Math.max(M,Math.min(x,c))}resetState(){this.t=0,this.phase=0,this.logi=.33,this.lx=.1,this.ly=0,this.lz=0,this.nlp=0,this.initKS(!0),this.pinkB0=0,this.pinkB1=0,this.pinkB2=0,this.pinkB3=0,this.pinkB4=0,this.pinkB5=0,this.pinkB6=0,this.brownVal=0,this.velvetCounter=0,this.velvetNext=0,this.rx=.1,this.ry=0,this.rz=0;for(let c=0;c<this.shepardPhases.length;c++)this.shepardPhases[c]=0;this.shepardT=0}initKS(c){const M=this.p,x=Math.max(20,M.ksFreq||110),f=Math.max(2,Math.floor(this.sr/x));if(!(!c&&this.ksBuf&&this.ksN===f)){this.ksN=f,this.ksBuf=new Float32Array(f),this.ksIdx=0;for(let b=0;b<f;b++)this.ksBuf[b]=Math.random()*2-1}}process(c,M,x){const b=M[0][0],z=b.length,n=this.sr,e=2*Math.PI,s=this.p;let r=this.phase,o=this.t,d=this.logi,u=this.lx,v=this.ly,q=this.lz,g=this.nlp;for(let w=0;w<z;w++){let h=0;switch(this.formula){case"fm":h=Math.sin(e*s.fc*o+s.I*Math.sin(e*s.fm*o));break;case"logistic":{const t=Math.max(1,Math.floor(n/Math.max(.001,s.lfoHz)));w%t===0&&(d=s.r*d*(1-d),d=this.clamp(d,0,1));const i=s.base+s.depth*(d-.5);r+=e*(Math.max(0,i)/n),h=Math.sin(r);break}case"gliss":{const t=s.f0*Math.exp(s.k*o);r+=e*(t/n),h=Math.sin(r);break}case"additive":{const t=s.fund,i=Math.max(1,Math.floor(s.N)),a=s.move;let l=0;for(let p=1;p<=i;p++){const m=1/p*Math.sin(e*a*o+p);l+=m*Math.sin(e*(p*t)*o)}h=l*(1/Math.log2(i+1));break}case"pm":{const t=Math.sin(Math.sin(e*s.f2pm*o));h=Math.sin(e*s.f*o+t*5);break}case"beats":h=.5*(Math.sin(e*s.fbeat*o)+Math.sin(e*(s.fbeat+s.df)*o));break;case"dist":h=Math.tanh(s.alpha*Math.sin(e*s.fd*o));break;case"quasi":{const t=Math.sin(Math.sin(Math.sin(s.wq*o))),i=Math.max(0,s.fq+s.Aq*t);r+=e*(i/n),h=Math.sin(r);break}case"lorenz":{const t=1/n,i=s.sigma*(v-u),a=u*(s.rho-q)-v,l=u*v-s.beta*q;u+=i*t,v+=a*t,q+=l*t;const p=Math.max(0,s.lBase+s.lFreqScale*Math.abs(u)),m=this.clamp(s.lAmp*(.3+.7*(.5+.5*Math.tanh(v))),0,1);r+=e*(p/n),h=m*Math.sin(r);break}case"karplus":{this.initKS(!1);const t=this.ksBuf,i=this.ksN,a=this.ksIdx,l=t[a],p=t[(a+1)%i],m=this.clamp(s.ksDamp,.8,.99999),k=this.clamp(s.ksBright,0,1),y=.5*(l+p),B=m*(k*l+(1-k)*y);t[a]=B,this.ksIdx=(a+1)%i,h=l;break}case"noiselp":{const t=Math.random()*2-1,i=this.clamp(s.nCut,20,18e3),a=1-Math.exp(-2*Math.PI*i/n);g=g+a*(t-g),h=g;break}case"pinknoise":{const t=Math.random()*2-1;this.pinkB0=.99886*this.pinkB0+t*.0555179,this.pinkB1=.99332*this.pinkB1+t*.0750759,this.pinkB2=.969*this.pinkB2+t*.153852,this.pinkB3=.8665*this.pinkB3+t*.3104856,this.pinkB4=.55*this.pinkB4+t*.5329522,this.pinkB5=-.7616*this.pinkB5-t*.016898;const i=this.pinkB0+this.pinkB1+this.pinkB2+this.pinkB3+this.pinkB4+this.pinkB5+this.pinkB6+t*.5362;this.pinkB6=t*.115926;const a=this.clamp(s.pinkBright,0,1);h=i*.11*(1-a)+t*a*.5;break}case"brownnoise":{const t=Math.random()*2-1,i=this.clamp(s.brownStep,.001,.1);this.brownVal=this.clamp(this.brownVal+t*i,-1,1),h=this.brownVal;break}case"velvetnoise":{const t=Math.max(100,s.velvetDensity),i=n/t;this.velvetCounter>=this.velvetNext?(h=Math.random()>.5?1:-1,this.velvetNext=this.velvetCounter+i*(.5+Math.random())):h=0,this.velvetCounter++;break}case"rossler":{const t=1/n,i=s.rossA,a=s.rossB,l=s.rossC,p=-this.ry-this.rz,m=this.rx+i*this.ry,k=a+this.rz*(this.rx-l);this.rx+=p*t*100,this.ry+=m*t*100,this.rz+=k*t*100,this.rx=this.clamp(this.rx,-50,50),this.ry=this.clamp(this.ry,-50,50),this.rz=this.clamp(this.rz,-50,50);const y=Math.max(0,s.rossBase+s.rossFreqScale*this.rx),B=this.clamp(s.rossAmp*(.3+.7*(.5+.02*this.ry)),0,1);r+=e*(y/n),h=B*Math.sin(r);break}case"shepard":{const t=Math.max(20,s.shepBase),i=s.shepSpeed,a=Math.max(1,Math.min(10,Math.floor(s.shepOctaves))),l=Math.log2(440),p=1.5;this.shepardT+=i/n,this.shepardT>1&&(this.shepardT-=1);let m=0;for(let k=0;k<a;k++){const y=Math.pow(2,k+this.shepardT),B=t*y;if(B>18e3)continue;const S=Math.log2(B),N=Math.exp(-.5*Math.pow((S-l)/p,2));this.shepardPhases[k]+=e*(B/n),this.shepardPhases[k]>e&&(this.shepardPhases[k]-=e),m+=N*Math.sin(this.shepardPhases[k])}h=m/Math.sqrt(a);break}default:h=0}b[w]=h*(s.gain??.2),o+=1/n,r>1e9&&(r%=e)}return this.phase=r,this.t=o,this.logi=d,this.lx=u,this.ly=v,this.lz=q,this.nlp=g,!0}}registerProcessor("formula-generator",P);
//# sourceMappingURL=formula-generator.worklet-gUE0dj-g.js.map
